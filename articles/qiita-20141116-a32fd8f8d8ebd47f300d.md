---
title: "EC2ã¸ã®Phabricatorã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
date: 2014-11-16T23:16:05+09:00
emoji: "ğŸ“£"
type: "tech"
topics: [AWS, EC2, phabricator]
published: false
---

## Phabricator ã¨ã¯

facebook è£½ã® LAMP ä¸Šã§å‹•ä½œã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«

[Phabricator](http://phabricator.org/ "Phabricator")
[Facebook è£½ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼å‘ã‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†Â·Phabricator MOONGIFT](http://www.moongift.jp/2013/03/20130313-2/ "Facebookè£½ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼å‘ã‘ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†Â·Phabricator MOONGIFT")

[phacility/phabricator](https://github.com/phacility/phabricator "phacility/phabricator")

Subversion ã®ã‚³ãƒŸãƒƒãƒˆã«å¯¾ã—ã¦ãƒ©ã‚¤ãƒ³æ¯ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ã‘ãŸãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå‡ºæ¥ã‚‹æ•°å°‘ãªã„ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ã€ä¸Šæ‰‹ãä½¿ã£ã¦ã„ããŸã„ã€‚

## ç’°å¢ƒ

### ä½¿ç”¨ç’°å¢ƒ

AWS EC2 ã® Red Hat Enterprise Linux 7.0 (HVM), SSD Volume Type - ami-99bef1a9 ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

ãƒ¡ãƒ¢ãƒª 1GB ã ã¨ãƒ¡ãƒ¢ãƒªãŒã‹ã¤ã‹ã¤ã«ãªã‚‹ã®ã§ã€2GB ã¯æ¬²ã—ã„ã€‚

### æº–å‚™

ã¾ãšã¯ yum updateã€‚

```
sudo yum update
```

SELinux ã¯ off ã«ã—ã¦ãŠã

[Apache VirtualHost ã§ DocumentRoot does not exist ã§ã‚‚ã‚ã‚‹ã®ã«ã€‚ã€‚ | KennyQi](http://kennyqi.com/archives/43.html "Apache VirtualHostã§DocumentRoot does not exist ã§ã‚‚ã‚ã‚‹ã®ã«ã€‚ã€‚ | KennyQi")

## LAMP ç’°å¢ƒä½œæˆ

AWS ã®å…¬å¼ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’å‚è€ƒã«ã€‚

[ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«: LAMP ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« - Amazon Elastic Compute Cloud](http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/install-LAMP.html "ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«: LAMP ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« - Amazon Elastic Compute Cloud")

---

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é€šã‚Šã ã¨ mysql-server ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¦ã„ãªã‹ã£ãŸãŸã‚ä¸‹è¨˜ã‚’è¿½åŠ ã§å®Ÿè¡Œã™ã‚‹

```
sudo yum install -y http://repo.mysql.com/mysql-community-release-el6-5.noarch.rpm
```

[yum ã§æœ€æ–°ã® MySQL ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ - Qiita](http://qiita.com/kmats@github/items/48457b7e5046f3cdf4d8 "yumã§æœ€æ–°ã®MySQLã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ - Qiita")

### php-mbstring ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

phabricator ã®å®Ÿè¡Œã«ã¯ php-mbstring ãŒå¿…è¦

ä»Šå›ä½¿ç”¨ã—ãŸ Red Hat Enterprise Linux ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã ã¨ã€php-mbstring ã®ã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªãŒ yum ã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ä¸‹è¨˜ã‚’å‚è€ƒã«ãƒªãƒã‚¸ãƒˆãƒªã®è¿½åŠ ã‹ã‚‰è¡Œã†å¿…è¦ãŒã‚ã‚‹

[Redhat Enterprise Linux 6.4 (x64) ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹](http://www.rem-system.com/post-847/ "Redhat Enterprise Linux 6.4 (x64) ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹")

```
sudo yum-config-manager --enable rhui-REGION-rhel-server-optional
sudo yum install -y php-mbstring
```

## Phabricator ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

Phabricator å…¬å¼ã‚µã‚¤ãƒˆã«ã‚ã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã‚’å‚è€ƒã«

[â—‰ Configuration Guide](https://secure.phabricator.com/book/phabricator/article/configuration_guide/ "â—‰ Configuration Guide")

### Phabricator ã®ã‚½ãƒ¼ã‚¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

å…¬å¼ã‚µã‚¤ãƒˆã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã§ã¯ Git ãŒå¿…è¦ãªã®ã§ã€ã¾ãšã¯ Git ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
sudo yum install -y git
```

Phabricator ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã—ãŸã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸Šã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æµã™

```
curl -o install.sh http://www.phabricator.com/rsrc/install/install_rhel-derivs.sh
chmod +x install.sh
# yum installãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã€sudoã§
sudo ./install.sh
sudo chown -R ec2-user:ec2-user ./*
```

ä¸‹è¨˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹

- `phabricator`
- `libphutil`
- `arcanist`

### åˆæœŸè¨­å®š

Diffusion ã¨ã„ã†ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«å…ˆã»ã©ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ`phabricator`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã® phd ã‚’èµ·å‹•ã™ã‚‹ã€‚

```
./phabricator/bin/phd start
```

ã¾ãŸã€ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å–å¾—ã—ãŸã‚½ãƒ¼ã‚¹ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª`/var/repo`ã‚‚ä½œæˆã—ã¦ãŠãã€‚
ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ã€Apache ã®èµ·å‹•ãƒ¦ãƒ¼ã‚¶ãŒæ›¸ãè¾¼ã¿å¯èƒ½ã¨ãªã‚‹ã‚ˆã†è¨­å®šã™ã‚‹ã®ã‚’å¿˜ã‚Œãšã«ï¼‰

```
sudo mkdir /var/repo
sudo chown ec2-user:ec2-user /var/repo
```

## Phabricator ã®è¨­å®š

å…¬å¼ã®è¨­å®šæ‰‹é †ã‚’å‚è€ƒã«

[â—‰ Configuration Guide](https://secure.phabricator.com/book/phabricator/article/configuration_guide/ "â—‰ Configuration Guide")

Apache/nginx/lighttpd ã§ã®è¨­å®šä¾‹ãŒç´¹ä»‹ã•ã‚Œã¦ã¾ã™ãŒã€ä»Šå›ã¯ Apache ã‚’ä½¿ç”¨

---

### Apache ã®è¨­å®š

å…¬å¼ã‚’å‚è€ƒã« `/etc/httpd/conf/httpd.conf`ã« VirtualHost ã®è¨­å®šã‚’è¿½åŠ ã€‚

- `ServerName`ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
- `DocumentRoot` ã«å…ˆã»ã©ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ'phabricator`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã—ã¦ã„

```
<VirtualHost *>
  # Change this to the domain which points to your host.
  # ServerName phabricator.example.com

  # Change this to the path where you put 'phabricator' when you checked it
  # out from GitHub when following the Installation Guide.
  #
  # Make sure you include "/webroot" at the end!
  DocumentRoot /path/to/phabricator/webroot

  RewriteEngine on
  RewriteRule ^/rsrc/(.*)     -                       [L,QSA]
  RewriteRule ^/favicon.ico   -                       [L,QSA]
  RewriteRule ^(.*)$          /index.php?__path__=$1  [B,L,QSA]
</VirtualHost>
```

Phabricator ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒ Apache ã«ã‚ˆã£ã¦ serve ã•ã‚Œãªã„å ´æ‰€ã«ã‚ã‚‹å ´åˆã¯`Direcotry`ã®è¨­å®šã‚‚`httpd.conf`ã«è¿½åŠ ã™ã‚‹

```
<Directory "/path/to/phabricator/webroot">
  Order allow,deny
  Allow from all
</Directory>
```

### MySQL ã®è¨­å®š

`phabricator`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ MySQL ã® DB ã‚’æ›´æ–°

Phabricator ã« MySQL ã®ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’è¨­å®š

```
phabricator/ $ ./bin/config set mysql.host localhost
phabricator/ $ ./bin/config set mysql.user root
phabricator/ $ ./bin/config set mysql.pass ********
```

MySQL ã®è¨­å®šã‚’å®Ÿè¡Œ

```
phabricator/ $ ./phabricator/bin/storage upgrade
```

## Phabricator æ¥ç¶š

ã“ã“ã¾ã§æ¥ã‚Œã°ã€ã¨ã‚Šã‚ãˆãš Phabricator ã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¯ãšã€‚

[Phabricator-Admin-Account.png (PNG ç”»åƒ, 689x700 px)](http://www.tecmint.com/wp-content/uploads/2014/09/Phabricator-Admin-Account.png "Phabricator-Admin-Account.png (PNG ç”»åƒ, 689x700 px)")

## Phabricator ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãŸã„å ´åˆ

phabricator ã«ã¯ãƒªãƒªãƒ¼ã‚¹ã¨ã„ã†æ¦‚å¿µãŒãªã•ãã†ãªã®ã§ã€å¥½ããªæ™‚ã«ã‚½ãƒ¼ã‚¹ã‚’æœ€æ–°åŒ–ã—ã¦ã„ãé‹ç”¨ã«ãªã‚Šãã†

1. web ã‚µãƒ¼ãƒã®åœæ­¢
2. `libphutil` `arcanist` `phabricator` ãã‚Œãã§ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§`git pull`
3. `phabricator/bin/storage upgrade` ã§ DB æ›´æ–°
4. web ã‚µãƒ¼ãƒå†èµ·å‹•

[â—‰ Installation Guide - updating-phabricator](https://secure.phabricator.com/book/phabricator/article/installation_guide/#updating-phabricator "â—‰ Installation Guide - updating-phabricator")

```
Updating Phabricator

Since Phabricator is under active development, you should update frequently. To update Phabricator:

    Stop the webserver (including php-fpm, if you use it).
    Run git pull in libphutil/, arcanist/ and phabricator/.
    Run phabricator/bin/storage upgrade.
    Restart the webserver (and php-fpm, if you stopped it earlier).

For more details, see Configuration Guide. You can use a script similar to this one to automate the process:

http://www.phabricator.com/rsrc/install/update_phabricator.sh
```
