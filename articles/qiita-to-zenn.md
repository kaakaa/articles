---
title: "Qiitaã‹ã‚‰Zennã«ç§»è¡Œã™ã‚‹"
emoji: "ğŸ‘‹"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["qiita", "zenn"]
published: true
date: 2021-06-19T00:00:00+09:00
---

2023/02/21 æ²è¼‰ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã®å†…ã€Qiitaã®åˆ¶é™ã«æŠµè§¦ã™ã‚‹éƒ¨åˆ†ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚(è©³ç´°ã¯[ã‚³ãƒ¡ãƒ³ãƒˆ](https://zenn.dev/link/comments/991082a51e4149)å‚ç…§)

---

ã“ã“æ•°å¹´ã€Qiita ã¯ã€Œã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã—ãŸã€ã¨è¨€ã„ã¤ã¤ä½¿ã„å‹æ‰‹ã¯ä½•ã‚‚å¤‰ã‚ã£ã¦ãªã‹ã£ãŸã‚Šã€ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã³èˆˆå‘³ã‚‚ãªã„ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®é€šçŸ¥ã‚’é€ã‚Šã¤ã‘ã¦ãã‚‹ãªã©ä½“é¨“ãŒã‚ã¾ã‚Šè‰¯ããªã„ã®ã§ Zenn ã«ç§»ã‚ã†ã¨æ€ã„ã¾ã—ãŸã€‚

## 1. Qiita ã®è¨˜äº‹ã‚’ Zenn ã«ç§»è¡Œã™ã‚‹

Qiita ã®è¨˜äº‹ã‚’ Zenn ã«ç§»ã™ã®ã¯ã€ä»¥ä¸‹ã®è¨˜äº‹ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ [ikawaha/zenn-importer](https://github.com/ikawaha/zenn-importer) ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã—ãŸã€‚

[Qiita/ã¯ã¦ãƒ–ã®è¨˜äº‹ã‚’ Zenn ã§ã‚‚ç®¡ç†ã™ã‚‹](https://zenn.dev/ikawaha/articles/20201012-e56b19cd33c396ae0465)

Qiita API ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§å…¬é–‹è¨˜äº‹ã®ä¸€è¦§ã¨ãã®å†…å®¹ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ãªã®ã§ã€Qiita ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œãªã©ã‚‚å¿…è¦ãªãã€è¨˜äº‹ã‚’ä¸€æ‹¬ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã—ãŸã€‚

## 2. Qiita ã®è¨˜äº‹ã®å†…å®¹ã‚’ Zenn ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã«æ›¸ãæ›ãˆã‚‹

å¿…é ˆã§ã¯ãªã„ã‘ã©ã€Qiita ã¨ Zenn ã«åŒã˜è¨˜äº‹ãŒæ®‹ã£ã¦ã„ã‚‹ã®ã¯å°‘ã—ãŠè¡Œå„€ãŒæ‚ªãæ„Ÿã˜ã‚‹ã®ã§ã€Qiita ã®è¨˜äº‹å†…å®¹ã‚’ Zenn ã®è¨˜äº‹ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã«æ›¸ãæ›ãˆã¦ã¾ã™ã€‚
ç§»è¡Œå…ˆã® Zenn ã®è¨˜äº‹ã® URL ã¯ã€`1.`ã®æ‰‹é †ã§ä½¿ã£ãŸ [ikawaha/zenn-importer](https://github.com/ikawaha/zenn-importer) ã®READMEã«æ›¸ã„ã¦ã‚ã‚‹è¦å‰‡ã«å¾“ã£ã¦ã„ã‚‹ãŸã‚ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®URLã‚‚æ©Ÿæ¢°çš„ã«ç”Ÿæˆå¯èƒ½ã€‚

ä¸€æ‹¬ã§æ›¸ãæ›ãˆã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã—ã¦ä¸‹è¨˜ã‚’æ›¸ã„ãŸã€‚(è¨˜äº‹å†…å®¹ã‚’æ›¸ãæ›ãˆã‚‹ãŸã‚ã€ã“ã¡ã‚‰ã®å®Ÿè¡Œã«ã¯æµçŸ³ã« Qiita ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦)
å¤ã™ãã‚‹è¨˜äº‹ã¯ç§»è¡Œã™ã‚‹ã¾ã§ã‚‚ãªã„ãªã¨æ€ã„ã€æœ€åˆã«æ›¸ã„ãŸMattermosté–¢é€£ã®è¨˜äº‹ä»¥é™ã®è¨˜äº‹ã‚’ç§»è¡Œå¯¾è±¡ã¨ã—ãŸã®ã§ã€`QiitaPerPage = 74`ã¨ã„ã†ä¸­é€”åŠç«¯ãªæ•°å­—ã«ãªã£ã¦ã„ã‚‹ã€‚

Qiitaã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ç”¨ã«`QiitaAccessToken`ã¨`QiitaUser`ã¨ã€ã©ã®è¨˜äº‹ã¾ã§ã‚’ç§»è¡Œå¯¾è±¡ã«ã™ã‚‹ã‹ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã®å®šæ•°`QiitaPerPage`ã€`QiitaMaxPage`ã‚ãŸã‚Šã‚’æ›¸ãæ›ãˆã¦å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã€å…¨ã¦ã®è¨˜äº‹ã®å†…å®¹ãŒ Zenn è¨˜äº‹ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¸æ›¸ãæ›ã‚ã‚‹ã€‚(è‡ªåˆ†ç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã®ã§å‹•ä½œã¯ä¿è¨¼ã—ã¾ã›ã‚“)

```go:main.go
package main

import (
	"bytes"
	"encoding/json"
	"fmt"
	"io/ioutil"
	"log"
	"net/http"
	"strconv"
	"time"
)

const (
	QiitaAccessToken = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
	QiitaUser        = "kaakaa_hoe"
	QiitaPerPage     = 74
	QiitaMaxPage = 1
)

type QiitaItem struct {
	CreatedAt string `json:"created_at"`
	Id        string `json:"id"`
	Title     string `json:"title"`
	Private   bool   `json:"private"`
}

type QiitaPatch struct {
	Body  string `json:"body"`
	Title string `json:"title"`
}

func main() {
	client := &http.Client{}

	var all []QiitaItem
	page := 1
	for {
		log.Printf("Get items. page %d", page)
		items, err := getItems(client, page)
		if err != nil {
			log.Fatal(err)
		}
		all = append(all, items...)
		if len(items) < QiitaPerPage {
			break
		}
		log.Println(len(items))
		page += 1
		if QiitaMaxPage < page {
			break
		}
	}

	nums := len(all)
	for i, v := range all {
		if v.Private {
			// skip private article
			continue
		}
		log.Printf("Patching article(%d/%d): %s", i+1, nums, v.Title)
		if err := patchItem(client, v); err != nil {
			log.Printf(" [ERROR] %s", err.Error())
		}
	}
}

func getItems(client *http.Client, page int) ([]QiitaItem, error) {
	req, err := http.NewRequest(http.MethodGet, "https://qiita.com/api/v2/authenticated_user/items", nil)
	if err != nil {
		return nil, err
	}

	params := req.URL.Query()
	params.Add("page", strconv.Itoa(page))
	params.Add("per_page", fmt.Sprintf("%d", QiitaPerPage))
	params.Add("query", fmt.Sprintf("user:%s", QiitaUser))
	req.URL.RawQuery = params.Encode()

	req.Header.Add("Authorization", fmt.Sprintf("Bearer %s", QiitaAccessToken))

	resp, err := client.Do(req)
	if err != nil {
		return nil, err
	}
	if resp.StatusCode != http.StatusOK {
		return nil, fmt.Errorf("failed to get items %s", resp.Status)
	}
	defer resp.Body.Close()
	b, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		return nil, err
	}

	var items []QiitaItem
	if err := json.Unmarshal(b, &items); err != nil {
		return nil, err
	}
	return items, nil
}

func patchItem(client *http.Client, item QiitaItem) error {
	t, err := time.Parse(time.RFC3339, item.CreatedAt)
	if err != nil {
		log.Fatal(err)
	}
	url := fmt.Sprintf("https://zenn.dev/kaakaa/articles/qiita-%s-%s", t.Format("20060102"), item.Id)

	b, err := json.Marshal(QiitaPatch{
		// çŸ­ã„å†…å®¹ã§ã€Œç§»è¡Œã€ã¨ã„ã†è¨€è‘‰ãŒå«ã¾ã‚Œã‚‹ã¨Qiitaã«å¼¾ã‹ã‚Œã‚‹ãŸã‚æ–‡è¨€ã‚’ä¿®æ­£
		// Body:  fmt.Sprintf("ã“ã®è¨˜äº‹ã¯ Zenn ã«ç§»è¡Œã—ã¾ã—ãŸã€‚\n%s", url),
		Body:  fmt.Sprintf("è¨˜äº‹ã®å†…å®¹ã¯ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚\n%s", url),
		Title: item.Title,
	})
	if err != nil {
		return err
	}
	req, err := http.NewRequest(http.MethodPatch, fmt.Sprintf("https://qiita.com/api/v2/items/%s", item.Id), bytes.NewBuffer(b))
	if err != nil {
		return err
	}
	req.Header.Add("Content-Type", "application/json")
	req.Header.Add("Authorization", fmt.Sprintf("Bearer %s", QiitaAccessToken))

	resp, err := client.Do(req)
	if err != nil {
		return nil
	}
	if resp.StatusCode != http.StatusOK {
		return fmt.Errorf("failed to request patch: %s", resp.Status)
	}
	return nil
}
```

ä¸Šè¨˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§Qiitaã®è¨˜äº‹ã‚’ä¸€æ‹¬ã§æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/82d211bdec1c67cbcee986c9.png)

### ç§»è¡Œè¨˜äº‹ã®æŠ•ç¨¿æ—¥æ™‚ã«ã¤ã„ã¦

ç§»è¡Œã™ã‚‹ã¨ãã«ãƒãƒƒã‚¯ã¨ãªã£ãŸç‚¹ã€‚
Zennã§ã¯Frontmatterã§å…¬é–‹æ—¥æ™‚ãªã©ã‚’æŒ‡å®šã§ããªã„ã‚ˆã†ãªã®ã§ã€Qiitaä¸Šã§ã¯å¤ã„è¨˜äº‹ã§ã‚‚Zennä¸Šã§ã¯æœ€æ–°ã®è¨˜äº‹ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã—ã¾ã†ã€‚
ãã‚Œã«ã‚ˆã‚‹å½±éŸ¿ã¯ã€è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨˜äº‹ä¸€è¦§ãŒå¤ã„ã‚‚ã®ã§åŸ‹ã‚ã‚‰ã‚Œã¦ã—ã¾ã†ã®ã¨ã€ã‚¿ã‚°(Zennã§ã¯Topics)ãŒå¤ã„è¨˜äº‹ã§æ±šæŸ“ã•ã‚Œã¦ã—ã¾ã†ã“ã¨ã€‚

å‰è€…ã«ã¤ã„ã¦ã¯ã€ä¸€æ—¦è¨˜äº‹ã‚’å…¨éƒ¨æŠ•ç¨¿ã—ã¦ã‹ã‚‰æœ€æ–°ã«ã—ãŸã„è¨˜äº‹ã¸æ›´æ–°ã‚’åŠ ãˆã‚‹ã“ã¨ã§è¨˜äº‹ã®é †åºã‚’æ“ä½œã§ãã‚‹ã‹ã¨æ€ã£ãŸã‘ã©ã€ãã‚“ãªã“ã¨ã¯ãªãæŠ•ç¨¿æ—¥æ™‚ã§æ±ºã¾ã£ã¦ã—ã¾ã†ã‚ˆã†ã ã£ãŸã€‚ã“ã“ã¯è«¦ã‚ã‚‹ã—ã‹ãªã„ã‹ãªã€‚

å¾Œè€…ã«ã¤ã„ã¦ã¯è‡ªåˆ†ä»¥å¤–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ã§å½±éŸ¿ãŒåŠã‚“ã§ã—ã¾ã†éƒ¨åˆ†ã ã‘ã©ã€è‡ªåˆ†ãŒæ›¸ã„ã¦ã„ã‚‹ã®ã¯ Mattermost ã®è¨˜äº‹ãŒå¤šãã€Mattermotã¯å¹¸ã„ (?) ã¾ã Zennä¸Šã§ã®è¨˜äº‹ã®æ•°ãŒå¤šããªã„ã®ã§ç›®ã‚’ç‘ã‚‹ã“ã¨ã«ã—ãŸã€‚é–²è¦§è€…ãŒå¤šãã†ãªTopicsã‚’ã¤ã‘ã¦ã—ã¾ã£ã¦ã‚‹å ´åˆã¯ã€ãã®Topicsã‚’å¤–ã—ã¦ãŠã„ãŸã€‚

Frontmatterã«`date`ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†è¦æœ›ã‚’å‡ºãã†ã‹ã¨ã‚‚æ€ã£ãŸã‘ã©ã€ä»Šã¯[`date`ãŒè¨­å®šã•ã‚Œã¦ã„ã¦ã‚‚ç„¡è¦–ã™ã‚‹ã¨ã„ã†å‹•ä½œã‚’ã—ã¦ã„ã‚‹ã‚ˆã†](https://github.com/zenn-dev/zenn-community/issues/254)ãªã®ã§ã€`date`ç›¸å½“ã®æƒ…å ±ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã„ã†å¤‰æ›´ã¯æ—¢å­˜ã®è¨˜äº‹ã«å¯¾ã™ã‚‹å½±éŸ¿ãŒã¨ã¦ã‚‚å¤§ããã†ãªã®ã§ã‚ã¾ã‚Šè‰¯ã„æ‰‹ã˜ã‚ƒãªã„ãªã¨æ€ã£ã¦è¦æœ›ã‚’å‡ºã™ã®ã¯ã‚„ã‚ã¾ã—ãŸã€‚
