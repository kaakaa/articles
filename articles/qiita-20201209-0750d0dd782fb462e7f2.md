---
title: "[Mattermost Integrations] Message Attachments"
date: 2020-12-09T00:00:00+09:00
emoji: "ğŸ“†"
type: "tech"
topics: ["Mattermost"]
published: true
aliases: "/post/mattermost/advent-calendar-2020/day9-message-attachments"
---

Mattermost è¨˜äº‹ã¾ã¨ã‚: https://blog.kaakaa.dev/tags/mattermost/

## æœ¬è¨˜äº‹ã«ã¤ã„ã¦

[Mattermost ã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](https://qiita.com/advent-calendar/2020/mattermost-integrations)ã®ç¬¬ 9 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€Mattermost ã®çµ±åˆæ©Ÿèƒ½ã‹ã‚‰æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹éš›ã«ã€è¦–è¦šçš„ã«ãƒªãƒƒãƒãªæŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ Message Attachments ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

https://docs.mattermost.com/developer/message-**attachments.html

## Message Attachments ã®æ¦‚è¦

Message Attachments ã¯ Mattermost ä¸Šã«ä¸‹è¨˜ã®ã‚ˆã†ãªæŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚ï¼ˆç”»åƒã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.mattermost.com/developer/message-attachments.html)ã‚ˆã‚Šï¼‰

![message attachment](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/official-example.png)

Mattermost ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ Markdown è¨˜æ³•(è¨­å®šã«ã‚ˆã£ã¦ã¯ katex è¨˜æ³•ã‚‚)ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã€ç°¡å˜ãªè¦‹å‡ºã—ã‚„ãƒªãƒ³ã‚¯ãªã©ã¯æ™®é€šã®æŠ•ç¨¿ã§è¡¨ã™ã“ã¨ãŒã§ãã¾ã™ãŒã€å¤šãã®æƒ…å ±ã‚’é€šçŸ¥ã—ãŸã„å ´åˆã€Markdown ã ã¨æƒ…å ±é‡ã®åˆ†ã ã‘æŠ•ç¨¿ãŒç¸¦ã«ä¼¸ã³ã¦ã„ã£ã¦ã—ã¾ã†ãŸã‚è¦–èªæ€§ãŒæ‚ªã„ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚
ãã®ã‚ˆã†ãªå ´åˆã« Message Attachments ã‚’ä½¿ã†ã“ã¨ã§ã€ã‚ˆã‚Šæ§‹é€ åŒ–ã•ã‚ŒãŸæƒ…å ±ã‚’ Mattermost ä¸Šã«æŠ•ç¨¿ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

Message Attachments ã¯ã€ä»Šã¾ã§ç´¹ä»‹ã—ã¦ããŸ Incoming WebHook ã‚„ Slash Commandã€ä»Šå¾Œç´¹ä»‹äºˆå®šã® REST API ã‚„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãªã©ã€Mattermost ã¸æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹å¤šãã®å ´åˆã§ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»Šå›ã¯ã€Incoming WebHook ã‚’åˆ©ç”¨ã—ã¦ Message Attachments ã‚’ä½œæˆã™ã‚‹ä¾‹ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

## Message Attachments ã®ä½œæˆ

ã¾ãšã€Incoming WebHook(å†…å‘ãã®ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯)ã®ãŠã•ã‚‰ã„ã§ã™ã€‚
Incoming WebHook ã§ã¯ã€ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ä¸‹è¨˜ã®ã‚ˆã†ãª JSON ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ã€Mattermost ã«æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```bash
BODY='{
  "text": "Hello, Mattermost"
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

Message Attachments ã‚’ä½¿ã†å ´åˆã€é€ä¿¡ã™ã‚‹ JSON ãƒ‡ãƒ¼ã‚¿ã«`attachment`ã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™

```bash
BODY='{
  "text": "Hello, Mattermost",
  "attachments": [{
    "color": "#FF6600",
    "text": "message attachments",
    "title": "This is title",
    "title_link": "https://github.com/mattermost"
  },{
    "color": "#0066FF",
    "text": "message attachments2",
    "title": "This is title",
    "title_link": "https://github.com/mattermost"
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€é€šå¸¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸‹ã« Message Attachments ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![example](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/first-example.png)

`attachments`ã¯è¤‡æ•°æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã€è¤‡æ•°æŒ‡å®šã—ãŸå ´åˆã¯ä¸Šè¨˜ã®ã‚ˆã†ã«ç¸¦ã«ä¸¦ã‚“ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ä»¥é™ã¯ã€`attachmenst`ã«æŒ‡å®šã§ãã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã€ãã®åŠ¹æœã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

### Attachments Options

#### fallback

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä½œæˆã•ã‚ŒãŸéš›ã®é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¾ã™ã€‚

![use fallback](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-fallback1.png)

```bash
BODY='{
  "attachments": [{
    "fallback": "This is fallback"
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

ä½•ã‚‚æŒ‡å®šã—ãªã„å ´åˆã¯ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![default fallback](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-fallback2.png)

#### color

Message Attachments ã®å·¦å´ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ©ã‚¤ãƒ³ã®è‰²ã‚’æŒ‡å®šã—ã¾ã™ã€‚

![use color](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-color.png)

```bash
BODY='{
  "attachments": [{
    "color": "#FF6600"
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

#### pretext

Message Attachments é ˜åŸŸã®ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚Markdown ã‚„çµµæ–‡å­—ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚

![use pretext](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-pretext.png)

```bash
BODY='{
  "attachments": [{
    "pretext": "This is `pretext`"
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

`attachments`ã¨åŒæ™‚ã«`text`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒ‡å®šã—ãŸå ´åˆã€ä¸¡æ–¹ã®ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ã¾ãŸã€`attachments`ã‚’è¤‡æ•°æŒ‡å®šã—ã¦ã„ãŸå ´åˆã€`pretext`ã¯ Message Attachments ã®å‰ã«ãã‚Œãã‚Œè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```bash
BODY='{
  "text": "This is `text`",
  "attachments": [{
    "pretext": "This is first `pretext`"
  },{
    "pretext": "This is second `pretext`"
  }]
}'
```

![use pretext](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-pretext2.png)

#### text

Message Attachments é ˜åŸŸå†…ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆã§ã™ã€‚ã“ã¡ã‚‰ã‚‚ Markdown ã‚„çµµæ–‡å­—ã‚’åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

![use text](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-text.png)

```bash
BODY='{
  "attachments": [{
    "text": "## This is `text` :smiley: \n**Markdown** can be used."
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

### Author Details

#### author_name / author_link / author_icon

Message Attachments ã®ä½œæˆè€…æƒ…å ±ã‚’æŒ‡å®šã—ã¾ã™ã€‚

![use author](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-author.png)

```bash
BODY='{
  "attachments": [{
    "author_name": "kaakaa",
    "author_link": "https://github.com/kaakaa",
    "author_icon": "https://blog.kaakaa.dev/images/avatar.png",
    "text": "Author Details"
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

- `author_name`: `attachments`ã®ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ä½œæˆè€…ã®åå‰ã‚’æŒ‡å®šã—ã¾ã™
- `author_link`: `attachments`ã®ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ä½œæˆè€…ã®åå‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®ãƒªãƒ³ã‚¯ã‚’æŒ‡å®šã—ã¾ã™
- `author_icon`: `attachments`ã®ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ä½œæˆè€…ã®ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã® URL ã‚’æŒ‡å®šã—ã¾ã™

### Titles

#### title / title_link

![use title](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-title.png)

```bash
BODY='{
  "attachments": [{
    "title": "Attachment Title",
    "title_link": "https://github.com/kaakaa",
    "text": "Titles"
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

- `title`: `attachments`ã®ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŒ‡å®šã—ã¾ã™
- `title_link`: `attachments`ã®ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®ãƒªãƒ³ã‚¯ã‚’æŒ‡å®šã—ã¾ã™

Author Details ã¨åŒæ™‚ã«æŒ‡å®šã—ãŸå ´åˆã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ãªè¦‹ãŸç›®ã«ãªã‚Šã¾ã™ã€‚

![use title](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-title2.png)

### Fields

#### title / value / short

Message Attachments ã®å†…å®¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚

![use fields](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-fields.png)

```bash
BODY='{
  "attachments": [{
    "text": "Fields"
    "fields": [{
      "title": "Short Field :one:",
      "value": "This is first **short** field. This is first **short** field. This is first **short** field. This is first **short** field. This is first **short** field. ",
      "short": true
    }, {
      "title": "Short Field :two:",
      "value": "This is second **short** field. This is second **short** field. This is second **short** field. This is second **short** field. This is second **short** field. ",
      "short": true
    }, {
      "title": "Long Field :one:",
      "value": "This is first **long** field. This is first **long** field. This is first **long** field. This is first **long** field. This is first **long** field. ",
      "short": false
    }, {
      "title": "Long Field :two:",
      "value": "This is second **long** field. This is second **long** field. This is second **long** field. This is second **long** field. This is second **long** field. ",
      "short": false
    }],
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

- `title`: Fields ã®ã‚¿ã‚¤ãƒˆãƒ«éƒ¨åˆ†ã‚’æŒ‡å®šã—ã¾ã™ã€‚çµµæ–‡å­—ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚
- `value`: Fields ã®`title`ã«ç¶šãæ–‡å­—ã‚’æŒ‡å®šã—ã¾ã™ã€‚Markdown å½¢å¼ã§è¨˜è¿°ã§ãã¾ã™ã€‚
- `short`: Field ã®é•·ã•ã‚’ short ã«ã™ã‚‹ã‹ã©ã†ã‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚`"short": true`ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ï¼‘è¡Œã«ï¼’ã¤ã® Field ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚

### Images

#### image_url / thumb_url

Message Attachment ã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»åƒã® URL ã‚’æŒ‡å®šã—ã¾ã™.

![use images](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-images.png)

```bash
BODY='{
  "attachments": [{
    "text": "Images",
    "fields": [
      {"title": "Long Field", "value": "This is a long field", "short": false},
      {"title": "Short Field", "value": "This is a short field", "short": true},
      {"title": "Short Field", "value": "This is a short field", "short": true},
      {"title": "Short Field", "value": "This is a short field", "short": true}
    ],
    "image_url": "https://blog.kaakaa.dev/images/avatar.png",
    "thumb_url": "https://blog.kaakaa.dev/images/avatar.png"
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

- `image_url`: `text`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨`fields`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é–“ã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»åƒã® URL ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒãƒŠãƒ¼ã‚„ãƒãƒ£ãƒ¼ãƒˆã®ã‚ˆã†ãªæ¨ªé•·ã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ã®ã«é©ã—ã¦ã—ã¾ã™ã€‚
- `thumb_url`: Message Attachments ã®å³ä¸Šç«¯ã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»åƒã® URL ã‚’æŒ‡å®šã—ã¾ã™ã€‚

### Footer

#### footer / footer_link

Message Attachments ã®ãƒ•ãƒƒã‚¿ãƒ¼æƒ…å ±ã‚’æŒ‡å®šã—ã¾ã™ã€‚

![use footer](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day9/example-footer.png)

```bash
BODY='{
  "attachments": [{
    "text": "Footer",
    "footer": "sample footer",
    "footer_icon": "https://blog.kaakaa.dev/images/avatar.png"
  }]
}'

curl \
  -H "Content-Type: application/json" \
  -d "$BODY"  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

## æ—¢çŸ¥ã®å•é¡Œ

2020/11 æœˆæ™‚ç‚¹ã§ã¯ã€ä¸‹è¨˜ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚

- `Footer`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—(`ts`)ã«å¯¾å¿œã—ã¦ã„ãªã„
- Message Attachment ã®å†…å®¹ã¯ Mattermost ã®æ¤œç´¢æ©Ÿèƒ½ã§æ¤œç´¢ã§ããªã„

## ã•ã„ã”ã«

Message Attachments ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
æ˜æ—¥ã¯ã€Mattermost ã® REST API ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚
