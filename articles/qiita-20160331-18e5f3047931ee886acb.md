---
title: "Gradleã§bowerã‚’åˆ©ç”¨ã—ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ã¾ã§ã‚’è¡Œã†æ–¹æ³•  (5/6)"
date: 2016-03-31T02:00:00+09:00
emoji: "ğŸ“£"
type: "tech"
topics: [Java, gradle, grunt, bower, Docker]
published: false
---

# ã¯ã˜ã‚ã«

Java/Spark ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® Gradle ã‚’åˆ©ç”¨ã—ãŸãƒ“ãƒ«ãƒ‰/ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¤ã„ã¦ã€ç§ãŒè©¦ã—ãŸã“ã¨ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚
(ã“ã“ã§è¨€ã†`Spark`ã¯ã€åˆ†æ•£å‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®`Apache Spark`ã§ã¯ãªãã€Java ã® Sinatra ãƒ©ã‚¤ã‚¯ãª Microframework ã®`Spark`ã®ã“ã¨ã§ã™)

## ç›®æ¬¡

1. [Hello World ã‚¢ãƒ—ãƒª](http://qiita.com/kaakaa_hoe/items/0e3c622ae8bde3d116ad)
2. [jade ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³](http://qiita.com/kaakaa_hoe/items/6d4311e250df89f836b9)
3. [Grunt/bower ã«ã‚ˆã‚‹ Web ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰](http://qiita.com/kaakaa_hoe/items/61b326dcc5d7f161ff28)
4. [ä»˜éŒ² A. TravisCI ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰](http://qiita.com/kaakaa_hoe/items/373a5a8718c92676771f)
5. **ä»˜éŒ² B. Gradle ã§ docker build**
6. [ä»˜éŒ² C. TravisCI ã‹ã‚‰ DockerHub ã¸ docker push](http://qiita.com/kaakaa_hoe/items/87221df2dfe6b894b2b7)

å„ç« ã§ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ [Commits Â· kaakaa/gradle-frontend-boilerplate](https://github.com/kaakaa/gradle-frontend-boilerplate/commits/master) ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

## ç’°å¢ƒ

- Java 1.8.0_74
- Gradle 2.12
- spark-core 2.3
- spark-template-jade 2.3
- node.js 4.4.0

# ä»˜éŒ² B. Gradle ã§ docker build

## æ¦‚è¦

[bmuschko/gradle-docker-plugin](https://github.com/bmuschko/gradle-docker-plugin)ã‚’ä½¿ã£ã¦ã€Gradle ã‹ã‚‰`docker build`ã‚’å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã™ã‚‹ã€‚

## æº–å‚™

ä¸‹è¨˜ã‚’å®Ÿæ–½ã—ã¦ãŠãã€‚

- docker ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
- `unix:///var/run/docker.sock`ã§ Docker Remote API ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
  - [Remote API](https://docs.docker.com/engine/reference/api/docker_remote_api/)

## å®Ÿè¡Œ

```
git clone https://github.com/kaakaa/gradle-frontend-boilerplate.git
cd gradle-frontend-boilerplate
git checkout sec_B

./gradlew buildDockerImage
```

## ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

é•·ããªã£ã¦ããŸã®ã§æ»ã„æ‘˜ã‚“ã§ã€‚

```groovy:build.gradle
plugins {
    id 'java'
    id 'application'
    id 'com.moowork.grunt' version '0.11'
    id 'com.moowork.node' version '0.11'
    id 'com.bmuschko.docker-remote-api' version '2.6.6'  // (1) - Gradleã‹ã‚‰Dockerã‚’æ“ä½œã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¿½åŠ ã™ã‚‹
}

...


/** For docker build */
docker {
    url = 'unix:///var/run/docker.sock'  // (2) - Docker Remote APIã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã™ã‚‹
}

import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage

task buildDockerImage(type: DockerBuildImage) {  // (3) - docker buildã‚’å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã™ã‚‹
    dependsOn clean, installDist  // (4) - docker buildã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã‚¿ã‚¹ã‚¯ã¸ã®ä¾å­˜ã‚’å®£è¨€ã™ã‚‹
    inputDir = rootDir
    tag = 'kaakaa/gradle-frontend-boilerplate'
}

/** Other settings */
task wrapper(type: Wrapper) {
    gradleVersion = '2.12'
}
```

### (1) Gradle ã‹ã‚‰ Docker ã‚’æ“ä½œã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¿½åŠ ã™ã‚‹

ä»Šå›ã¯[bmuschko/gradle-docker-plugin: Gradle plugin for managing Docker images and containers.](https://github.com/bmuschko/gradle-docker-plugin)ã‚’ä½¿ã†ã€‚
Gradle ã§ Docker æ“ä½œã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€åŒã˜ãã‚‰ã„ã®ã‚¹ã‚¿ãƒ¼æ•°ã§ã„ãã¤ã‚‚ã‚ã‚‹ã®ã§ãƒ‡ãƒ•ã‚¡ã‚¯ãƒˆãŒç„¡ã„æ„Ÿã˜â€¦

- [Transmode/gradle-docker: A Gradle plugin to build Docker images from the build script.](https://github.com/Transmode/gradle-docker)
- [gesellix/gradle-docker-plugin: Gradle Docker plugin](https://github.com/gesellix/gradle-docker-plugin)

### (2) Docker Remote API ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã™ã‚‹

äºˆã‚èµ·å‹•ã—ã¦ã„ãŸ Docker Remote API ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã™ã‚‹

### (3) docker build ã‚’å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã™ã‚‹

`bmuschko/gradle-docker-plugin`ã®ãŠä½œæ³•é€šã‚Šã€`docker build`ã‚’å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©ã™ã‚‹ã€‚
tag åã¯ãŠå¥½ã¿ã§ã€‚

### (4) docker build ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã‚¿ã‚¹ã‚¯ã¸ã®ä¾å­˜ã‚’å®£è¨€ã™ã‚‹

`installDist`ã‚¿ã‚¹ã‚¯ã®æˆæœç‰©ã‚’ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å«ã‚ã‚‹ãŸã‚ã€`buildDockerImage`ã‚¿ã‚¹ã‚¯ãŒ`installDist`ã‚¿ã‚¹ã‚¯ã®ã‚ã¨ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†è¨­å®šã—ã¦ã„ã‚‹ã€‚

## ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ(Dockerfile)

```docker:Dockerfile
FROM java

ADD build/install/gradle-frontend-boilerplate /usr/local/src

ENTRYPOINT ["sh", "-c", "/usr/local/src/bin/gradle-frontend-boilerplate"]
```

`installDist`ã®æˆæœç‰©ã‚’ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®`/usr/local/src`ã«è¿½åŠ ã—ã€èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã® Dockerfile ã§ã™ã€‚
