---
title: "[Mattermost Integrations] Incoming WebHook ç™ºå±•ç·¨"
date: 2020-12-03T00:00:00+09:00
emoji: "ğŸ“†"
type: "tech"
topics: ["Mattermost"]
published: true
---

Mattermost è¨˜äº‹ã¾ã¨ã‚: https://blog.kaakaa.dev/tags/mattermost/

## æœ¬è¨˜äº‹ã«ã¤ã„ã¦

Mattermost ã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ç¬¬ 3 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

å‰å›ã®è¨˜äº‹ã§ã¯ã€å¤–éƒ¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ Mattermost ã®æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ Incoming WebHook(å†…å‘ãã®ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯)ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸãŒã€æœ¬è¨˜äº‹ã¯ãã®ç¶šãã§ã™ã€‚Incoming WebHook ã‚’ä½œæˆã™ã‚‹éš›ã«åˆ©ç”¨ã§ãã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

## Incoming WebHook ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

### `text`

Incoming WebHook ã‚’é€šã˜ã¦æŠ•ç¨¿ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚ã‚Šã€å¾Œè¿°ã®`attachments`ã‚’æŒ‡å®šã—ãªã„å ´åˆã¯å¿…é ˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚Markdown è¨˜æ³•ã‚„ã€`@`ã«ã‚ˆã‚‹ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’æŠ•ç¨¿ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```bash
curl \
  -H "Content-Type: application/json" \
  -d '{"text": "## Test\n@channel\n* foo\n* bar"}'  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

![use text](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day3/example-text.png)

### `channel`

æŠ•ç¨¿å…ˆã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã“ã§æŒ‡å®šã™ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«åã¯ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«è¡¨ç¤ºåã§ãªãã€URL ã¨ã—ã¦ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«åã«ãªã‚‹ç‚¹ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

![channel name](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day3/channel-name.png)

ã¾ãŸã€`@kaakaa`ã®ã‚ˆã†ã«ã€`@`+ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’æŒ‡å®šã™ã‚‹ã¨ DM(ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)ã¨ã—ã¦æŠ•ç¨¿ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚`channel`ã‚’æŒ‡å®šã—ãªã„å ´åˆã€Incoming WebHook ä½œæˆæ™‚ã«æŒ‡å®šã—ãŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ£ãƒ³ãƒãƒ«ã«æŠ•ç¨¿ã•ã‚Œã¾ã™ã€‚

```bash
curl \
  -H "Content-Type: application/json" \
  -d '{"text": "Sample Message", "channel": "incoming-webhook"}'  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

![use channel](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day3/example-channel.png)

Incoming WebHook ä½œæˆæ™‚ã«`ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã«å›ºå®šã™ã‚‹`ã«ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¦ã„ãŸå ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒ£ãƒ³ãƒãƒ«ä»¥å¤–ã«æŠ•ç¨¿ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ 403 ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```bash
$ curl \
>   -H "Content-Type: application/json" \
>   -d '{"text": "Sample Message", "channel": "incoming-webhook"}'  \
>   http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr

{"id":"web.incoming_webhook.channel_locked.app_error","message":"This webhook is not permitted to post to the requested channel.","detailed_error":"","request_id":"qe3eyht563d1b8xani3g93dgfh","status_code":403}
```

### `username`

### `icon_url`

`username`ã¨`icon_url`ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€Incoming WebHook ã‚’å®Ÿè¡Œã—ã¦ä½œæˆã•ã‚Œã‚‹æŠ•ç¨¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã‚¢ã‚¤ã‚³ãƒ³ã®è¡¨ç¤ºã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ä¸‹è¨˜ã®è¨­å®šã‚’ãã‚Œãã‚Œ`æœ‰åŠ¹`ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- **ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ« > çµ±åˆæ©Ÿèƒ½ç®¡ç† > çµ±åˆæ©Ÿèƒ½ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ä¸Šæ›¸ãã‚’è¨±å¯ã™ã‚‹**
- **ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ« > çµ±åˆæ©Ÿèƒ½ç®¡ç† > çµ±åˆæ©Ÿèƒ½ã«ã‚ˆã‚‹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚¢ã‚¤ã‚³ãƒ³ã®ä¸Šæ›¸ãã‚’è¨±å¯ã™ã‚‹**

![config overwrite](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day3/config-overwrite.png)

ï¼ˆã“ã®è¨­å®šã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€`username`ã¨`icon_url`ã‚’æŒ‡å®šã—ãªã„å ´åˆã®æŠ•ç¨¿ã®ä½œæˆè€…ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ã‚¤ã‚³ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å(`webhook`)ã«å¤‰æ›´ã•ã‚Œã¾ã™ï¼‰

```bash
curl \
  -H "Content-Type: application/json" \
  -d '{"text": "Sample Message", "username": "new-bot", "icon_url": "http://www.mattermost.org/wp-content/uploads/2016/04/icon_WS.png"}'  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

![user overwrite](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day3/example-overwrite.png)

ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚¢ã‚¤ã‚³ãƒ³ã®ä¸Šæ›¸ãã‚’è¨±å¯ã™ã‚‹ã¨ã€Incoming WebHook ä½œæˆç”»é¢ã«ã‚‚`ãƒ¦ãƒ¼ã‚¶ãƒ¼å`ã€`ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ`ã®æŒ‡å®šç”»é¢ãŒç¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![create with overwrite](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day3/create-with-overwrite.png)

### `icon_emoji`

`icon_url`ã§ã¯ã€ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã«ä½¿ç”¨ã™ã‚‹ç”»åƒã® URL ã‚’æŒ‡å®šã—ã¾ã—ãŸãŒã€`icon_emoji`ã‚’ä½¿ã†ã“ã¨ã§ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã«çµµæ–‡å­—ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```bash
curl \
  -H "Content-Type: application/json" \
  -d '{"text": "Sample Message", "username": "new-bot", "icon_url": "http://www.mattermost.org/wp-content/uploads/2016/04/icon_WS.png", "icon_emoji": "smiley"}'  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

![use icon-emoji](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day3/example-icon-emoji.png)

`icon_url`ã¨`icon_emoji`ã‚’åŒæ™‚ã«æŒ‡å®šã™ã‚‹ã¨ã€`icon_emoji`ã®æ–¹ãŒæ¡ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

### `attachments`

`attachments`ã¯ã€Mattermost ã«ãƒªãƒƒãƒãªæŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹[MessageAttachments](https://docs.mattermost.com/developer/message-attachments.html)ã‚’æŒ‡å®šã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚[MessageAttachments](https://docs.mattermost.com/developer/message-attachments.html)ã«ã¤ã„ã¦ã¯ã€ç¬¬ 9 æ—¥ç›®ã®è¨˜äº‹ã§ç´¹ä»‹ã—ã¾ã™ã€‚

### `type`

`type`ã¯ã€Mattermost ã®æŠ•ç¨¿ã®ç¨®åˆ¥ã‚’æŒ‡å®šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ãŒã€åŸºæœ¬çš„ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Plugin(Webapp)ã«ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç‹¬è‡ªã®æŠ•ç¨¿ç¨®åˆ¥ã‚’æŒ‡å®šã—ãŸå ´åˆã®ã¿ã«ä½¿ç”¨ã™ã‚‹ã‚‚ã®ã‹ã¨æ€ã„ã¾ã™ã€‚Plugin(Webapp)ã«ã¤ã„ã¦ã¯ã€ç¬¬ 20 æ—¥ç›®ä»¥é™ã®è¨˜äº‹ã§ç´¹ä»‹ã—ã¾ã™ã€‚

### `props`

`props`ã¯æŠ•ç¨¿ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹å ´æ‰€ã§ã‚ã‚Šã€ä»–ã®çµ±åˆæ©Ÿèƒ½ã‹ã‚‰åˆ©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€åŸºæœ¬çš„ã«æ±ºã¾ã£ãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ãªã©ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`card`ã¨ã„ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ç‰¹åˆ¥ã§ã€`card`ã«æ ¼ç´ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¯ã€ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã«ã‚ˆã‚Šä½œæˆã•ã‚ŒãŸæŠ•ç¨¿ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ Mattermost ã®ç”»é¢ä¸Šã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
curl \
  -H "Content-Type: application/json" \
  -d '{"text": "Sample Message", "props": {"card": "## Sample\n* foo\n* bar"}}'  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

![use card](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day3/example-card.png)

`props.card`ã‚’æŒ‡å®šã—ã¦ä½œæˆã•ã‚ŒãŸæŠ•ç¨¿ã«ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ˜ãƒƒãƒ€éƒ¨åˆ†ã« `i` ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€`i` ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«`props.card`ã«æŒ‡å®šã—ãŸãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`props.card`ã«ã¯ Markdown ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€`@`ã«ã‚ˆã‚‹ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚(ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªã¯ã§ãã¾ã™)

Incoming WebHook ã«ã‚ˆã‚‹æŠ•ç¨¿ãŒé•·ããªã£ã¦ã—ã¾ã†å ´åˆãªã©ã«æœ‰åŠ¹ã ã¨æ€ã„ã¾ã™ã€‚

ãŸã ã—ã€`card`ã«ã‚ˆã‚‹æŠ•ç¨¿ã¯ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‹ã‚‰ã¯ç¢ºèªã§ããªã„ç‚¹ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ã¾ãŸã€`card`ã¯ Mattermost v5.14 ã‹ã‚‰åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

## ã•ã„ã”ã«

Incoming WebHook ã®è©³ç´°ãªä½¿ã„æ–¹ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
æ˜æ—¥ã‹ã‚‰ã¯ã€Outgoing WebHook ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚
