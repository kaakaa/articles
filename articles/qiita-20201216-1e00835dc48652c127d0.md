---
title: "[Mattermost Integrations] Interactive Dialog"
date: 2020-12-16T00:00:00+09:00
emoji: "ğŸ“†"
type: "tech"
topics: ["Mattermost"]
published: true
---

Mattermost è¨˜äº‹ã¾ã¨ã‚: https://blog.kaakaa.dev/tags/mattermost/

## æœ¬è¨˜äº‹ã«ã¤ã„ã¦

[Mattermost ã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](https://qiita.com/advent-calendar/2020/mattermost-integrations)ã®ç¬¬ 16 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€Mattermost ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ Interactive Dialog ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

## Interactive Dialog ã®æ¦‚è¦

Interactive Dialog ã¯ã€Slash Command ã‚„ Interactive Message ãªã©ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’èµ·ç‚¹ã«ã€Mattermost ä¸Šã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°(ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦)ã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

![official example](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day16/official-example.png)
(ç”»åƒã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.mattermost.com/developer/interactive-dialogs.html)ã‹ã‚‰)

Interactive Dialog ã«é–¢ã™ã‚‹å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚

- https://docs.mattermost.com/developer/interactive-dialogs.html

Interactie Dialog ã¯ã€ä½•åº¦ã‹ Mattermost ã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã—ãªãŒã‚‰å‹•ä½œã™ã‚‹ã‚‚ã®ã®ãŸã‚ã€å‹•ä½œãŒè¤‡é›‘ã«ãªã‚Šã¾ã™ã€‚ä»Šã¾ã§ã®ã‚ˆã†ã«`curl`ã ã‘ã§å‹•ä½œã•ã›ã‚‹ã“ã¨ã¯é›£ã—ã„ãŸã‚ã€Go ã®ã‚³ãƒ¼ãƒ‰ã§æ›¸ã„ãŸã‚‚ã®ã‚’æ–­ç‰‡çš„ã«ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

ä»Šå›ã¯ã€Interactive Dialog ã®å…¥åŠ›å†…å®¹ã‹ã‚‰ Message Attachments ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã‚ˆã†ãªä¾‹ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚

### Trigger ID ã®å–å¾—

Interactive Dialog ã‚’èµ·å‹•ã™ã‚‹ã«ã¯ã€ã¾ãšã€Mattermost å†…éƒ¨ã§ç”Ÿæˆã•ã‚Œã‚‹ Trigger ID ã¨ã„ã†ã‚‚ã®ãŒå¿…è¦ã§ã™ã€‚Trigger ID ã¯ Slash Command ã‚„ Interactive Message ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸæ™‚ã«ã€Mattermost ã‹ã‚‰é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚Slash Command å®Ÿè¡Œæ™‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ Trigger ID ã‚’å–å¾—ã™ã‚‹å ´åˆã€Slash Command å®Ÿè¡Œæ™‚ã«é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã« Trigger ID ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```go
	http.HandleFunc("/command", func(w http.ResponseWriter, r *http.Request) {
		r.ParseForm()

		// (1) Slash Commandå®Ÿè¡Œæ™‚ã«é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ "Trigger ID" ã‚’å–å¾—
		triggerId := r.Form.Get("trigger_id")

		...
```

Interactive Message Button ãªã©ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å–å¾—ã™ã‚‹éš›ã¯ã€[`PostActionIntegrationRequest.TriggerId`](https://github.com/mattermost/mattermost-server/blob/master/model/integration_action.go#L173)ã‹ã‚‰ Trigger ID ã‚’å–å¾—ã§ãã¾ã™ã€‚

### Interactive Dialog ã®èµ·å‹•

å…ˆã»ã©å–å¾—ã—ãŸ Trigger ID ã‚’ä½¿ã£ã¦ã€Mattermost ã¸ Interactive Dialog èµ·å‹•ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¾ã™ã€‚
Trigger ID ã‚’å–å¾—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã«ç¶šã‘ã¦ã€[`/api/v4/actions/dialogs/open`](https://api.mattermost.com/#tag/integration_actions/paths/~1actions~1dialogs~1open/post)ã«[`OpenDialogRequest`](https://github.com/mattermost/mattermost-server/blob/master/model/integration_action.go#L224)ã§å®šç¾©ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ Interactive Dialog ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```go
	http.HandleFunc("/command", func(w http.ResponseWriter, r *http.Request) {
		r.ParseForm()

		// (1) Slash Commandå®Ÿè¡Œæ™‚ã«é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ "Trigger ID" ã‚’å–å¾—
		triggerId := r.Form.Get("trigger_id")

		// (2) Interactive Dialogã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ§‹ç¯‰
		request := model.OpenDialogRequest{
			TriggerId: triggerId,
			URL:       "http://localhost:8080/actions/dialog",
			Dialog: model.Dialog{
				Title: "Sample Interactive Dialog",
				Elements: []model.DialogElement{{
					DisplayName: "Title",
					Name:        "title",
					Type:        "text",
				}, {
					DisplayName: "Message",
					Name:        "message",
					Type:        "textarea",
				}},
			},
		}

		// (3) Interactive Dialogã‚’é–‹ã
		b, _ := json.Marshal(request)
		req, _ := http.NewRequest(http.MethodPost, "http://localhost:8065/api/v4/actions/dialogs/open", bytes.NewReader(b))
		req.Header.Add("Content-Type", "application/json")
		resp, err := http.DefaultClient.Do(req)

		...
```

`(2)`ã§æ§‹ç¯‰ã—ã¦ã„ã‚‹`OpenDialogRequest`ã«ã©ã®ã‚ˆã†ãªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã¨ã„ã†æƒ…å ±ã‚‚æŒ‡å®šã™ã‚‹ã®ã§ã™ãŒã€è©³ã—ãã¯å¾Œè¿°ã—ã¾ã™ã€‚
`(3)`ã§[`/actions/dialogs/open`](https://api.mattermost.com/#tag/integration_actions/paths/~1actions~1dialogs~1open/post)ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã„ã¾ã™ãŒã€ã“ã“ã§ã¯ AccessToken ãªã©ãŒå¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã¯ Trigger ID è‡ªä½“ã®åˆ©ç”¨å¯èƒ½æœŸé™ãŒ 3 ç§’ã¨çŸ­ãã€æ‚ªç”¨ã®å¿ƒé…ãŒãªã„ãŸã‚ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚ã“ã®ç‚¹ã¯ã€Trigger ID ã‚’å–å¾—ã—ã¦ã‹ã‚‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ãå‰ã«æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ãªã©ã‚’å…¥ã‚Œãªã„ã‚ˆã†æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã‚‚æ„å‘³ã—ã¾ã™ã€‚

`/actions/dialogs/open`ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã¨ã€Mattermost ä¸Šã§ Interactive Dialog ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![video](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day16/interactive-dialog.gif)

#### Interactive Dialog èµ·å‹•æ™‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

Interactive Dialog ã‚’èµ·å‹•ã™ã‚‹éš›ã«é€ä¿¡ã™ã‚‹[`OpenDialogRequest`](https://github.com/mattermost/mattermost-server/blob/master/model/integration_action.go#L224)ã«ä¸ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚

- `TriggerId`: Slash Command ã‚„ Interactive Message ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸæ™‚ã« Mattermost å†…éƒ¨ã§ç”Ÿæˆã•ã‚Œã‚‹ Interactive Dialog èµ·å‹•ç”¨ã® ID ã‚’æŒ‡å®šã—ã¾ã™
- `URL`: Interactive Dialog ã«å…¥åŠ›ã•ã‚ŒãŸæƒ…å ±ã®é€ä¿¡å…ˆ URL ã‚’æŒ‡å®šã—ã¾ã™
- `Dialog`: Interactive Dialog ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹è¦ç´ ã‚’æŒ‡å®šã—ã¾ã™
  - `CallbackId`: çµ±åˆæ©Ÿèƒ½ã§è¨­å®šã•ã‚Œã‚‹ ID ã§ã™ã€‚Slash Command ã®å ´åˆã¯`CommandArgs.RootId`ã€Interactive Message ã®å ´åˆã¯`PostActionIntegrationRequest.PostId`ã‚’æŒ‡å®šã—ã¦ã„ã‚‹æ°—ãŒã—ã¾ã™ãŒã€ä½•ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹ã¯ã„ã¾ã„ã¡ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚
  - `Title`: Interactive Dialog ã®ã‚¿ã‚¤ãƒˆãƒ«éƒ¨åˆ†ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒ‡å®šã—ã¾ã™
  - `IntroductionText`: `Title`ã®ä¸‹ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®èª¬æ˜æ–‡ã‚’æŒ‡å®šã—ã¾ã™
  - `IconURL`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã® URL ã‚’æŒ‡å®šã—ã¾ã™
  - `SubmitLabel`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®æ±ºå®šãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®šã—ã¾ã™
  - `NotifyOnCancel`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã«ã€ã‚µãƒ¼ãƒãƒ¼ã«ãã®æ—¨ã‚’é€šçŸ¥ã™ã‚‹ã‹ã‚’é¸æŠã—ã¾ã™ã€‚`true`ã®å ´åˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«é€šçŸ¥ãŒã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œã¾ã™
  - `State`: çµ±èªæ©Ÿèƒ½ã«ã‚ˆã£ã¦å‡¦ç†ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ãŸã„å ´åˆã«è¨­å®šã•ã‚Œã‚‹ä»»æ„ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™
  - `Elements`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä¸Šã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚åˆ©ç”¨å¯èƒ½ãª`Element`ã«ã¤ã„ã¦ã¯[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.mattermost.com/developer/interactive-dialogs.html#elements)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Interactive Dialog ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡

Interactive Dialog ã®é€ä¿¡ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨ã€`OpenDialogRequest`ã®`URL`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æŒ‡å®šã—ãŸ URL ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

```go
		// (2) Interactive Dialogã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ§‹ç¯‰
		request := model.OpenDialogRequest{
			TriggerId: triggerId,
			URL:       "http://localhost:8080/actions/dialog",
			...
```

é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ Mattermost ã®ã‚³ãƒ¼ãƒ‰ã§ã¯[`SubmitDialogRequest`](https://github.com/mattermost/mattermost-server/blob/dc1b42390b9bca393d03e2ccdbb16d66cd866431/model/integration_action.go#L230)ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

```go
type SubmitDialogRequest struct {
	Type       string                 `json:"type"`
	URL        string                 `json:"url,omitempty"`
	CallbackId string                 `json:"callback_id"`
	State      string                 `json:"state"`
	UserId     string                 `json:"user_id"`
	ChannelId  string                 `json:"channel_id"`
	TeamId     string                 `json:"team_id"`
	Submission map[string]interface{} `json:"submission"`
	Cancelled  bool                   `json:"cancelled"`
}
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ Interactive Dialog ä¸Šã§å…¥åŠ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯ `Submission` ã«æ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚`Submission`ã¯`OpenDialogRequest`å†…ã®`DialogElement`ã®`Name`ã‚’ keyã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ value ã¨ã—ãŸ map å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚

ä»Šå›ã® Interactive Dialog ã§ã¯ã€`title`ã¨`message`ã¨ã„ã†`Name`ã‚’æŒã¤`DialogElement`ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ãŸã‚ã€`Submission`ã‹ã‚‰ã¯ã“ã‚Œã‚‰ã®å€¤ã‚’ã‚­ãƒ¼ã¨ã™ã‚‹ Value ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚

```go
...
Elements: []model.DialogElement{{
	DisplayName: "Title",
	Name:        "title",
	Type:        "text",
}, {
	DisplayName: "Message",
	Name:        "message",
	Type:        "textarea",
}},
...
```

ä»¥ä¸Šã‚ˆã‚Šã€Interactive Dialog ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã€å…¥åŠ›å†…å®¹ã‹ã‚‰ Message Attachment ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```go
...
	http.HandleFunc("/actions/dialog", func(w http.ResponseWriter, r *http.Request) {
		defer r.Body.Close()

		// (4) ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å‡ºã—
		b, _ := ioutil.ReadAll(r.Body)
		var payload model.SubmitDialogRequest
		json.Unmarshal(b, &payload)

		title, ok := payload.Submission["title"].(string)
		if !ok {
			resp := model.SubmitDialogResponse{Error: "failed to get title"}
			w.Header().Add("Content-Type", "application/json")
			io.WriteString(w, string(resp.ToJson()))
			return
		}
		msg, ok := payload.Submission["message"].(string)
		if !ok {
			resp := model.SubmitDialogResponse{Error: "failed to get message"}
			w.Header().Add("Content-Type", "application/json")
			io.WriteString(w, string(resp.ToJson()))
			return
		}

		// (5) Message Attachmentsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
		post := &model.Post{
			ChannelId: payload.ChannelId,
			Props: model.StringInterface{
				"attachments": []*model.SlackAttachment{{
					Title: title,
					Text:  msg,
				}},
			},
		}

		// (6) REST APIã«ã‚ˆã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿
		req, _ := http.NewRequest(http.MethodPost, "http://localhost:8065/api/v4/posts", strings.NewReader(post.ToJson()))
		req.Header.Add("Authorization", "Bearer "+MattermostAccessToken)
		req.Header.Add("Content-Type", "application/json")
		resp, err := http.DefaultClient.Do(req)

		// (7) ã‚¨ãƒ©ãƒ¼å‡¦ç†
		dialogResp := model.SubmitDialogResponse{}
		if err != nil {
			dialogResp.Error = err.Error()
		}
		if resp.StatusCode != http.StatusCreated {
			dialogResp.Error = fmt.Sprintf("failed to request: %s", resp.Status)
		}
		w.Header().Add("Content-Type", "application/json")
		io.WriteString(w, string(dialogResp.ToJson()))
	})
...
```

Interactive Dialog ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã£ãŸã‚‰ã€`(4)`ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ [`SubmitDialogRequest`](https://github.com/mattermost/mattermost-server/blob/dc1b42390b9bca393d03e2ccdbb16d66cd866431/model/integration_action.go#L230)å½¢å¼ã§èª­ã¿è¾¼ã¿ã¾ã™ã€‚ãã—ã¦ã€`SubmitDialogRequest`ã®`Submission`ã‹ã‚‰`title`ã€`message`ã‚’ã‚­ãƒ¼ã«æŒã¤å€¤ã‚’å–å¾—ã—ã¾ã™ã€‚`Submission`ã® Value ã¯`interface{}`å‹ãªã®ã§ã€æ–‡å­—åˆ—ã®å ´åˆã¯ã‚­ãƒ£ã‚¹ãƒˆãŒå¿…è¦ã§ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å‡ºã›ãŸã‚‰ `(5)` ã§ã€èª­ã¿å‡ºã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ Message Attachments ã‚’å«ã‚€`Post`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€`(6)`ã§ REST API çµŒç”±ã§æŠ•ç¨¿ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚REST API ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã€Mattermost ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³(`MattermostAccessToken`)ã‚’äº‹å‰ã«å–å¾—ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

æœ€å¾Œã« `(7)` ã§ REST API ã®å®Ÿè¡Œçµæœã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹å ´åˆã¯[`SubmitDialogResponse`](https://github.com/mattermost/mattermost-server/blob/dc1b42390b9bca393d03e2ccdbb16d66cd866431/model/integration_action.go#L242)å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´ã—ã¾ã™ã€‚

```go
type SubmitDialogResponse struct {
	Error  string            `json:"error,omitempty"`
	Errors map[string]string `json:"errors,omitempty"`
}
```

`SubmitDialogResponse`ã®`Error`ã«ã¯ Interactive Dialog å…¨ä½“ã®ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—ã€`Errors`ã«ã¯`DialogElement`ã®è¦ç´ ã”ã¨ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¾ã™ã€‚`Errors`ã¯`Submission`ã¨åŒã˜ã`DialogElement`ã®`Name`ã‚’ key ã¨ã™ã‚‹ map å½¢å¼ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¾ã™ã€‚

è©¦ã—ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãª`SubmitDialogResponse`ã‚’è¿”ã—ãŸã¨ãã®çµæœã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

```go
dialogResp.Errors = map[string]string{
	"title":   "title error",
	"message": "message error",
}
dialogResp.Error = "error"
w.Header().Add("Content-Type", "application/json")
io.WriteString(w, string(dialogResp.ToJson()))
```

![error](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day16/dialog-error.png)

ä»¥ä¸Šã®ã‚ˆã†ã« Interactive Dialog ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã§ãã¾ã™ã€‚

## ã•ã„ã”ã«

æœ¬æ—¥ã¯ã€Interactive Dialog ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
æ˜æ—¥ã‹ã‚‰ã¯ã€Mattermost ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚
