---
title: "LINE BOTã§ä½•ã‚„ã£ã¦è‰¯ã„ã‹åˆ†ã‹ã‚‰ãªã„ã®ã§ã¨ã‚Šã‚ãˆãšiftttã«é£›ã°ã—ã¦ã¿ã‚‹"
date: 2016-04-13T00:00:00+09:00
emoji: "ğŸ“£"
type: "tech"
topics: [Heroku, ifttt, Line, linebot]
published: false
aliases: "/post/line-botã§ä½•ã‚„ã£ã¦è‰¯ã„ã‹åˆ†ã‹ã‚‰ãªã„ã®ã§ã¨ã‚Šã‚ãˆãšiftttã«é£›ã°ã—ã¦ã¿ã‚‹"
---

LINE BOT ã‚’å§‹ã‚ Bot ç•ŒéšˆãŒç››ã‚Šä¸ŠãŒã£ã¦ãã¦ã¾ã™ãŒã€BotKit å…¬é–‹ã•ã‚Œã¦ã‚‚ä½•ã™ã‚Œã°è‰¯ã„ã‹åˆ†ã‹ã‚‰ãªã„äººé–“ãªã®ã§ã€ã¨ã‚Šã‚ãˆãš ifttt ã¸ã®ãƒ‘ã‚¹ä½œã£ã¨ã‘ã°å¤¢ã¯åºƒãŒã‚‹ã ã‚ã†ã¨ã„ã†ã‚¢ãƒ¬ã§ã™ã€‚

ä¸‹è¨˜ã®æƒ…å ±ã®çµ„ã¿åˆã‚ã›ã§ã§ãã¾ã—ãŸã€‚

[LINE BOT ã‚’ã¨ã‚Šã‚ãˆãšã‚¿ãƒ€ã§ Heroku ã§å‹•ã‹ã™ - Qiita](http://qiita.com/yuya_takeyama/items/0660a59d13e2cd0b2516)
[AWS Lambda ã¨ IFTTT ã§ãŠæ‰‹è»½ã« push é€šçŸ¥ã‚’å®Ÿç¾ã™ã‚‹ - Qiita](http://qiita.com/kawahiro311/items/41dca04fe899d4d142d9)

[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://dashboard.heroku.com/new?button-url=https%3A%2F%2Fgithub.com%2Fkaakaa%2Fline-ifttt&template=https%3A%2F%2Fgithub.com%2Fkaakaa%2Fline-ifttt)

å‹•ã‹ã™ã«ã¯ä¸‹è¨˜ãŒå¿…è¦

- [LINE BOT API ã®ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã‚¢ã‚«ã‚¦ãƒ³](https://business.line.me/services/products/4/introduction)
- [ifttt ã® Maker ãƒãƒ£ãƒ³ãƒãƒ«ã® SecretKey](https://ifttt.com/maker)

---

æµã‚Œã¨ã—ã¦ã¯ LINE BOT ã‹ã‚‰ Heroku ã¸ Callback ã—ã€Heroku ã‹ã‚‰ ifttt ã® Maker ãƒãƒ£ãƒ³ãƒãƒ«ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã—ã¦ã¾ã™ã€‚
[Connect Maker to hundreds of apps - IFTTT](https://ifttt.com/maker)

Maker ãƒãƒ£ãƒ³ãƒãƒ«ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™ã¨`Congratulations! You've ï½` ã¨ã„ã†å®šå‹æ–‡ãŒè¿”ã•ã‚Œã‚‹ã®ã§ã€ãã‚Œã‚’ã¾ãŸ LINE ã¸ã¤ã¶ã‚„ãã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ ifttt ã¸å±Šã„ãŸã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ã ã‘ã§ã€ãƒ¬ã‚·ãƒ”ãŒã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸã‹ã©ã†ã‹ã¯åˆ¤åˆ¥ã§ããªãã†ã§ã™ï¼‰

Maker ãƒãƒ£ãƒ³ãƒãƒ«ã¯ ifttt ã®ãƒ¬ã‚·ãƒ”æ¯ã«`EventName`ã‚’æŒ‡å®šã§ãã‚‹ãŸã‚ã€LINE ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å…ˆé ­ã§ãã®`EventName`ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠã‚Šã€Heroku ã«ã‚¢ãƒ—ãƒªä¸€ã¤ç«‹ã¦ã¦ãŠãã ã‘ã§ã€ifttt ã®è¤‡æ•°ã®ãƒ¬ã‚·ãƒ”ã«å¯¾å¿œã§ãã‚‹ã¯ãšã§ã™ã€‚

![line-ifttt-7.png](https://qiita-image-store.s3.amazonaws.com/0/9891/20b58a7c-f787-9d79-6a0c-c3d07da018b5.png)

LINE ä¸Šã§`ifttt-test hogehoge`ã¨ã¤ã¶ã‚„ã‘ã°ã€`EventName`ãŒ`ifttt-test`ã®ãƒ¬ã‚·ãƒ”ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

```rb:app.rb
# Mostly taken from http://qiita.com/masuidrive/items/1042d93740a7a72242a3
# And https://github.com/yuya-takeyama/line-echo

require 'sinatra/base'
require 'json'
require 'rest-client'

class App < Sinatra::Base
  SECRET_KEY = ENV['MAKER_SECRET_KEY'] # Maker channel's secret key
  EVENT_NAME_DEFAULT = ENV['MAKER_EVENT_NAME_DEFAULT'] # Maker channel's default event name

  post '/linebot/callback' do
    params = JSON.parse(request.body.read)

    RestClient.proxy = ENV['FIXIE_URL'] if ENV['FIXIE_URL']
    params['result'].each do |msg|
      event, message = msg['content']['text'].split(' ', 2)
      response = request_to_ifttt(event, message)

      request_to_line([msg['content']['from']], response)
    end

    "OK"
  end

  helpers do
    def request_to_ifttt(event = EVENT_NAME, message)
      # Maker channel's extra data
      request_content = {
        value1: message,
        value2: 'from',
        value3: 'Line Bot'
      }

      endpoint_uri = "https://maker.ifttt.com/trigger/#{event}/with/key/#{SECRET_KEY}"
      content_json = request_content.to_json

      response = RestClient.post(endpoint_uri, content_json, {
        'Content-Type' => 'application/json; charset=UTF-8',
        'Content-Length' => content_json.length
      })
    end

    def request_to_line(send_to, message)
      request_content = {
        to: send_to,
        toChannel: 1383378250, # Fixed  value
        eventType: "138311608800106203", # Fixed value
        content: {
            "contentType": 1,  # Text type message
            "toType": 1,
            "text": message
        }
      }

      endpoint_uri = 'https://trialbot-api.line.me/v1/events'
      content_json = request_content.to_json

      RestClient.post(endpoint_uri, content_json, {
        'Content-Type' => 'application/json; charset=UTF-8',
        'X-Line-ChannelID' => ENV["LINE_CHANNEL_ID"],
        'X-Line-ChannelSecret' => ENV["LINE_CHANNEL_SECRET"],
        'X-Line-Trusted-User-With-ACL' => ENV["LINE_CHANNEL_MID"],
      })
    end
  end
end
```

---

Maker ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ï¼“ã¤ï¼ˆ`Value1`, `Value2`, `Value3`ï¼‰ã¾ã§æŒ‡å®šã§ãã¾ã™ã€‚
![line-ifttt-8.png](https://qiita-image-store.s3.amazonaws.com/0/9891/a3e22ceb-38d6-506b-f897-0ed1c6de704e.png)
`EventName`ã¯ãã®ã¾ã¾ã®æ„å‘³ã€`OccurredAt`ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ãŸæ—¥æ™‚ã«ãªã‚Šã¾ã™ã€‚

ifttt ä¸Šã§æŒ‡å®šã™ã‚‹å ´åˆã¯`Value1`ã®ã‚ˆã†ã«å…ˆé ­ã‚’å¤§æ–‡å­—ã®`V`ã«ã—ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ãŒã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã¯å…ˆé ­å°æ–‡å­—ã®`value1`ã§ãªã„ã¨ãƒ€ãƒ¡ã¿ãŸã„ã§ã™ã€‚

```rb
      # Maker channel's extra data
      request_content = {
        value1: message,
        value2: 'from',
        value3: 'Line Bot'
      }
```

---

ã‚½ãƒ¼ã‚¹ã¯ä¸‹è¨˜ã«ç½®ã„ã¦ã¾ã™ã€‚ (masuidrive ã•ã‚“ã«æ€’ã‚‰ã‚ŒãŸã‚‰æ¶ˆã™)
[kaakaa/line-ifttt](https://github.com/kaakaa/line-ifttt)

ã¨ã‚Šã‚ãˆãšä½œã£ãŸã‚‚ã®ã®ã‚„ã‚ŠãŸã„ã“ã¨ãŒãªã„ã€‚
