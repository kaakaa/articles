---
title: "EC2ã«Kanonã¨trac-code-comments-pluginã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"
date: 2014-11-23T23:16:05+09:00
emoji: "ğŸ“£"
type: "tech"
topics: [AWS, Trac, kanon]
published: true
---

# Kanon ã¨ã¯ï¼Ÿ

## Kanon

Trac/Maven/Jenkins ã‚’ä¸€æ‹¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ„ãƒ¼ãƒ«
(Trac Lightning ã® Linux ç‰ˆ)

[Kanon LAB](http://kanon.ultimania.org/ "Kanon LAB") (å…¬å¼ã‚µã‚¤ãƒˆã ãŒç¹‹ãŒã‚‰ãªã„ï¼Ÿ)
[okamototk / KanonConductor â€” Bitbucket](http://www.bytebucket.org/okamototk/kanonconductor "okamototk / KanonConductor â€” Bitbucket")

## trac-code-comments-plugin

Trac(Kanon)ã®ãƒªãƒã‚¸ãƒˆãƒªãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ã‘ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
[Automattic/trac-code-comments-plugin](https://github.com/Automattic/trac-code-comments-plugin "Automattic/trac-code-comments-plugin")

Trac ã«ã¯ä»–ã«ã‚‚åŒæ§˜ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã„ãã¤ã‹ã‚ã‚‹ãŒã€ã“ã‚ŒãŒä¸€ç•ªæ–°ã—ãã†ã§ã€ä½¿ã„ã‚„ã™ãã†ã«è¦‹ãˆãŸã€‚
ï¼ˆãƒªãƒã‚¸ãƒˆãƒªã‚‚ Github ã«ã‚ã‚‹ã—ï¼‰

# ç’°å¢ƒ

## ä½¿ç”¨ç’°å¢ƒ

AWS EC2 ã® Red Hat Enterprise Linux 7.0 (HVM), SSD Volume Type - ami-99bef1a9 ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

## æº–å‚™

`yum update`ã¨ Mercurial,git ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã—ã¦ãŠãã€‚
(Kanon ä¸Šã®ãƒªãƒã‚¸ãƒˆãƒªã¨ã—ã¦ svn,bazaar ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ä½µã›ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã)

```
sudo yum update
sudo yum install -y hg git
```

# Kanon ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

BitBucket ã«æ›¸ã„ã¦ã‚ã‚‹æ‰‹é †ã©ãŠã‚Šã«ã€‚
[okamototk / KanonConductor â€” Bitbucket](http://www.bytebucket.org/okamototk/kanonconductor "okamototk / KanonConductor â€” Bitbucket")

## Kanon ã‚½ãƒ¼ã‚¹ã®å–å¾—

BitBucket ã§ã¯ Mercurial ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã€‚

```
hg clone https://bitbucket.org/okamototk/kanonconductor
```

## Kanon ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚³ãƒãƒ³ãƒ‰ä¸€ç™ºã§ã€‚

```
cd kanonconductor
sudo ./kanon-setup
```

å¹¾ã¤ã‹è³ªå•ã•ã‚Œã‚‹ã®ã§ã€ãã‚Œãªã‚Šã«ç­”ãˆã‚‹ã ã‘ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã€‚
è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ã€`/opt/kanon`ã« Kanon ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã€‚
ã¾ãŸã€ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒ`/var/opt/kanon/trac/SampleProject`ã«ä½œæˆã•ã‚Œã¦ã„ãŸã€‚

trac é–¢é€£ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œå‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«`/opt/kanon/bin`ã«ãƒ‘ã‚¹ã‚’é€šã—ã¦ãŠãã€‚

```
export PATH=/opt/kanon/bin:$PATH
```

## Kanon ã«ã‚¢ã‚¯ã‚»ã‚¹

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ãŸæ™‚ç‚¹ã§ã€Kanon ã® httpd ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ–ã‚‚å®Œäº†ã—ã¦ãŠã‚Šã€`http://${IP}/trac`ã§ Kanon ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€‚

æ–°ãŸã« Kanon ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸã„å ´åˆã¯`kanon-create-project`ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šè¡Œã†ã€‚
ã„ãã¤ã‹ã®è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã§ãã‚‹ã€‚

# trac-code-comments-plugin ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Kanon ã®ãƒªãƒã‚¸ãƒˆãƒªãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ®‹ã›ã‚‹`trac-code-comment-plugin`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
[Automattic/trac-code-comments-plugin](https://github.com/Automattic/trac-code-comments-plugin "Automattic/trac-code-comments-plugin")

## trac-code-comments-plugin ã‚½ãƒ¼ã‚¹ã®å–å¾—

Github ã‚ˆã‚Šã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã€‚

```
git clone https://github.com/Automattic/trac-code-comments-plugin
```

## trac-code-comment-plugin ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`git clone`ã—ãŸã‚½ãƒ¼ã‚¹ã‚ˆã‚Š egg ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚
(python 2.4+ ãŒå¿…è¦)

```
cd trac-code-comments-plugin
python setup.py bdist_egg
```

ã“ã‚Œã§ã€`dist`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« egg ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã®ã§ã€ã“ã® egg ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`${TRAC_PROJECT}/plugins`é…ä¸‹ã«ç§»å‹•ã™ã‚‹ã€‚
ä»Šå›ã¯ Kanon ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ä½œæˆã•ã‚ŒãŸ`SampleProject`ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```
sudo mv dist/TracCodeComments-1.1.1-py2.6.egg /var/opt/kanon/trac/SampleProject/plugins
sudo chown apache:apache /var/opt/kanon/trac/SampleProject/plugins/TracCodeComments-1.1.1-py2.6.egg
```

ã“ã‚Œã§ã€`httpd`ã‚’å†èµ·å‹•ã™ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã™ã‚‹ã¯ãšã ãŒã€è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸã€‚

```
Traceback (most recent call last):
  File "/opt/kanon/lib/python2.6/site-packages/Trac-0.12.4.ja1-py2.6.egg/trac/web/api.py", line 446, in send_error
    data, 'text/html')
  File "/opt/kanon/lib/python2.6/site-packages/Trac-0.12.4.ja1-py2.6.egg/trac/web/chrome.py", line 835, in render_template
    template = self.load_template(filename, method=method)
  File "/opt/kanon/lib/python2.6/site-packages/Trac-0.12.4.ja1-py2.6.egg/trac/web/chrome.py", line 796, in load_template
    self.get_all_templates_dirs(), auto_reload=self.auto_reload,
  File "/opt/kanon/lib/python2.6/site-packages/Trac-0.12.4.ja1-py2.6.egg/trac/web/chrome.py", line 511, in get_all_templates_dirs
    dirs.extend(provider.get_templates_dirs() or [])
  File "build/bdist.linux-x86_64/egg/code_comments/web.py", line 25, in get_templates_dirs
    return [self.get_template_dir()]
  File "build/bdist.linux-x86_64/egg/code_comments/web.py", line 29, in get_template_dir
    return resource_filename(__name__, 'templates')
  File "/opt/kanon/lib/python2.6/site-packages/distribute-0.6.14-py2.6.egg/pkg_resources.py", line 869, in resource_filename
    self, resource_name
  File "/opt/kanon/lib/python2.6/site-packages/distribute-0.6.14-py2.6.egg/pkg_resources.py", line 1345, in get_resource_filename
    return self._extract_resource(manager, zip_path)
  File "/opt/kanon/lib/python2.6/site-packages/distribute-0.6.14-py2.6.egg/pkg_resources.py", line 1352, in _extract_resource
    manager, os.path.join(zip_path, name)
  File "/opt/kanon/lib/python2.6/site-packages/distribute-0.6.14-py2.6.egg/pkg_resources.py", line 1370, in _extract_resource
    self.egg_name, self._parts(zip_path)
  File "/opt/kanon/lib/python2.6/site-packages/distribute-0.6.14-py2.6.egg/pkg_resources.py", line 949, in get_cache_path
    self.extraction_error()
  File "/opt/kanon/lib/python2.6/site-packages/distribute-0.6.14-py2.6.egg/pkg_resources.py", line 915, in extraction_error
    raise err
ExtractionError: Can't extract file(s) to egg cache

The following error occurred while trying to extract file(s) to the Python egg
cache:

  [Errno 13] Permission denied: '/var/opt/kanon/trac/.egg-cache'

The Python egg cache directory is currently set to:

  /var/opt/kanon/trac/.egg-cache

Perhaps your account does not have write access to this directory?  You can
change the cache directory by setting the PYTHON_EGG_CACHE environment
variable to point to an accessible directory.
```

ã©ã†ã‚„ã‚‰ã€egg ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å±•é–‹ã™ã‚‹å ´åˆã€`.egg-cache`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚
ã®ã§ã€apache ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹`.egg-cache`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚

```
sudo mkdir /var/opt/kanon/trac/.egg-cache
sudo chown apache:apache /var/opt/kanon/trac/.egg-cache
```

Kanon ã®ä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã« Code Comments ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã€‚
(ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹å¿…è¦ã‚ã‚Š)

# ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼

- ãƒªãƒã‚¸ãƒˆãƒªãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ¼ãƒ‰ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2014-11-23 0.04.18.png](https://qiita-image-store.s3.amazonaws.com/0/9891/e421fe46-1628-8f01-7ab3-1cd7fdef4eb5.png "ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2014-11-23 0.04.18.png")

- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã™ã‚‹ï¼ˆTrac Wiki è¨˜æ³•ãŒä½¿ãˆã‚‹ï¼‰

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2014-11-23 0.04.34.png](https://qiita-image-store.s3.amazonaws.com/0/9891/94d5cd54-bccb-1315-57bd-d8939c0dafbe.png "ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2014-11-23 0.04.34.png")

- ä¸‹è¨˜ã®å½¢å¼ã§ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¸®å°è¡¨ç¤ºã¯ã§ããªãã†â€¦ï¼‰

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2014-11-23 0.04.55.png](https://qiita-image-store.s3.amazonaws.com/0/9891/8f7e60f0-15bd-7860-3a7b-edeafbb75720.png "ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2014-11-23 0.04.55.png")

- Code Comment ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã¯ã€ä½œæˆã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2014-11-23 0.05.08.png](https://qiita-image-store.s3.amazonaws.com/0/9891/f0d9ee08-d19d-6c6a-6855-0befab329b5f.png "ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2014-11-23 0.05.08.png")
