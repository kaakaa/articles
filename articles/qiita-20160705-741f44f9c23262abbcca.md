---
title: "æ‰‹è»½ã«Gradleãƒ“ãƒ«ãƒ‰ã‚’é«˜é€ŸåŒ–ã™ã‚‹10ã®æ–¹æ³•"
date: 2016-07-05T00:00:00+09:00
emoji: "ğŸ“£"
type: "tech"
topics: [gradle]
published: false
---

# ã¯ã˜ã‚ã«

Gradle ã®ãƒ“ãƒ«ãƒ‰ã‚’é«˜é€ŸåŒ–ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã€ä¸‹è¨˜ã‚¨ãƒ³ãƒˆãƒªã‚’å‚è€ƒã«èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚
[10 Tips to Improve Your Gradle Build Time â€” Medium](https://medium.com/@kenodoggy/10-tips-to-improve-your-gradle-build-time-1ddeca924759#.hsxgddism)

è¨˜äº‹ã®å†’é ­ã§ã‚‚æ›¸ã‹ã‚Œã¦ã„ã‚‹é€šã‚Šã€ä¸Šè¨˜ã®ã‚¨ãƒ³ãƒˆãƒªã¯ Android ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‘ã‘ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€Android ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ãªãã¦ã‚‚ Gradle ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰ã°é©ç”¨ã§ãã‚‹æ–¹æ³•ã°ã‹ã‚Šã§ã™ã€‚
ï¼ˆä¸€ã¤ Android é™å®šã®ã‚‚ã®ã‚‚ã‚ã‚Šã¾ã™ãŒï¼‰
ç‰¹ã«ãƒãƒ«ãƒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã®éš›ã«åŠ¹æœãŒé«˜ã„ã‚‚ã®ã°ã‹ã‚Šãªã®ã§ã€å¤§è¦æ¨¡ãª Gradle ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹éš›ã®å‚è€ƒã«ãªã‚Šãã†ã§ã™ã€‚

ãŸã ã€æœ€å¾Œã®ã¾ã¨ã‚ã«ã‚‚æ›¸ãã¾ã—ãŸãŒã€ãƒ“ãƒ«ãƒ‰æ™‚é–“ã®å¤§åŠã‚’å ã‚ã‚‹ã®ãŒãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã§ã‚ã‚‹ã“ã¨ãŒå¤šã„ãŸã‚ã€åŠ‡çš„ã«ãƒ“ãƒ«ãƒ‰ãŒæ—©ããªã‚‹ã¨ã„ã†è¨³ã§ã¯ç„¡ã„ã‹ã¨æ€ã„ã¾ã—ãŸã€‚

## 0. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

Gradle ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨å®Ÿè¡Œæ™‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ãŒå¤šã„ãŸã‚ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¼‰ã›ã¦ãŠãã¾ã™ã€‚

[AppendixÂ D.Â Gradle Command Line](https://docs.gradle.org/current/userguide/gradle_command_line.html)
[The Build Environment - Gradle User Guide Version 2.14](https://docs.gradle.org/current/userguide/build_environment.html)

## 1. ãƒ‡ãƒ¼ãƒ¢ãƒ³åŒ–

ã“ã‚Œã¯æ˜”ã‹ã‚‰æ¨å¥¨ã•ã‚Œã¦ã¾ã—ãŸã­ã€‚
Gradle ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¸¸é§åŒ–ã•ã›ã‚‹ã“ã¨ã§ã€JVM ã®èµ·å‹•ã‚„å¿…é ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã‚’æ¯å›è¡Œã‚ãªãã¦æ¸ˆã‚€ã‚ˆã†ã«ã™ã‚‹æ–¹æ³•ã€‚

[The Gradle Daemon - Gradle User Guide Version 2.14](https://docs.gradle.org/current/userguide/gradle_daemon.html)

### æŒ‡å®šæ–¹æ³•

```gradle.properties
org.gradle.daemon=true
```

or

```command:cli
./gradlewã€€--daemon # ä¸€åº¦èµ·å‹•ã™ã‚‹ã¨ãã®ã¾ã¾å¸¸é§ã—ã¾ã™
./gradlew build
```

## 2. ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰ (incubating)

**ãƒãƒ«ãƒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ“ãƒ«ãƒ‰é™å®š**ã§ã™ã€‚
äº’ã„ã«å‚ç…§ã—ã‚ã£ã¦ã„ãªã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ([Decoupled Project](https://docs.gradle.org/current/userguide/multi_project_builds.html#sec:decoupled_projects))ã®ãƒ“ãƒ«ãƒ‰ã‚’ä¸¦åˆ—å®Ÿè¡Œã§ãã¾ã™ã€‚

### æŒ‡å®šæ–¹æ³•

```gradle.properties
org.gradle.parallel=true
org.gradle.workers.max=4  # ä¸¦åˆ—ã®æœ€å¤§æ•°(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ãƒ—ãƒ­ã‚»ãƒƒã‚µã®æ•°)
```

or

```command:cli
./gradlew build --parallel --max-workers=4
./gradlew build --parallel --parallel-threads=4
```

`--max-workers`ã¨`--parallel-thread`ã¯ã©ã¡ã‚‰ã‚‚`org.gradle.workers.max`ã¨åŒã˜ãã€ä¸¦åˆ—ã®æœ€å¤§æ•°ã‚’æŒ‡å®šã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚
åŒæ™‚ã«æŒ‡å®šã•ã‚ŒãŸå ´åˆã€`--parallel-thread`ãŒå„ªå…ˆã•ã‚Œã‚‹ãã†ã§ã™ã€‚

## 3. ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ Configure (incubating)

[Multi-project Builds - Gradle User Guide Version 2.14](https://docs.gradle.org/current/userguide/multi_project_builds.html#sec:configuration_on_demand)

Gradle ãƒ“ãƒ«ãƒ‰ã® Configure Phase ã‚’å¿…è¦ãªã¨ãã ã‘è¡Œã†ã¨ã„ã†ã“ã¨ã§ã™ã‹ã­ã€‚
ã¡ã‚‡ã£ã¨ã“ã“ã‚‰ã¸ã‚“ç†è§£ãŒæµ…ã„ã§ã™ã€‚

### æŒ‡å®šæ–¹æ³•

```gradle.properties
org.gradle.configureondemand=true
```

or

```command:cli
./gradlew build --configure-on-demand
```

## 4. ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š

ä»Šã¾ã§ç´¹ä»‹ã—ãŸæ‰‹æ³•ã¨è¶£å‘ãŒç•°ãªã‚Šã¾ã™ã€‚

1-3 ã§ã‚‚ç™»å ´ã—ãŸ`gradle.properteis`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ä¸‹è¨˜ã®ã„ãšã‚Œã‹ã®å ´æ‰€ã«ç½®ãã“ã¨ã§ãƒ“ãƒ«ãƒ‰æ™‚ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

- Gradle ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒˆãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- `$USER_HOME/.gradle/gradle.properties`
- `$GRADLE_USER_HOME/gradle.properties`

1-3 ã«æŒ™ã’ã¦ã„ã‚‹ã‚ˆã†ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢ä¿‚ãªãæœ‰åŠ¹ãªæ‰‹æ³•ãªã®ã§ãƒ¦ãƒ¼ã‚¶è¨­å®šã«ã—ã¦ã—ã¦ã—ã¾ã£ã¦ã‚‚è‰¯ã•ãã†ã§ã™ã€‚

[The Build Environment - Gradle User Guide Version 2.14](https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_configuration_properties)

## 5. æœ€å°åŒ–

ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œæ™‚ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã—ãªã„ã‚¿ã‚¹ã‚¯ã‚’æŒ‡å®šã§ãã¾ã™ã€‚
[Using the Gradle Command-Line - Gradle User Guide Version 2.14](https://docs.gradle.org/current/userguide/tutorial_gradle_command_line.html)

### æŒ‡å®šæ–¹æ³•

```command:cli
./gradlew build -x test
./gradlew build --exclude-task test
```

## 6. minSdkVersion ã‚’è¨­å®šã—ã¦ ART ã®ã¿ã‚’å¯¾è±¡ã«

**Android ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé™å®š**ã§ã™ã€‚
Android SDK ã®æœ€ä½ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`23`ã«è¨­å®šã™ã‚‹ã“ã¨ã§ Dalvik å‘ã‘ã® dexing?ã‚’ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã¿ãŸã„ã§ã™ã€‚

Android Studio ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚„ã‚Šæ–¹ã®ã‚ˆã†ã§ã€‚
[Configure Apps with Over 64K Methods | Android Studio](https://developer.android.com/studio/build/multidex.html#dev-build)

### æŒ‡å®šæ–¹æ³•

```build.gradle
...

def minSdk = hasProperty('minSdk') ? minSdk : 16

android {
    compileSdkVersion 23
    buildToolsVersion "23.0.2"

    dexOptions {
        javaMaxHeapSize "4g"
        jumboMode true
    }

    defaultConfig {
        applicationid "com.myapplication.app"

        minSdkVersion minSdk
        targetSdkVersion 23
...

```

```command:cli
./gradlew assembleDebug -PminSdk=23
```

Android Studio ã§ã®æŒ‡å®šæ–¹æ³•ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã‚’å‚è€ƒã«ã€‚
[How to make faster Android build without sacrificing new api lint check](https://gist.github.com/cesarferreira/8480ea6fd0b95ba57f98)

## 7. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ

Gradle ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚½ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã‚’æŠ‘æ­¢ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚ˆã†ã§ã™ã€‚
ä¸€åº¦ã€ãƒ“ãƒ«ãƒ‰ã«å¿…è¦ãªè³‡ç”£ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°ã€ä»¥é™ã¯ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚è‰¯ã•ãã†ã€‚

### æŒ‡å®šæ–¹æ³•

```command:cli
./gradlew build --offline
```

## 8. Gradle ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ 2.4 ã¾ã§ä¸Šã’ã‚‹

å…¬å¼ãƒ–ãƒ­ã‚°ã§ã‚‚ã‚¢ãƒŠã‚¦ãƒ³ã‚¹ãŒã‚ã£ãŸã‚ˆã†ã«ã€Gradle2.4 ã§ã¯ 2.3 ã®æ™‚ã‚ˆã‚Š configuration time ãŒ 34%ã‚‚å‰Šæ¸›ã•ã‚Œã¦ã„ã‚‹ãã†ã§ã€‚
[Gradle 2.4: The fastest yet - Gradle](https://gradle.org/blog/gradle-2-4-the-fastest-yet/)

ç¾åœ¨ã€Gradle2.14 ã¾ã§ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€2.3 ä»¥ä¸‹ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã¡ã‚‡ã£ã¨å¤ã™ãã‚‹ã®ã§ä¸Šã’ã¦ãŠãã¹ãã‹ã¨ã€‚

## 9. jCenter ã®åˆ©ç”¨

MavenCentral ã‚ˆã‚Š jCenter ã‚’åˆ©ç”¨ã—ã¾ã—ã‚‡ã†ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã§ã™ã€‚
ç¢ºã‹ã« Gradle ã® build-init plugin ã‚’ä½¿ã£ã¦ç”Ÿæˆã—ãŸ build.gradle ã§ã‚‚ã€jCenter ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

ç†ç”±ã«ã¤ã„ã¦ã¯ã€ä¸‹è¨˜ã®ã‚¨ãƒ³ãƒˆãƒªãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [Android Studio â€“ Migration from Maven Central to JCenter | Blog @Bintray](https://blog.bintray.com/2015/02/09/android-studio-migration-from-maven-central-to-jcenter/)
- [Issue 72061 - android - The Maven index is _huge_! - Android Open Source Project - Issue Tracker - Google Project Hosting](https://code.google.com/p/android/issues/detail?id=72061)
- [Feel secure with SSL? Think again. | Blog @Bintray](https://blog.bintray.com/2014/08/04/feel-secure-with-ssl-think-again/)

## 10. Profile!

ã¡ã‚ƒã‚“ã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã—ã¦ã€è‡ªåˆ†ãŸã¡ã®ãƒ“ãƒ«ãƒ‰ã®å†…å®¹ã‚’æŠŠæ¡ã—ã¦ãŠã“ã†ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚
`--profile`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã¦ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã® HTML ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

[Using the Gradle Command-Line - Gradle User Guide Version 2.14](https://docs.gradle.org/current/userguide/tutorial_gradle_command_line.html#sec:profiling_build)

ã¾ãŸã€Gradle Inc.ã¯[Gradle Build Scans](https://scans.gradle.com/)ã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹å§‹ã—ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ¬ã‚’åˆ©ç”¨ã™ã‚‹ã®ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ã¯ã€ç§ã®ãƒ–ãƒ­ã‚°ã§å°‘ã—ç´¹ä»‹ã—ã¦ã„ã¾ã™ã€‚
[Gradle ãŒãƒ“ãƒ«ãƒ‰çµæœè§£æã‚µãƒ¼ãƒ“ã‚¹ Gradle.com ã‚’é–‹å§‹ã—ã¦ã„ãŸ - kaakaa Blog](http://kaakaa.hatenablog.com/entry/2016/06/15/000223)

### æŒ‡å®šæ–¹æ³•

```command:cli
./gradlew build --profile
```

## ã•ã„ã”ã«

ã„ãã¤ã‹ã®é«˜é€ŸåŒ–æ‰‹æ³•ã«ã¤ã„ã¦ã€[Netflix/Hystrix](https://github.com/Netflix/Hystrix)ã‚’å¯¾è±¡ã«ãƒ“ãƒ«ãƒ‰æ‰€è¦æ™‚é–“ã‚’æ¸¬å®šã—ã¦ã¿ã¾ã—ãŸãŒã€ã‚„ã¯ã‚Šãƒ“ãƒ«ãƒ‰ã§ä¸€ç•ªæ™‚é–“ãŒã‹ã‹ã‚‹ã®ã¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ãŸã‚ã€ã»ã¼é«˜é€ŸåŒ–ã‚’ä½“æ„Ÿã§ãã¾ã›ã‚“ã§ã—ãŸã€‚
ãŸã ã—ã€ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰ã«ã¤ã„ã¦ã¯ã‚µãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆãŒä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ã¨ã¦ã‚‚åŠ¹æœãŒã‚ã‚Šã¾ã—ãŸã€‚
