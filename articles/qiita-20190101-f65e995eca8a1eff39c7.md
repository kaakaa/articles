---
title: "Mattermostãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½œã‚Šæ–¹"
date: 2019-01-01T00:00:00+09:00
emoji: "ğŸ› "
type: "tech"
topics: ["Mattermost"]
published: true
---

**(è¿½è¨˜ 2020/04/12)**

æœ¬è¨˜äº‹ã§ã‚‚ä½¿ç”¨ã—ã¦ã„ã‚‹`dep`ãŒã‚‚ã†ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã¦ãŠã‚‰ãšã€æœ¬è¨˜äº‹ã§ç´¹ä»‹ã—ã¦ã„ã‚‹å†…å®¹ã§ Mattermost ã®æœ€æ–°ç‰ˆã‚’åˆ©ç”¨ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®é–‹ç™ºãŒå›°é›£ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

ä»Šå¾Œ Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã‚’å§‹ã‚ã‚‹å ´åˆã€[Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç”¨ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ã¿ã‚‹ \- Qiita](https://qiita.com/kaakaa_hoe/items/6f3d1aa0a126f2e94e01) ã§ã‚‚ç´¹ä»‹ã—ã¦ã„ã¾ã™ãŒã€Mattermost å…¬å¼ãƒãƒ¼ãƒ ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒª https://github.com/mattermost/mattermost-plugin-starter-template ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

**(è¿½è¨˜ãŠã‚ã‚Š)**

---

# ã¯ã˜ã‚ã«

2017/11/16 ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸ Mattermost v4.4.0 ã§ã€Mattermost è‡ªä½“ã®æ©Ÿèƒ½æ‹¡å¼µã‚’è¡Œã†ãŸã‚ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚
ãã®å¾Œã€2018/08/16 ã«ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸ Mattermost v5.2.0 ã§ã€ç ´å£Šçš„å¤‰æ›´ã¨ãªã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¸€æ–°ãŒè¡Œã‚ã‚Œã€ç¾åœ¨ã‚‚æ–°ãŸãªæ‹¡å¼µãƒã‚¤ãƒ³ãƒˆã‚„ API ãŒè¿½åŠ ã•ã‚Œç¶šã‘ã¦ã„ã¾ã™ã€‚

Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰(Go è¨€èª)ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰(React.js)ä¸¡æ–¹ã®æ‹¡å¼µãŒè¡Œãˆã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚’æ‹¡å¼µã—ãŸã„å ´åˆã¯ Go è¨€èªã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’æ‹¡å¼µã—ãŸã„å ´åˆã¯ Javascript(React.js)ã‚’æ›¸ãã“ã¨ã«ãªã‚Šã¾ã™ã€‚
Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€æ–°ãŸãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ¼ãƒ /ãƒãƒ£ãƒ³ãƒãƒ«ã«å‚åŠ ã—ãŸéš›ã®å‡¦ç†ã‚’è¿½åŠ ã—ãŸã‚Šã€æŠ•ç¨¿ã‚’è¡¨ã™ React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è‡ªä½œã®ã‚‚ã®ã«ç½®ãæ›ãˆã‚‹ãªã©ã€ä»Šã¾ã§æ‰‹ã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒã§ããªã‹ã£ãŸéƒ¨åˆ†ã«ã¾ã§æ©Ÿèƒ½è¿½åŠ ã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ä»Šå›ã¯ã€ç°¡å˜ãªå®Ÿè£…ä¾‹ã‚’äº¤ãˆãªãŒã‚‰ Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½œæˆæ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚ï¼ˆGoã€Javascript ã®é–‹ç™ºçŸ¥è­˜ãŒã‚ã‚‹å‰æã§æ›¸ã„ã¦ã„ã¾ã™ï¼‰

ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€ä¸‹è¨˜ã®ãƒªãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚
https://github.com/kaakaa/mattermost-plugin-first
(Mattermost v5.6 ã‚’å¯¾è±¡ã«å‹•ä½œç¢ºèªã‚’è¡Œãªã£ã¦ã„ã¾ã™ï¼‰

# Step 0: Mattermost ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š

Mattermost ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯`config.json`ã‚’ç·¨é›†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```json:(Mattermostãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)/config/config.json

...
    },
    "PluginSettings": {
        "Enable": true,
        "EnableUploads": true,
        "Directory": "./plugins",
...
```

Mattermost è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã®`PluginSettings`ã«ã‚ã‚‹`Enable`ã¨`EnableUploads`ã‚’`true`ã«ã—ã€Mattermost ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚

ä»–ã«ã‚‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç›´æ¥ã‚µãƒ¼ãƒãƒ¼ã«é…ç½®ã—ãŸã‚Šã€[REST API çµŒç”±](https://api.mattermost.com/#tag/plugins%2Fpaths%2F~1plugins%2Fpost)ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒæœ€ã‚‚ç°¡å˜ãªãŸã‚ã“ã®æ‰‹é †ã§èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

# Step 1: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

ã¾ãšã€ä½•ã‚‚æ©Ÿèƒ½ã‚’æŒãŸãªã„ç©ºã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã—ã€ãã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¾ã§ã®ãƒ•ãƒ­ãƒ¼ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

```
root/
  â”œ dist/
  â”‚  â”” org.kaakaa.mattermost-plugin-first_0.0.2.tar.gz
  â”œ Makefile
  â”” plugin.json
```

## ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®Ÿä½“ã¯`.tar.gz`å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãªã‚Šã¾ã™ã€‚
`.tar.gz`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã¨ã—ã¦æœ€ä½é™å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯**ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**ã ã‘ã§ã™ã€‚

JSON å½¢å¼(`plugin.json`)ã‹ YAML å½¢å¼(`plugin.yaml`)ã§ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã® IDã€åå‰ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„å®Ÿè¡Œãƒã‚¤ãƒŠãƒªã®ãƒ‘ã‚¹ãªã©ã®ãƒ¡ã‚¿æƒ…å ±ã‚’è¨˜è¿°ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«è¨˜è¿°ã§ãã‚‹å†…å®¹ã«ã¤ã„ã¦ã¯ã€ä¸‹è¨˜ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
https://developers.mattermost.com/extend/plugins/manifest-reference/

ã¾ãšã€ä¸‹è¨˜ã®ã‚ˆã†ã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```json:plugin.json
{
    "id": "org.kaakaa.mattermost-plugin-first",
    "name": "Mattermost Plugin Sample",
    "description": "ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯Qiitaè¨˜äº‹ç”¨ã®Mattermostãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚",
    "version": "0.0.1"
}
```

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ

ä¸Šè¨˜ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚€`.tar.gz`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ãŸã‚ã€ä¸‹è¨˜ã®ã‚ˆã†ãª Makefile ã‚’ä½œæˆã—ã¾ã™ã€‚ï¼ˆmake ã®ç’°å¢ƒãŒãªã„å ´åˆã¯ã€æ‰‹å‹•ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ï¼‰

```make:Makefile
PLUGIN_ID ?= org.kaakaa.mattermost-plugin-first
PLUGIN_VERSION ?= 0.0.1
BUNDLE_NAME ?= $(PLUGIN_ID)_$(PLUGIN_VERSION).tar.gz

build:
	rm -rf dist/
	mkdir -p dist/$(PLUGIN_ID)
	cp plugin.json dist/$(PLUGIN_ID)/

	cd dist && tar -cvzf $(BUNDLE_NAME) $(PLUGIN_ID)

	@echo plugin built at: dist/$(BUNDLE_NAME)
```

`make build`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§`dist/org.kaakaa.mattermost-plugin-first_0.0.1.tar.gz`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

Mattermost ã® **ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«** > **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³(ãƒ™ãƒ¼ã‚¿ç‰ˆ)** > **ç®¡ç†**ç”»é¢ã‹ã‚‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-01-01 10.36.28.png](https://qiita-image-store.s3.amazonaws.com/0/9891/9d56287e-75d6-02a1-5ee8-529c54a95823.png)

**ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹** ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã€å…ˆã»ã©ä½œæˆã—ãŸ`dist/org.kaakaa.mattermost-plugin-first_0.0.1.tar.gz`ã‚’é¸æŠã—ã€**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã“ã¨ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ­£å¸¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¨**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³**ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-01-01 10.42.33.png](https://qiita-image-store.s3.amazonaws.com/0/9891/2de7b8f6-3280-0468-0236-7c6726de1c60.png)

ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®**æœ‰åŠ¹ã«ã™ã‚‹**ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã“ã¨ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€ç¾åœ¨ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®Ÿè£…ãŒè¡Œã‚ã‚Œã¦ã„ãªã„ãŸã‚ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’èµ·å‹•ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚¨ãƒ©ãƒ¼ã«é–¢ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-01-01 10.43.14.png](https://qiita-image-store.s3.amazonaws.com/0/9891/35f8c473-079d-bdc6-fa72-87226bc1a216.png)

# Step 2: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®Ÿè£…

Step 1 ã§ä½œæˆã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®å®Ÿè£…ã‚’åŠ ãˆã¦ã„ãã¾ã™ã€‚
`server`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã“ã« Go ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚

```
root/
  â”œ dist/
  â”‚  â”” org.kaakaa.mattermost-plugin-first_0.0.2.tar.gz
  â”œ server/
  â”‚  â”œ main.go
  â”‚  â”œ plugin.go
  â”‚  â”” Gopkg.toml
  â”œ Makefile
  â”” plugin.json
```

ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç®¡ç†ã«ã¯[golang/dep](https://github.com/golang/dep)ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

## main.go

ã¾ãš Go è¨€èªã® main ãƒ¡ã‚½ãƒƒãƒ‰ã§ Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’èªè­˜ã•ã›ã‚‹ãŸã‚ã«`plugin.ClientMain`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€è‡ªä½œã® Plugin ç”¨ã®æ§‹é€ ä½“(`FirstPlugin`)ã‚’èª­ã¿è¾¼ã¾ã›ã¾ã™ã€‚

```go:server/main.go
package main

import "github.com/mattermost/mattermost-server/plugin"

func main() {
	plugin.ClientMain(&FirstPlugin{})
}
```

ã“ã®è‡ªä½œã® FirstPlugin æ§‹é€ ä½“ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®Ÿè£…ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

## plugin.go

`FirstPlugin`æ§‹é€ ä½“ã«æœ€ä½é™æ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã¯ã€`plugin.MattermostPlugin`ã‚’ç¶™æ‰¿ã™ã‚‹ã“ã¨ã§ã™ã€‚
`plugin.MattermostPlugin`ã‚’ç¶™æ‰¿ã™ã‚‹ã“ã¨ã§ Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦èªè­˜ã•ã‚Œã€ã“ã®æ§‹é€ ä½“ã®æŒã¤`API`ã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é€šã˜ã¦[ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç”¨ã®å„ç¨® API](https://developers.mattermost.com/extend/plugins/server/reference/#API)ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
å®Ÿéš›ã® API ã®å‘¼ã³å‡ºã—æ–¹ã«ã¤ã„ã¦ã¯ã€æ¬¡ã®`hooks.go`ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚

```go:server/plugin.go
package main

import "github.com/mattermost/mattermost-server/plugin"

type FirstPlugin struct {
	plugin.MattermostPlugin
}
```

ã“ã‚Œã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã—ãŸãŒã€ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã¾ã ä½•ã®æ©Ÿèƒ½ã‚‚æŒã£ã¦ã„ã¾ã›ã‚“ã€‚
Mattermost æœ¬ä½“ã®å‹•ä½œã«å½±éŸ¿ã‚’åŠã¼ã™ã«ã¯ã€ã„ãšã‚Œã‹ã® Hooks ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

https://developers.mattermost.com/extend/plugins/server/reference/#Hooks

## hooks.go

ã“ã“ã§ã¯ã€`MessageWillBePosted`ã® Hooks ã‚’å®Ÿè£…ã—ã€Mattermost ä¸Šã« Qiita ã®ãƒªãƒ³ã‚¯ã‚’å«ã‚€æŠ•ç¨¿ãŒè¡Œã‚ã‚ŒãŸéš›ã«è‡ªå‹•ã§`#Qiita`ã¨ã„ã†ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ä»˜ä¸ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

```go:server/hooks.go
package main

import (
	"fmt"
	"strings"

	"github.com/mattermost/mattermost-server/model"
	"github.com/mattermost/mattermost-server/plugin"
)

func (p *FirstPlugin) MessageWillBePosted(c *plugin.Context, post *model.Post) (*model.Post, string) {
	if strings.Index(post.Message, "https://qiita.com/") == -1 {
		return post, ""
	}

	p.API.LogDebug("Qiita link is detected.")
	post.Message = fmt.Sprintf("%s #Qiita", post.Message)
	post.Hashtags = fmt.Sprintf("%s #Qiita", post.Hashtags)
	return post, ""
}
```

`MessageWillBePosted`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æŠ•ç¨¿ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ DB ã«ä¿å­˜ã•ã‚Œã‚‹ç›´å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã‚’è¨˜è¿°ã§ãã¾ã™ã€‚
ã“ã“ã§ã¯ã€æŠ•ç¨¿å†…å®¹ã«`https://qiita.com/`ã¨ã„ã† URL ã‚’å«ã‚€å ´åˆã«ã€è‡ªå‹•ã§`#Qiita`ã¨ã„ã†ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã‚’ä»˜ä¸ã™ã‚‹ã‚ˆã†å®Ÿè£…ã«ãªã£ã¦ã„ã¾ã™ã€‚

é€”ä¸­ã§`p.API.LogDebug`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¦ãƒ­ã‚°å‡ºåŠ›ã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é€šã˜ã¦å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ã¯ä¸‹è¨˜ã®ã‚ˆã†ã« **ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«** > **ãƒ­ã‚°** ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

> 2018-12-31T21:42:59.988+0900 debug app/plugin_api.go:623 Qiita link is detected. {"plugin_id": "org.kaakaa.mattermost-plugin-first"}

## Gopkg.toml

ã“ã“ã¾ã§æ›¸ã‘ãŸã‚‰ã€ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å–å¾—ã™ã‚‹ãŸã‚ã«`dep`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

`server`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã§`dep init`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ¤œå‡ºãƒ»å–å¾—ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

```
$ cd server
$ dep init
```

## ãƒ“ãƒ«ãƒ‰

ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®å®Ÿè£…ã‚’å«ã‚€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ `.tar.gz`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

ã¾ãšã€`plugin.json`ã«ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’èªè­˜ã•ã›ã‚‹ãŸã‚ã«`server`ã¨ã„ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json:plugin.json
{
    "id": "org.kaakaa.mattermost-plugin-first",
    "name": "Mattermost Plugin Sample",
    "description": "ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯Qiitaè¨˜äº‹ç”¨ã®Mattermostãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚",
    "version": "0.0.2",
    "server": {
        "executables": {
            "linux-amd64": "server/dist/plugin-linux-amd64",
            "darwin-amd64": "server/dist/plugin-darwin-amd64",
            "windows-amd64": "server/dist/plugin-windows-amd64.exe"
        },
        "executable": ""
    }
}
```

[`server`ã‚»ã‚¯ã‚·ãƒ§ãƒ³](https://developers.mattermost.com/extend/plugins/manifest-reference/#server)ã«ã¯ã€.tar.gz ãƒ•ã‚¡ã‚¤ãƒ«å†…ã® Go ãƒã‚¤ãƒŠãƒªã®ä½ç½®ã‚’æŒ‡å®šã—ã¾ã™ã€‚`executable`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯å„ OS ã”ã¨ã®ãƒã‚¤ãƒŠãƒªã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

`plugin.json`ã«æ›¸ã‹ã‚ŒãŸæ§‹æˆé€šã‚Šã«`.tar.gz`ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã‚ˆã†ã€`Makefile`ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```make:Makefile
PLUGIN_ID ?= org.kaakaa.mattermost-plugin-first
PLUGIN_VERSION ?= 0.0.2
BUNDLE_NAME ?= $(PLUGIN_ID)_$(PLUGIN_VERSION).tar.gz

build:
	mkdir -p server/dist
	cd server && env GOOS=linux GOARCH=amd64 GO build -o dist/plugin-linux-amd64
	cd server && env GOOS=darwin GOARCH=amd64 GO build -o dist/plugin-darwin-amd64
	cd server && env GOOS=windows GOARCH=amd64 GO build -o dist/plugin-windows-amd64.exe

	rm -rf dist/
	mkdir -p dist/$(PLUGIN_ID)
	cp plugin.json dist/$(PLUGIN_ID)/

	mkdir -p dist/$(PLUGIN_ID)/server/dist
	cp -r server/dist/* dist/$(PLUGIN_ID)/server/dist

	cd dist && tar -cvzf $(BUNDLE_NAME) $(PLUGIN_ID)

	@echo plugin built at: dist/$(BUNDLE_NAME)
```

`make build`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®å®Ÿè£…ã‚’å«ã‚€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»æœ‰åŠ¹åŒ–

å…ˆã»ã©ã¨åŒæ§˜ã€**ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«** > **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³(ãƒ™ãƒ¼ã‚¿ç‰ˆ)** > **ç®¡ç†** ã‚ˆã‚Šãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€åŒç”»é¢ã‹ã‚‰**æœ‰åŠ¹ã«ã™ã‚‹**ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚ä»Šåº¦ã¯ã€Œã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯èµ·å‹•ä¸­ã§ã™ã€‚ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-01-01 10.59.34.png](https://qiita-image-store.s3.amazonaws.com/0/9891/94b65442-26e0-1f1b-a765-980db0599500.png)

## å‹•ä½œç¢ºèª

![plugin.mov.gif](https://qiita-image-store.s3.amazonaws.com/0/9891/548309ab-c5cf-b368-4384-92c5b64a888b.gif)

## ã¾ã¨ã‚

ä»¥ä¸Šã®ã‚ˆã†ã«ã€Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®å®Ÿè£…ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»Šå›ã¯è§¦ã‚Œã¾ã›ã‚“ãŒã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ(Hooks)ã¯ä»–ã«ã‚‚æ•°å¤šãã‚ã‚‹ã®ã§ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«åˆè‡´ã™ã‚‹çµ„ã¿åˆã‚ã›ã‚’æ¢ã—ã¦è¦‹ã¦ãã ã•ã„ã€‚

https://developers.mattermost.com/extend/plugins/server/reference/#Hooks

- [OnActivate](https://developers.mattermost.com/extend/plugins/server/reference/#Hooks.OnActivate) / [OnDeactivate](https://developers.mattermost.com/extend/plugins/server/reference/#Hooks.OnDeactivate)
  - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹åŒ–/ç„¡åŠ¹åŒ–ã—ãŸæ™‚ã«å‘¼ã°ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
  - ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§[RegisterCommand](https://developers.mattermost.com/extend/plugins/server/reference/#API.RegisterCommand)/[UnregisterCommand](https://developers.mattermost.com/extend/plugins/server/reference/#API.UnregisterCommand)ã® API ã‚’å®Ÿè¡Œã—ã€ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã‚ˆã†ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ (`ExecutedCommand`ã® Hooks ã‚‚å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹)
- [ExecutedCommand](https://developers.mattermost.com/extend/plugins/server/reference/#Hooks.ExecuteCommand)
  - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’é€šã˜ã¦è¿½åŠ ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸæ™‚ã«å‘¼ã°ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
- [ServeHTTP](https://developers.mattermost.com/extend/plugins/server/reference/#Hooks.ServeHTTP)
  - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å°‚ç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
  - è¿½åŠ ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒˆã¯ `${MATTERMOST_SITEURL}/plugins/${PLUGIN_ID}/` ã«ãªã‚Šã¾ã™
- [OnConfigurationChange](https://developers.mattermost.com/extend/plugins/server/reference/#Hooks.OnConfigurationChange)
  - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™
  - ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«[setting_schema](https://developers.mattermost.com/extend/plugins/manifest-reference/#settings_schema)ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šç”»é¢ãŒå‡ºç¾ã—ã¾ã™

# Step 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®Ÿè£…

æœ€å¾Œã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®Ÿè£…ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆã¯ä¸‹è¨˜ã«æŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
https://developers.mattermost.com/extend/plugins/webapp/reference/#registry

ä»Šå›ã¯[`registerChannelHeaderButtonAction`](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerChannelHeaderButtonAction)ã‚’ä½¿ã„ã€ãƒãƒ£ãƒ³ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã‹ã‚‰æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚

```
root/
  â”œ dist/
  â”‚  â”” org.kaakaa.mattermost-plugin-first_0.0.3.tar.gz
  â”œ server/
  â”‚  â”œ ...
  â”œ webapp
  â”‚  â”œ src/
  â”‚  â”‚  â”œ index.js
  â”‚  â”‚  â”” action.js
  â”‚  â”œ package.json
  â”‚  â”” webpack.config.js
  â”œ Makefile
  â”” plugin.json
```

## index.js

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®èª­ã¿è¾¼ã¿ã¨å®Ÿè£…ã‚’`index.js`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚

```javascript:webapp/src/index.js
const React = window.React;
const {Glyphicon} = window.ReactBootstrap;

import {createPluginPost} from './action'

window.registerPlugin("org.kaakaa.mattermost-plugin-first", new Plugin());

class Plugin {
    initialize(registry, store) {
        registry.registerChannelHeaderButtonAction(
            <Glyphicon glyph="pencil" />,
            (channel) => {
                createPluginPost(channel.id)(store.dispatch, store.getState)
            },
            'First Plugin',
            'This is plugin tooltip',
        )
    }
}
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯`window.registerPlugin`ãƒ¡ã‚½ãƒƒãƒ‰ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ ID ã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä¸ãˆã‚‹ã“ã¨ã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè£…ã‚¯ãƒ©ã‚¹(`Plugin`)ã¯`initialize`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¡ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®[ç¬¬ä¸€å¼•æ•°ã§ã‚ã‚‹`registry`ãŒæŒã¤ãƒ¡ã‚½ãƒƒãƒ‰](https://developers.mattermost.com/extend/plugins/webapp/reference/#registry)ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»Šå›ã¯ãƒãƒ£ãƒ³ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹éƒ¨åˆ†ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã€[registry.registerChannelHeaderButtonAction](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerChannelHeaderButtonAction)ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚

ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®ç¬¬ï¼‘å¼•æ•°ã«ã¯ã€ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨ãªã‚‹ React è¦ç´ ã‚’æŒ‡å®šã—ã¾ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-01-01 11.13.12.png](https://qiita-image-store.s3.amazonaws.com/0/9891/7bb6c0cc-c8ab-4346-4a0a-dc1e5a81083a.png)

Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ React Bootstrap ãŒ export ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`const {Glyphicon} = window.ReactBootstrap;`ã¨æ›¸ãã“ã¨ã§ React Bootstrap ã®æ©Ÿèƒ½ã‚’ import ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚(export ã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€è¦§ã¯[Exported Libraries and Functions](https://developers.mattermost.com/extend/plugins/webapp/reference/#exported-libraries-and-functions))ã€‚

ç¬¬ï¼’å¼•æ•°ã«ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®å‹•ä½œã‚’è¨˜è¿°ã—ã¾ã™ã€‚ä»Šå›ã¯æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹`createPluginPost`ã¨ã„ã†å‡¦ç†ã‚’ actions ã¨ã—ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚
ç¬¬ï¼“å¼•æ•°ã«ã¯ã€è¤‡æ•°ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒ`registerChannelHeaderButtonAction`ã‚’å®Ÿè£…ã—ã¦ã„ãŸå ´åˆã«ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆã§ã™ã€‚
ç¬¬ï¼”å¼•æ•°ã«ã¯ãƒãƒ£ãƒ³ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒœã‚¿ãƒ³ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ãƒ†ã‚­ã‚¹ãƒˆã§ã™ã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-01-01 11.14.30.png](https://qiita-image-store.s3.amazonaws.com/0/9891/592b31ef-45d3-ffd0-9904-5f1e6ece8518.png)

## action.js

ãƒãƒ£ãƒ³ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã«è¡Œã‚ã‚Œã‚‹å‡¦ç†ã‚’`action.js`ã«æ›¸ã„ã¦ã„ã¾ã™ã€‚
Mattermost ã® Javascript ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§ã‚ã‚‹`mattermost-redux`ã‚’åˆ©ç”¨ã—ã¦ã€ç°¡å˜ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã™ã‚‹æ©Ÿèƒ½ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

```javascript:webapp/src/action.js
import {createPost} from 'mattermost-redux/actions/posts';
import {getCurrentUserId} from 'mattermost-redux/selectors/entities/users';

export function createPluginPost(channelId) {
    return async (dispatch, getState) => {
        const state = getState();
        const userId = getCurrentUserId(state)
        const post = {
            channel_id: channelId,
            user_id: userId,
            message: "Post from webapp plugin",
        }
        return await dispatch(createPost(post));
    }
}
```

## ãƒ“ãƒ«ãƒ‰

ã¾ãšã€`plugin.json`ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’èªè­˜ã•ã›ã‚‹ãŸã‚ã«`webapp`ã¨ã„ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json:plugin.json
{
    "id": "org.kaakaa.mattermost-plugin-first",
    "name": "Mattermost Plugin Sample",
    "description": "ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯Qiitaè¨˜äº‹ç”¨ã®Mattermostãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚",
    "version": "0.0.3",
    "server": {
        "executables": {
            "linux-amd64": "server/dist/plugin-linux-amd64",
            "darwin-amd64": "server/dist/plugin-darwin-amd64",
            "windows-amd64": "server/dist/plugin-windows-amd64.exe"
        },
        "executable": ""
    },
    "webapp": {
        "bundle_path": "webapp/dist/main.js"
    }
}
```

å®Ÿè£…ã—ã¦ããŸ`.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§æŒ‡å®šã—ãŸã—ãŸ`webapp/dist/main.js`ã«ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã«`webpack.config.js`ã‚’ç”¨æ„ã—ã¾ã™ã€‚
ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«æ˜ã‚‹ããªã„ã®ã§[å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«](https://github.com/mattermost/mattermost-plugin-demo/blob/master/webapp/webpack.config.js)ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ï¼‰

```javascript:webapp/webpack.config.js
var path = require('path');

module.exports = {
    entry: [
        './src/index.js',
    ],
    resolve: {
        modules: [
            'src',
            'node_modules',
        ],
        extensions: ['*', '.js', '.jsx'],
    },
    module: {
        rules: [
            {
                test: /\.(js|jsx)$/,
                exclude: /node_modules/,
                use: {
                    loader: 'babel-loader',
                    options: {
                        presets: ['@babel/preset-env','@babel/preset-react'],
                        plugins: [
                            'transform-class-properties',
                            '@babel/plugin-proposal-object-rest-spread'
                        ],
                    },
                },
            },
        ],
    },
    externals: {
        react: 'React',
        redux: 'Redux',
        'react-redux': 'ReactRedux',
    },
    output: {
        path: path.join(__dirname, '/dist'),
        publicPath: '/',
        filename: 'main.js',
    },
};
```

ä¸‹è¨˜ã®ã‚ˆã†ãª`package.json`ã‚’ç”¨æ„ã—ã€`npm install`ã—ã¦ã‹ã‚‰`npm run build`ã‚’å®Ÿè¡Œã—ã€æ­£å¸¸ã«ã‚³ãƒãƒ³ãƒ‰ãŒå®Œäº†ã™ã‚Œã°æº–å‚™ã¯å®Œäº†ã§ã™ã€‚

```json:webapp/package.json
{
  "name": "webapp",
  "version": "0.0.3",
  "description": "Post today's metal from channel header button",
  "main": "src/index.js",
  "scripts": {
    "build": "webpack --mode=production",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "mattermost-redux": "^5.6.2"
  },
  "devDependencies": {
    "@babel/core": "^7.2.2",
    "@babel/plugin-proposal-object-rest-spread": "^7.2.0",
    "@babel/preset-env": "^7.2.3",
    "@babel/preset-react": "^7.0.0",
    "babel-loader": "^8.0.4",
    "babel-plugin-transform-class-properties": "^6.24.1",
    "babel-plugin-transform-object-rest-spread": "^6.26.0",
    "webpack": "^4.28.3",
    "webpack-cli": "^3.1.2"
  }
}
```

æœ€å¾Œã«ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ Makefile ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ç·¨é›†ã—ã€ã§`make build`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å«ã‚€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³`.tar.gz`ãƒ•ã‚¡ã‚¤ãƒ«ãŒ`dist`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ä½œæˆã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

```make:Makefile
PLUGIN_ID ?= org.kaakaa.mattermost-plugin-first
PLUGIN_VERSION ?= 0.0.3
BUNDLE_NAME ?= $(PLUGIN_ID)_$(PLUGIN_VERSION).tar.gz

build:
	mkdir -p server/dist
	cd server && env GOOS=linux GOARCH=amd64 GO build -o dist/plugin-linux-amd64
	cd server && env GOOS=darwin GOARCH=amd64 GO build -o dist/plugin-darwin-amd64
	cd server && env GOOS=windows GOARCH=amd64 GO build -o dist/plugin-windows-amd64.exe

	cd webapp && npm run build;

	rm -rf dist/
	mkdir -p dist/$(PLUGIN_ID)
	cp plugin.json dist/$(PLUGIN_ID)/

	mkdir -p dist/$(PLUGIN_ID)/server/dist
	cp -r server/dist/* dist/$(PLUGIN_ID)/server/dist
	mkdir -p dist/$(PLUGIN_ID)/webapp/dist;
	cp -r webapp/dist/* dist/$(PLUGIN_ID)/webapp/dist/;

	cd dist && tar -cvzf $(BUNDLE_NAME) $(PLUGIN_ID)

	@echo plugin built at: dist/$(BUNDLE_NAME)
```

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»æœ‰åŠ¹åŒ–

å…ˆã»ã©ã¨åŒæ§˜ã€**ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«** > **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³(ãƒ™ãƒ¼ã‚¿ç‰ˆ)** > **ç®¡ç†** ã‚ˆã‚Šãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚

## å‹•ä½œç¢ºèª

![webapp.mov.gif](https://qiita-image-store.s3.amazonaws.com/0/9891/7098d243-a8db-3af1-2295-bfa528be7d21.gif)

## ã¾ã¨ã‚

ä»¥ä¸Šã®ã‚ˆã†ã«ã€Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»–ã«ã‚‚[å¤šãã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ](https://developers.mattermost.com/extend/plugins/webapp/reference/#registry)ãŒã‚ã‚‹ã®ã§ã€å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ã¯å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã®å®Ÿè£…ã‚’å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
https://github.com/mattermost/mattermost-plugin-demo

# ãŠã‚ã‚Šã«

ä»¥ä¸ŠãŒ Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®é–‹ç™ºæ–¹æ³•ã«ãªã‚Šã¾ã™ã€‚

ä»Šã¾ã§ã¯ Mattermost ã‚’ä»–ã®ã‚·ã‚¹ãƒ†ãƒ ã¨é€£æºã™ã‚‹å ´åˆã€é€£æºæ©Ÿèƒ½å°‚ç”¨ã®ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ãªã‘ã‚Œã°ãªã‚‰ãšã€é€£æºæ©Ÿèƒ½ãŒå¢—ãˆã‚‹ãŸã³ã«ã‚µãƒ¼ãƒãƒ¼ã‚’é‹ç”¨ã™ã‚‹æ‰‹é–“ãŒå¢—ãˆã¦ã„ã¾ã—ãŸãŒã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ã§é‹ç”¨ã®æ‰‹é–“ã‚’ Mattermost ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ä¸€å…ƒåŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã§ã¯ä»Šã¾ã§ä»¥ä¸Šã«ç´°ã‹ãªå‹•ä½œã«ã¾ã§æ‰‹ã‚’åŠ ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ä¾‹ãˆã°ã€[mattermost/mattermost\-plugin\-antivirus](https://github.com/mattermost/mattermost-plugin-antivirus)ã®ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸéš›ã«ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒã‚§ãƒƒã‚¯ã‚’ã‹ã‘ãŸã‚Šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

Slack ã¨ã¯é•ã„ã€ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã§ã®é‹ç”¨ã‚‚ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ãªã‚‹ Mattermost ã§ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã«ã‚ˆã‚‹ã‚¤ãƒ³ãƒ•ãƒ©é‹ç”¨ã‚³ã‚¹ãƒˆã®å‰Šæ¸›ã‚„ã€ä¼æ¥­ç‰¹æœ‰ã®ãƒãƒªã‚·ãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®ç´°ã‹ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§ã¯éå¸¸ã«å¤§ããªãƒ¡ãƒªãƒƒãƒˆã¨ãªã‚Šã¾ã™ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè£…ã«ã¾ã¤ã‚ã‚‹æœ¬ä½“ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®è¿½å¾“ãªã©ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚³ã‚¹ãƒˆã¯ä»Šå¾Œå•é¡Œã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ãã®è¾ºã‚Šã‚’ã©ã®ã‚ˆã†ã«ã‚¯ãƒªã‚¢ã—ã¦ã„ãã‹ã‚’å«ã‚ã€é–‹ç™ºã«å”åŠ›ã—ãªãŒã‚‰ã‚¦ã‚©ãƒƒãƒã—ã¦ã„ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

## å‚è€ƒè³‡æ–™

### é–‹ç™ºè€…å‘ã‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- https://developers.mattermost.com/
- https://github.com/mattermost/mattermost-developer-documentation

ã“ã®ã‚µã‚¤ãƒˆã§ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã«ã¤ã„ã¦ã ã‘ã§ãªãã€ãã®ä»–ã®çµ±åˆæ©Ÿèƒ½ã§ã‚ã‚‹ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã‚„ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ãªã©ã®é–‹ç™ºæ–¹æ³•ã‚„ã€Mattermost ã¸ã®ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆæ‰‹é †ãªã©ã«ã¤ã„ã¦ã‚‚ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

### ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

- https://github.com/mattermost/mattermost-plugin-demo

å…¬å¼ã§é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¢ç”¨ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‘ã‘ã«æä¾›ã•ã‚Œã¦ã„ã‚‹æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆã®å¤šãã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€å®Ÿè£…ã™ã‚‹éš›ã®å‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

- https://github.com/mattermost/mattermost-plugins

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ã€Official/Unofficial å•ã‚ãš Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® GitHub ãƒªãƒã‚¸ãƒˆãƒªãŒã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
æ–‡æ›¸ã‚ˆã‚Šã‚‚å‹•ãã‚³ãƒ¼ãƒ‰ã®ã»ã†ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã¨ã„ã†æ–¹ã«ã¯å‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚
