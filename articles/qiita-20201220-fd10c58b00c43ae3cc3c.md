---
title: "[Mattermost Integrations] Plugin (Webapp 1)"
date: 2020-12-20T00:00:00+09:00
emoji: "ğŸ“†"
type: "tech"
topics: ["Mattermost"]
published: true
---

Mattermost è¨˜äº‹ã¾ã¨ã‚: https://blog.kaakaa.dev/tags/mattermost/

## æœ¬è¨˜äº‹ã«ã¤ã„ã¦

[Mattermost ã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](https://qiita.com/advent-calendar/2020/mattermost-integrations)ã®ç¬¬ 20 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€Mattermost ä¸Šã®æ§˜ã€…ãªæ“ä½œã«å¯¾å¿œã—ãŸå‡¦ç†ã‚’è¿½åŠ ã§ãã‚‹ Mattermost Plugin ã®**Webapp**ã‚µã‚¤ãƒ‰ã®æ©Ÿèƒ½ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

è¨˜äº‹ãŒé•·ã„ã®ã§ 2 æ—¥ã«åˆ†ã‘ã¦ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚ãã‚Œã§ã‚‚é•·ã„ã§ã™ã€‚

Mattermost Plugin ã«ã¤ã„ã¦ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚
https://developers.mattermost.com/extend/plugins/overview/

ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚
https://github.com/kaakaa/mattermost-plugin-api-sample

## Mattermost Plugin (Webapp) ã«ã¤ã„ã¦

Mattermost Plugin (Webapp) ã®æœ¬ä½“ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

Mattermost ã®**Webapp**ã‚µã‚¤ãƒ‰ã® Plugin ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æœ¬ä½“ã¯`registry`ã¨`store`ã‚’å¼•æ•°ã«ã¨ã‚‹`initialize`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ã§ã™ã€‚`registry`ã¯ Mattermost Plugin (Webapp)ã®æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã€`store`ã¯ Mattermost ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãª`PluginClass`ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://developers.mattermost.com/extend/plugins/webapp/reference/

```js
class PluginClass {
    /**
    * initialize is called by the webapp when the plugin is first loaded.
    * Receives the following:
    * - registry - an instance of the registry tied to your plugin id
    * - store - the Redux store of the web app.
    */
    initialize(registry, store)

    /**
    * uninitialize is called by the webapp if your plugin is uninstalled
    */
    uninitialize()
}
```

ã“ã®`PluginClass`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’`window`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒã¤`registerPlugin`é–¢æ•°ã« Plugin ID ã¨å…±ã«ä¸ãˆã‚‹ã“ã¨ã§ã€Plugin ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

```js
window.registerPlugin("myplugin", new PluginClass());
```

## Webapp Plugin API

### [registerRootComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerRootComponent)

`registerRootComponent`ã¯ã€ç”»é¢å…¨ä½“ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ«ã® React Component ã‚’ç™»éŒ²ã™ã‚‹ API ã§ã™ã€‚Component ãŒç™»éŒ²ã•ã‚Œã‚‹ã¨ã€Component ã‚’ä¸€æ„ã«è­˜åˆ¥ã™ã‚‹ãŸã‚ã® ID ãŒè¿”å´ã•ã‚Œã¾ã™ã€‚

ã“ã“ã§ç™»éŒ²ã—ãŸ Root Component ã¯ã€ç™»éŒ²ã™ã‚‹ã ã‘ã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªãã€åˆ¥ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰èµ·å‹•ã•ã‚Œã‚‹ã“ã¨ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ç™»éŒ²ã•ã‚ŒãŸ Component ã§ä½¿ç”¨ã§ãã‚‹ props ã¯ç‰¹ã«ã‚ã‚Šã¾ã›ã‚“ã€‚[channel_controller.jsx](https://github.com/mattermost/mattermost-webapp/blob/61a4de5e36f994955bacc47c8d56734f9a699a5a/components/channel_layout/channel_controller.jsx#L86)

ä»Šå›ã¯ã€ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã«ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹`registerChannelHeaderButtonAction` API ã‚’ä½¿ã£ã¦ Root Component ã‚’è¡¨ç¤ºã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚å…¨ã¦ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¨˜è¿°ã™ã‚‹ã¨éå¸¸ã«é•·ããªã£ã¦ã—ã¾ã†ãŸã‚ã€Redux ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã‚„ã‚Šã¨ã‚Šãªã©éƒ¨åˆ†ã«ã¤ã„ã¦ã¯æœ¬è¨˜äº‹ã§ã¯å‰²æ„›ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„å ´åˆã¯ã€[kaakaa/mattermost-plugin-api-sample](https://github.com/kaakaa/mattermost-plugin-api-sampleã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚)
ã¾ãŸã€Mattermost å…¬å¼ãƒãƒ¼ãƒ ã«ã‚ˆã‚Šä½œæˆã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¢ç”¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³[mattermost-plugin-demo](https://github.com/mattermost/mattermost-plugin-demo/tree/master/webapp)ã®å®Ÿè£…ã‚‚å‚è€ƒã«ãªã‚Šã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/root-component.gif)

```js
...

import {openRootModal} from './actions'
import reducer from './reducer';

import Root from './components/root';

...

export default class Plugin {
    initialize(registry, store) {
        // (1) Root Componentã®ç™»éŒ²
        registry.registerRootComponent(Root)

        // (2) Root Componentã‚’å‘¼ã³å‡ºã™ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç™»éŒ²
        registry.registerChannelHeaderButtonAction(
            channelHeaderButtonIcon,
            () => store.dispatch(openRootModal()),
            "Open Root modal","Open Root modal"
        );

        registry.registerReducer(reducer);
    }
}
```

ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€`(1)`ã§ Root Component ã¨ãªã‚‹ React Component ã‚’ç™»éŒ²ã—ã€`(2)`ã§ Root Component ã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒãƒ£ãƒ³ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã«ä¸ãˆã¦ã„ã¾ã™ã€‚`(2)`ã®`store.dispatch(openRootModal())`ãŒ Root Component ã‚’è¡¨ç¤ºã™ã‚‹å‡¦ç†ã§ã™ãŒã€ã“ã‚Œã¯ Root Component ã‚’è¡¨ç¤ºã™ã‚‹ state ã‚’æµã™å‡¦ç†ã«ãªã‚Šã¾ã™ã€‚

Root Component ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ã‚ã‚Šã€`visible = true`ã¨ãªã‚‹ã“ã¨ã§ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```js
import React from "react";

const Root = ({ visible, close }) => {
  if (!visible) {
    return null;
  }

  const style = getStyle();

  return (
    <div style={style.backdrop} onClick={close}>
      <div style={style.modal}>
        <p>Root modal</p>
      </div>
    </div>
  );
};

Root.propTypes = {
  visible: PropTypes.bool.isRequired,
  close: PropTypes.func.isRequired,
};

const getStyle = () => ({
  backdrop: {
    position: "absolute",
    display: "flex",
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
    backgroundColor: "rgba(0, 0, 0, 0.50)",
    zIndex: 2000,
    alignItems: "center",
    justifyContent: "center",
  },
  modal: {
    height: "300px",
    width: "500px",
    padding: "1em",
    color: "black",
    backgroundColor: "white",
  },
});

export default Root;
```

Root Component ã¯ React Component ã®ãŸã‚ã€æ§˜ã€…ãªè¦ç´ ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€åŸºæœ¬çš„ã«ã¯é€šçŸ¥ã®ãŸã‚ã«åˆ©ç”¨ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¥åŠ›ã‚’ä¿ƒã™ã‚ˆã†ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å ´åˆã¯[`Interactive Dialog`](https://docs.mattermost.com/developer/interactive-dialogs.html)ã‚’ä½¿ç”¨ã™ã¹ãã ã¨æ€ã„ã¾ã™ã€‚

### [registerPopoverUserAttributesComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerPopoverUserAttributesComponent)

`registerPopoverUserAttributesComponent`ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã‚‹ popover å†…ã«è¡¨ç¤ºã•ã‚Œã‚‹ Component ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

Mattermost å¤–ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹éš›ã«ä½¿ç”¨ã§ãã¾ã™ã€‚æ‰€å±ã®åç§°ãŒã‚³ãƒ­ã‚³ãƒ­å¤‰ã‚ã‚‹ä¼šç¤¾ãªã©ã§ LDAP ã‹ã‚‰æ‰€å±ã‚’å¼•ã„ã¦è¡¨ç¤ºã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚

ç™»éŒ²ã—ãŸ Component ã¯ä»¥ä¸‹ã® props ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚[profile_popover.jsx](https://github.com/mattermost/mattermost-webapp/blob/61a4de5e36f994955bacc47c8d56734f9a699a5a/components/profile_popover/profile_popover.jsx#L356)

- `user`: popover ã§è¡¨ç¤ºã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
  - ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã®ã¯[User](https://github.com/mattermost/mattermost-server/blob/master/model/user.go#L68)ãƒ¢ãƒ‡ãƒ«ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ã«ãªã‚‹ã¨æ€ã„ã¾ã™
  - `User`ãƒ¢ãƒ‡ãƒ«ã§`omitempty`ã¨ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¯ç©ºã®å ´åˆé™¤å¤–ã•ã‚Œã‚‹ãŸã‚ã€å€¤ãŒã‚ã‚‹å ´åˆã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™
- `hide`: popover ã‚’é–‰ã˜ã‚‹é–¢æ•°
- `status`: popover ã§è¡¨ç¤ºã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® status
  - `online`, `offline`ãªã©ã®å˜ãªã‚‹æ–‡å­—åˆ—ã®ã‚ˆã†ã§ã™

ã“ã“ã§ã¯ã€å›ºå®šæ–‡å­—åˆ—ã‚’è¡¨ç¤ºã™ã‚‹ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/user-attribute.png)

```js:index.js
...

import UserAttributes from './components/user_attributes'

...

export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // (1) User Popoverã«èª¬æ˜ã‚’è¿½åŠ ã™ã‚‹Componentã®ç™»éŒ²
		registry.registerPopoverUserAttributesComponent(UserAttributes)
		...
    }
}
```

```js:components/user_attributes.jsx
import React from 'react';
import PropTypes from 'prop-types';

const UserAttributes = ({user, hide, status}) => {
    console.log("user", user.id);
    return (
        <div>
            <p>{'UserId: ' + user.id}</p>
        </div>
    );
}

UserAttributes.propTypes = {
    user: PropTypes.object.isRequired,
    hide: PropTypes.func.isRequired,
    status: PropTypes.object.isRequired,
};

export default UserAttributes;
```

### [registerPopoverUserActionsComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerPopoverUserActionsComponent)

`registerPopoverUserActionsComponent`ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã‚‹ popover å†…ã«è¡¨ç¤ºã•ã‚Œã‚‹ Component ã‚’ç™»éŒ²ã—ã¾ã™ã€‚`registerPopoverUserAttributesComponent`ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€è¡¨ç¤ºã•ã‚Œã‚‹ä½ç½®ãŒç•°ãªã‚‹ã ã‘ã®é•ã„ã ã¨æ€ã„ã¾ã™ã€‚

ç™»éŒ²ã—ãŸ Component ã¯ã€`registerPopoverUserAttributesComponent`ã¨åŒã˜ãä»¥ä¸‹ã® props ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚[profile_popover.jsx](https://github.com/mattermost/mattermost-webapp/blob/61a4de5e36f994955bacc47c8d56734f9a699a5a/components/profile_popover/profile_popover.jsx#L483)

- `user`: popover ã§è¡¨ç¤ºã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `hide`: popover ã‚’é–‰ã˜ã‚‹é–¢æ•°
- `status`: popover ã§è¡¨ç¤ºã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® status

`registerPopoverUserActionsComponent`ã§ã€RootComponent ã‚’è¡¨ç¤ºã™ã‚‹ä¾‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ï¼ˆå‡¦ç†ã‚’ä¸€éƒ¨å‰²æ„›ã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ã¯ https://github.com/kaakaa/mattermost-plugin-api-sample ã‹ã‚‰ç¢ºèªã—ã¦ãã ã•ã„ï¼‰

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/user-action.gif)

```js:index.js
...
import UserAction from './components/user_action';
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // User Popoverã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹Componentã®ç™»éŒ²
		registry.registerPopoverUserActionsComponent(UserAction)
		...
	}
}
```

```js:components/user_action/user_action.jsx
import React from 'react';
import PropTypes from 'prop-types';

const UserActionComponent = ({openRootModal, user, hide, status}) => {
	const onClick = () => {
		openRootModal();
		hide();
	};
    return (
        <div>
            <p>User Action <button onClick={onClick}>Action</button></p>
        </div>
    )
};

UserActionComponent.PropTypes = {
	openRootModal: PropTypes.func.isRequired,
    user: PropTypes.object.isRequired,
    hide: PropTypes.func.isRequired,
    status: PropTypes.object.isRequired,
};

export default UserActionComponent;
```

### [registerLeftSidebarHeaderComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerLeftSidebarHeaderComponent)

`registerLeftSidebarHeaderComponent`ã¯ã€Mattermost ç”»é¢ã®å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«è¡¨ç¤ºã™ã‚‹ Component ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

ç™»éŒ²ã•ã‚ŒãŸ Component ã§ä½¿ç”¨ã§ãã‚‹ props ã¯ç‰¹ã«ã‚ã‚Šã¾ã›ã‚“ã€‚[sidebar.tsx](https://github.com/mattermost/mattermost-webapp/blob/61a4de5e36f994955bacc47c8d56734f9a699a5a/components/sidebar/sidebar.tsx#L179)

å¸¸ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ã®ãŸã‚ã€è·å ´ã®å®¤æ¸©ã‚„ CO2 æ¿ƒåº¦ãªã©ã‚’è¡¨ç¤ºã™ã‚‹ãªã©ã®åˆ©ç”¨æ–¹æ³•ãŒã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/left-sidebar-header.png)

```js:index.js
...
import LeftSidebarHeader from './components/left_sidebar_header';
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // User Popoverã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹Componentã®ç™»éŒ²
		registry.registerLeftSidebarHeaderComponent(LeftSidebarHeader)
		...
	}
}
```

```js:components/left_sidebar_header.jsx
import React from 'react';

const LeftSidebarHeaderComponent = () => {
	const style = {
		color: 'white',
	};
    return (
        <div style={style}>
            <p>left sidear header</p>
        </div>
    );
}

export default LeftSidebarHeader;
```

### [registerBottomTeamSidebarComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerBottomTeamSidebarComponent)

`registerBottomTeamSidebarComponent`ã¯ã€ãƒãƒ¼ãƒ é¸æŠã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ä¸‹éƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹ Component ã‚’ç™»éŒ²ã—ã¾ã™ã€‚ï¼‘ã¤ã®ãƒãƒ¼ãƒ ã«ã—ã‹å‚åŠ ã—ã¦ã„ãªã„å ´åˆã€ãƒãƒ¼ãƒ é¸æŠã‚µã‚¤ãƒ‰ãƒãƒ¼è‡ªä½“ãŒè¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€ã“ã“ã§ç™»éŒ²ã—ãŸ Component ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

ç™»éŒ²ã•ã‚ŒãŸ Component ã§ä½¿ç”¨ã§ãã‚‹ props ã¯ç‰¹ã«ã‚ã‚Šã¾ã›ã‚“ã€‚[legacy_team_sidebar_controller.tsx](https://github.com/mattermost/mattermost-webapp/blob/61a4de5e36f994955bacc47c8d56734f9a699a5a/components/legacy_team_sidebar/legacy_team_sidebar_controller.tsx#L283)

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/bottom-team-sidebar.png)

```js:index.js
...
import BottomTeamSidebar from './components/bottom_team_sidebar';
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // User Popoverã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹Componentã®ç™»éŒ²
		registry.registerLeftSidebarHeaderComponent(BottomTeamSidebar)
		...
	}
}
```

```js:components/bottom_team_sidebar.jsx
import React from 'react';

const BottomTeamSidebarComponent = () => (
    <>
        <a href="https://github.com/">
            <i
                className='icon fa fa-github'
                style={{color: 'white'}}
            />
        </a>
    </>
);

export default BottomTeamSidebarComponent;
```

### [registerLinkTooltipComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerLinkTooltipComponent)

`registerLinkTooltipComponent`ã¯ã€ãƒªãƒ³ã‚¯ã‚’ hover ã—ãŸæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ tooltip ã® Component ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

ç™»éŒ²ã—ãŸ Component ã¯ä»¥ä¸‹ã® props ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚[link_tooltip.tsx](https://github.com/mattermost/mattermost-webapp/blob/cc4ba4576ad978d2a29e6c51c3f12966d121f0d6/components/link_tooltip/link_tooltip.tsx#L113)

- `href`: hover ã—ã¦ã„ã‚‹ãƒªãƒ³ã‚¯ã® URL
- `show`: tooltip ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°

ä»¥ä¸‹ã®ä¾‹ã§ã¯å˜ã« hover ã—ã¦ã„ã‚‹ãƒªãƒ³ã‚¯ã® URL ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã ã‘ã§ã™ãŒã€ãƒªãƒ³ã‚¯å…ˆã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹ã‚ˆã†ãªã“ã¨ã‚‚ã§ãã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/link-tooltip.png)

```js:index.js
...
import LinkTooltip from './components/link_tooltip';
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // User Popoverã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹Componentã®ç™»éŒ²
		registry.registerLinkTooltipComponent(LinkTooltip)
		...
	}
}
```

```js:components/link_tooltip.jsx
import React from 'react';
import PropTypes from 'prop-types';

const LinkTooltipComponent = ({href}) => {
    return (
        <>
            <p style={{
                backgroundColor: 'white',
                color: 'black',
                padding: '25px',
                border: '1px solid red',
            }}>
                {href}
            </p>
        </>
    )
}

LinkTooltipComponent.propTypes = {
    href: PropTypes.string.isRequired,
};

export default LinkTooltipComponent;
```

### [registerChannelHeaderButtonAction](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerChannelHeaderButtonAction)

`registerChannelHeaderButtonAction`ã¯ã€`registerRootComponent`ã®ã¨ã“ã‚ã§ã‚‚ä½¿ç”¨ã—ã¾ã—ãŸãŒã€ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ˜ãƒƒãƒ€éƒ¨åˆ†ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä»˜ãã®ãƒœã‚¿ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

`registerChannelHeaderButtonAction`ã¯ã€`(icon, action, dropdownText, tooltipText)`ã®ï¼”ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚

- `icon`: ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ã™ React Element
- `action`: ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  - ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ã®æƒ…å ±ã‚’æŒã¤[`channel`](https://github.com/mattermost/mattermost-server/blob/master/model/channel.go#L36)ã¨ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®[`channelMember`](https://github.com/mattermost/mattermost-server/blob/master/model/channel_member.go#L44)ã‚’å¼•æ•°ã«å–ã‚‹ã“ã¨ãŒã§ãã¾ã™
- `dropdown_text`: ãƒœã‚¿ãƒ³ãŒè¤‡æ•°ç™»éŒ²ã•ã‚Œã‚‹ã¨ä¸€ã¤ã®ã‚¢ã‚¤ã‚³ãƒ³ã«ã¾ã¨ã‚ã‚‰ã‚Œã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰é¸ã¶å½¢å¼ã«ãªã‚Šã¾ã™ãŒã€ãã®æ™‚ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—
- `tooltip_text`: ãƒœã‚¿ãƒ³ã‚’ hover ã—ãŸæ™‚ã« tooltip ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—

**ãƒœã‚¿ãƒ³å½¢å¼**

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/channel-header-button-button.png)

**ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å½¢å¼**

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/channel-header-button-dropdown.png)

ã“ã“ã§ã¯ã€å…ˆã»ã©ã® Root Comopnent ã‚’é–‹ã Button ã¨ã€ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ Button ã® 2 ã¤ã® Button ã‚’è¡¨ç¤ºã™ã‚‹ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚æŠ•ç¨¿ã®ä½œæˆã¯[mattermost-redux](https://github.com/mattermost/mattermost-redux)ã‚’ä½¿ã£ã¦æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ actions ã‚’ä½œæˆã—ã€Channel Header Button ã® action ã‹ã‚‰å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚

![movie](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/channel-header-button.gif)

```js:index.js
import {openRootModal, createPluginPost} from './actions';
import reducer from './reducer';
import Root from './components/root';

...

export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
        // Root Componentã®ç™»éŒ²
        const rootComponentId = registry.registerRootComponent(Root)

        // Root Componentã‚’å‘¼ã³å‡ºã™ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç™»éŒ²
        registry.registerChannelHeaderButtonAction(
            () => (<i className='icon fa fa-commenting-o' style={{fontSize: '15px', position: 'relative', top: '-1px'}}/>),
            () => store.dispatch(openRootModal()),
            "Open Root modal","Open Root modal"
		);

		...

        // æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒœã‚¿ãƒ³ã‚’ç™»éŒ²
        registry.registerChannelHeaderButtonAction(
            () => (<i className='icon fa fa-commenting-o' style={{fontSize: '15px', position: 'relative', top: '-1px'}}/>),
            (channel, channelMembers) => store.dispatch(createPluginPost(channel.id)),
            "Create Sample Post", "Create Sample Post"
        );

        registry.registerReducer(reducer);
    }
}
```

```js:actions.js
import {createPost} from 'mattermost-redux/actions/posts';
import {getCurrentUserId} from 'mattermost-redux/selectors/entities/users';

...

export function createPluginPost(channelId) {
    return async (dispatch, getState) => {
        const state = getState();
        const userId = getCurrentUserId(state)
        const post = {
            channel_id: channelId,
            user_id: userId,
            message: "Post from webapp plugin",
        }
        return await dispatch(createPost(post));
    }
}
```

### [registerPostTypeComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerPostTypeComponent)

`registerPostTypeComponent`ã¯ã€ç‰¹å®šã® type ã‚’æŒã¤æŠ•ç¨¿ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹æ™‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ Component ã‚’ç™»éŒ²ã—ã¾ã™ã€‚æŠ•ç¨¿ï¼ˆ`Post`ï¼‰ã«ç‹¬è‡ªã® type ã‚’æŒ‡å®šã™ã‚‹å ´åˆã€ãã® type ã¯`custom_`ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ç™»éŒ²ã—ãŸ Component ã¯ä»¥ä¸‹ã® props ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚

- `post`: æŠ•ç¨¿ã®å†…å®¹ [post.go](https://github.com/mattermost/mattermost-server/blob/master/model/post.go#L72)
- `theme`: Mattermost ç”»é¢ã®é…è‰²ãƒ†ãƒ¼ãƒ [constants.jsx](https://github.com/mattermost/mattermost-webapp/blob/0b47780407e1f36e703df45e7fe694c7cf750244/utils/constants.jsx#L1047)

type ã«`custom_sample_post`ã‚’æŒã¤æŠ•ç¨¿ãŒä½œæˆã•ã‚ŒãŸå ´åˆã€èƒŒæ™¯è‰²ãŒèµ¤ã®æŠ•ç¨¿ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚ä»Šå›ã¯ã€Incoming Webhook ã§æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹éš›ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦`custom_sample_post`ã®ç‹¬è‡ª type ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

```bash
curl \
  -H "Content-Type: application/json" \
  -d '{"type": "custom_sample_post", "text": "Sample Message", "props": {"card": "## Sample\n* foo\n* bar"}}'  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/post-type.png)

```js:index.js
...
import CustomPost from './components/custom_post';

export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // type: custom_sample_post ã‚’æŒã¤æŠ•ç¨¿ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹Componentã®ç™»éŒ²
		registry.registerPostTypeComponent('custom_sample_post', CustomPost);
	}
}
...
```

```js:components/custom_post.jsx
import React from 'react';
import PropTypes from 'prop-types';

const {formatText, messageHtmlToComponent} = window.PostUtils;

const CustomPostComponent = ({post, theme}) => {
    const formattedText = messageHtmlToComponent(formatText(post.message));

    console.log('theme', theme);
    return (
        <div style={{backgroundColor: '#ffcccc'}}>
            {formattedText}
            <pre>
                {JSON.stringify(post.props, null, 4)}
            </pre>
        </div>
    )
}

CustomPostComponent.propTypes = {
    post: PropTypes.object.isRequired,
    theme: PropTypes.object.isRequired,
};

export default CustomPostComponent;
```

ç‹¬è‡ªã® type ã‚’æŒ‡å®šã—ãŸæŠ•ç¨¿ã‚’ä½œæˆã—ãŸå¾Œã« Plugin ã‚’ç„¡åŠ¹ã«ã™ã‚‹ãªã©ã€type ã«å¯¾å¿œã—ãŸ Component ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€é€šå¸¸ã®æŠ•ç¨¿ã¨åŒã˜ã‚ˆã†ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

### [registerPostCardTypeComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerPostCardTypeComponent)

`registerPostCardTypeComponent`ã¯ã€ç‰¹å®šã® type ã‚’æŒã¤æŠ•ç¨¿ã®`card`è¦ç´ ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹æ™‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ Component ã‚’ç™»éŒ²ã—ã¾ã™ã€‚æŠ•ç¨¿ï¼ˆ`Post`ï¼‰ã«ç‹¬è‡ªã® type ã‚’æŒ‡å®šã™ã‚‹å ´åˆã€ãã® type ã¯`custom_`ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ç™»éŒ²ã—ãŸ Component ã¯ä»¥ä¸‹ã® props ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚

- `post`: æŠ•ç¨¿ã®å†…å®¹ [post.go](https://github.com/mattermost/mattermost-server/blob/master/model/post.go#L72)
- `theme`: Mattermost ç”»é¢ã®é…è‰²ãƒ†ãƒ¼ãƒ [constants.jsx](https://github.com/mattermost/mattermost-webapp/blob/0b47780407e1f36e703df45e7fe694c7cf750244/utils/constants.jsx#L1047)

type ã«`custom_sample_card`ã‚’æŒã¤æŠ•ç¨¿ãŒä½œæˆã•ã‚ŒãŸå ´åˆã€èƒŒæ™¯è‰²ãŒé’ã®ã‚«ãƒ¼ãƒ‰è¦ç´ ã‚’æŒã¤æŠ•ç¨¿ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚`custom_sample_card`ã¨ã„ã†ç‹¬è‡ª type ã¯ Incoming Webhook ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

```bash
curl \
  -H "Content-Type: application/json" \
  -d '{"type": "custom_sample_card", "text": "Sample Message", "props": {"card": "## Sample\n* foo\n* bar"}}'  \
  http://localhost:8065/hooks/ucw5qjw86jgeum77o1uw8197jr
```

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/post-card-type.png)

ä½œæˆã™ã‚‹æŠ•ç¨¿ã«`props.card`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒãªã„å ´åˆã€`card`è¦ç´ ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®`i`ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã‚«ãƒ¼ãƒ‰è¦ç´ ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚å¿…ãš`props.card`è¦ç´ ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```js:index.js
...
import CustomCard from './components/custom_card';

export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // type: custom_sample_card ã‚’æŒã¤æŠ•ç¨¿ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹Componentã®ç™»éŒ²
        registry.registerPostCardTypeComponent('custom_sample_card', CustomCard);
	}
}
...
```

```js:components/custom_card.jsx
import React from 'react';
import PropTypes from 'prop-types';

const {formatText, messageHtmlToComponent} = window.PostUtils;

const CustomCardComponent = ({post, theme}) => {
    const formattedText = messageHtmlToComponent(formatText(post.message));

    console.log('theme', theme);
    return (
        <div style={{backgroundColor: '#ccccff'}}>
            {formattedText}
            <pre>
                {JSON.stringify(post.props, null, 4)}
            </pre>
        </div>
    )
}

CustomCardComponent.propTypes = {
    post: PropTypes.object.isRequired,
    theme: PropTypes.object.isRequired,
};

export default CustomCardComponent;
```

ç‹¬è‡ªã® type ã‚’æŒ‡å®šã—ãŸæŠ•ç¨¿ã‚’ä½œæˆã—ãŸå¾Œã« Plugin ã‚’ç„¡åŠ¹ã«ã™ã‚‹ãªã©ã€type ã«å¯¾å¿œã—ãŸ Component ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã€é€šå¸¸ã®æŠ•ç¨¿ã¨åŒã˜ã‚ˆã†ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

### [registerPostWillRenderEmbedComponent ](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerPostWillRenderEmbedComponent)

`registerPostWillRenderEmbedComponent`ã¯ã€æŠ•ç¨¿å†…ã§æœ€åˆã«å‡ºç¾ã™ã‚‹ URL ã®å†…å®¹ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã™ã‚‹éƒ¨åˆ†ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚OpenGraph ã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ¬ã§ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/post-will-render-embed-sample.png)

`registerPostWillRenderEmbedComponent`ã¯ 3 ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚

- `match`: ã“ã“ã§æŒ‡å®šã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦ç´ ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‹ã©ã†ã‹ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã®é–¢æ•°ã€‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºå¯¾è±¡ã® URL ã‚„ç¨®åˆ¥ã‚’ä½¿ã„ã€`true`ã‚’è¿”ã™ã¨ã“ã“ã§æŒ‡å®šã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã€‚
- `component`: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦ç´ ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `toggleable`: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦ç´ ã‚’æŠ˜ã‚Šç•³ã¿å¯èƒ½ã«ã™ã‚‹ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°

ã¾ãŸã€ç™»éŒ²ã—ãŸ`Component`ã¯ä»¥ä¸‹ã® props ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚

- `embed`: æŠ•ç¨¿ã®å†…å®¹ [post.go](https://github.com/mattermost/mattermost-server/blob/master/model/post.go#L72)
  - `type`: `url`ã‹ã‚‰å–å¾—ã§ãã‚‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ç¨®åˆ¥ã€‚`opengraph`ã‚„`image`ãªã©ã®å€¤ãŒå…¥ã‚‹
  - `url`: æŠ•ç¨¿ãªã„ã§æœ€åˆã«å‡ºç¾ã™ã‚‹ URL
  - `data`: `url`ã‹ã‚‰å–å¾—ã§ãã‚‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹ã«é–¢ã™ã‚‹æƒ…å ±ãŒæ ¼ç´ã•ã‚Œã‚‹ã‚‰ã—ã„ãŒã€è©¦ã—ã¦ã„ã‚‹ä¸­ã§ã¯å€¤ãŒå–å¾—ã§ããªã‹ã£ãŸ

`https://github.com/mattermost`ã§å§‹ã¾ã‚‹ URL ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã«ã€é’ã„èƒŒæ™¯è‰²ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/post-will-render-embed.png)

```js:index.js
...
import CustomEmbed from './components/custom_embed';

export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // æŠ•ç¨¿ã«å«ã¾ã‚Œã‚‹URLã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹Componentã®ç™»éŒ²
        registry.registerPostWillRenderEmbedComponent(
            (embed) => embed.url && embed.url.startsWith(`https://github.com/mattermost/`),
            CustomEmbed,
            true
        );
    }
}
...
```

```js:components/custom_embed.jsx
import React from 'react';
import PropTypes from 'prop-types';

const CustomEmbedComponent = ({embed}) => {
    const {type, url, data} = embed;
    return (
        <div style={{backgroundColor: '#ccffcc'}}>
            <p>{type}</p>
            <p>{url}</p>
            <pre>
                {JSON.stringify(data, null, 4)}
            </pre>
        </div>
    )
}

CustomEmbedComponent.propTypes = {
    embed: PropTypes.shape ({
        type: PropTypes.string.isRequired,
        url: PropTypes.string.isRequired,
        data: PropTypes.object.isRequired,
    })
};

export default CustomEmbedComponent;
```

ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã®`oEmbed-plugin`ãƒ–ãƒ©ãƒ³ãƒã«ã€Mattermost å…¬å¼ãƒãƒ¼ãƒ ã«ã‚ˆã‚‹`registerPostWillRenderEmbedComponent`ã‚’ä½¿ç”¨ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®Ÿè£…ãŒæ®‹ã£ã¦ã„ã¾ã™ã€‚ï¼ˆä½œã‚Šã‹ã‘ã§æ­¢ã¾ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ãŒï¼‰
https://github.com/mattermost/mattermost-plugin-oembed/tree/oEmbed-plugin

### [registerMainMenuAction](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerMainMenuAction)

`registerMainMenuAction`ã¯ã€Mattermost ã®ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼éƒ¨åˆ†ã«ç‹¬è‡ªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`registerPostWillRenderEmbedComponent`ã¯ 3 ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚

- `text`: ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—ã‹ React Element ã‚’æŒ‡å®šã—ã¾ã™
- `action`: ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé¸æŠã•ã‚ŒãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™
- `mobileIcon`: ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç™»éŒ²ã—ã¾ã™ï¼ˆãŒã€ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã ã¨ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã•ã‚Œãªã„...?ï¼‰

ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚ŒãŸãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/main-menu.gif)

```js:index.js
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹
        registry.registerMainMenuAction(
            'Sample Main Menu',
            () => store.dispatch(openRootModal()),
            () => (<i className='icon fa fa-plug' style={{fontSize: '15px', position: 'relative', top: '-1px'}}/>)
        );
    }
}
...
```

### [registerChannelHeaderMenuAction](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerChannelHeaderMenuAction)

`registerChannelHeaderMenuAction`ã¯ã€ãƒãƒ£ãƒ³ãƒãƒ«åã®éƒ¨åˆ†ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ç‹¬è‡ªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`registerPostWillRenderEmbedComponent`ã¯ 2 ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚

- `text`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—ã‹ React Element
- `action`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé¸æŠã•ã‚ŒãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚å®Ÿè¡Œã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒãƒ£ãƒ³ãƒãƒ« ID ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚

ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/channel-header-menu-action.gif)

```js:index.js
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // ãƒãƒ£ãƒ³ãƒãƒ«åã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ç‹¬è‡ªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹
        registry.registerChannelHeaderMenuAction(
            <i className='icon fa fa-plug' style={{fontSize: '15px', position: 'relative', top: '-1px'}}>{'Sample Menu'}</i>,
            (chnnelId) => store.dispatch(openRootModal())
        );
    }
}
...
```

### [registerPostDropdownMenuAction](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerPostDropdownMenuAction)

`registerPostDropdownMenuAction`ã¯ã€æŠ•ç¨¿ã«å¯¾ã™ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ç‹¬è‡ªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`registerPostDropdownMenuAction`ã¯ 3 ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚

- `text`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—ã‹ React Element
- `action`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé¸æŠã•ã‚ŒãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå®Ÿè¡Œã•ã‚ŒãŸæŠ•ç¨¿ã® PostID ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚
- `filter`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ã‚’æ±ºå®šã™ã‚‹é–¢æ•°ã€‚å®Ÿè¡Œã•ã‚ŒãŸæŠ•ç¨¿ã® PostID ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚

ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚ŒãŸãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/post-dropdown-menu-action.gif)

```js:index.js
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // æŠ•ç¨¿ã«å¯¾ã™ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ç‹¬è‡ªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹
        registry.registerPostDropdownMenuAction(
            <i className='icon fa fa-plug' style={{fontSize: '15px'}}>{'Sample Post Menu'}</i>,
            (postId) => store.dispatch(openRootModal()),
            (postId) => { return true; }
        );
    }
}
...
```

### [registerPostDropdownSubMenuAction](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerPostDropdownSubMenuAction)

`registerPostDropdownSubMenuAction`ã¯ã€æŠ•ç¨¿ã«å¯¾ã™ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä»˜ãã®ç‹¬è‡ªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

ã¾ãšã€`registerPostDropdownSubMenuAction`ã¯ 3 ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚

- `text`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—ã‹ React Element
- `action`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé¸æŠã•ã‚ŒãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚å®Ÿè¡Œã•ã‚ŒãŸæŠ•ç¨¿ã® PostID ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚(ã—ã‹ã—ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ä½•ã‚‚å®Ÿè¡Œã•ã‚Œãªã„ã‚ˆã†ã§ã™)
- `filter`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ã‚’æ±ºå®šã™ã‚‹é–¢æ•°ã€‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå®Ÿè¡Œã•ã‚ŒãŸæŠ•ç¨¿ã® PostID ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚

`registerPostDropdownSubMenuAction`ã¯ã€è¿”ã‚Šå€¤ã¨ã—ã¦ç™»éŒ²ã—ãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã® ID ã¨ã€ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç™»éŒ²ã™ã‚‹ãŸã‚ã®é–¢æ•°ã‚’è¿”ã—ã¾ã™ã€‚ã“ã“ã§è¿”ã•ã‚Œã‚‹é–¢æ•°ã‚’ä½¿ã£ã¦ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç™»éŒ²ã—ã¦ã„ãã¾ã™ãŒã€ã“ã®é–¢æ•°ã¯ 2 ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚

- `text`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—åˆ—ã‹ React Element
- `action`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé¸æŠã•ã‚ŒãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå®Ÿè¡Œã•ã‚ŒãŸæŠ•ç¨¿ã® PostID ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚

ï¼ˆã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç™»éŒ²ã™ã‚‹é–¢æ•°ã®ç¬¬ 3 å¼•æ•°ã¨ã—ã¦`filter`ã¨ãªã‚‹é–¢æ•°ã‚’æ¸¡ã—ã¦ã‚‚ã€ç‰¹ã«åŠ¹æœã¯ãªã„ã‚ˆã†ã§ã™ï¼‰

ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚ŒãŸãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/post-dropdown-submenu.gif)

```js:index.js
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // æŠ•ç¨¿ã«å¯¾ã™ã‚‹ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä»˜ãã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹
        const {id, rootRegisterMenuItem} = registry.registerPostDropdownSubMenuAction(
            <i className='icon fa fa-plug' style={{fontSize: '15px'}}>{'Sample SubMenu'}</i>,
            (postId) => store.dispatch(openRootModal()),  // å®Ÿè¡Œã•ã‚Œãªã„
            (postId) => { return true; }
        );
        rootRegisterMenuItem(
            <i className='icon fa fa-plug' style={{fontSize: '15px'}}>{'SubMenu 1'}</i>,
            (postId) => store.dispatch(openRootModal()),
        );
        rootRegisterMenuItem(
            <i className='icon fa fa-plug' style={{fontSize: '15px'}}>{'SubMenu 2'}</i>,
            (postId) => store.dispatch(openRootModal())
        );
    }
}
...
```

### [registerPostDropdownMenuComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerPostDropdownMenuComponent)

`registerPostDropdownMenuComponent`ã¯ã€æŠ•ç¨¿ã«å¯¾ã™ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ç‹¬è‡ªã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

ç™»éŒ²ã—ãŸ Component ã¯ä»¥ä¸‹ã® props ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚

- `postId`: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚ŒãŸæŠ•ç¨¿ã® PostID
- `theme`: Mattermost ç”»é¢ã®é…è‰²ãƒ†ãƒ¼ãƒ [constants.jsx](https://github.com/mattermost/mattermost-webapp/blob/0b47780407e1f36e703df45e7fe694c7cf750244/utils/constants.jsx#L1047)
- `dispatch`: action ã‚’ dispatch ã™ã‚‹ãŸã‚ã®é–¢æ•°

ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚ŒãŸãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/post-dropdown-component.gif)

```js:index.js
...
import CustomPostDropdown from './components/custom_post_dropdown';
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // æŠ•ç¨¿ã«å¯¾ã™ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç™»éŒ²ã™ã‚‹
        registry.registerPostDropdownMenuComponent(CustomPostDropdown);
		...
	}
}
```

```js:components/custom_post_dropdown.jsx
import React from 'react';
import PropTypes from 'prop-types';

import {openRootModal} from 'actions';

const CustomPostDropdownComponent = ({postId, theme, dispatch}) => {
    return (
        <div
            style={{backgroundColor: '#ffcccc'}}
            onClick={() => dispatch(openRootModal())}
        >
            {postId}
        </div>
    )
}

CustomPostDropdownComponent.propTypes = {
    postId: PropTypes.string.isRequired,
    theme: PropTypes.object.isRequired,
    dispatch: PropTypes.func.isRequired,
};

export default CustomPostDropdownComponent;
```

### [registerFileUploadMethod](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerFileUploadMethod)

`registerFileUploadMethod`ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ç‹¬è‡ªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`registerFileUploadMethod`ã¯ 3 ã¤ã®å¼•æ•°ã‚’å–ã‚Šã¾ã™ã€‚(å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å¼•æ•°ã®é †åºãŒé•ã£ã¦ã„ã‚‹ã®ã§æ³¨æ„)

- `icon`: JSX å½¢å¼ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¢ã‚¤ã‚³ãƒ³
- `action`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé¸æŠã•ã‚ŒãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®é–¢æ•°ãŒæ¸¡ã•ã‚Œã¾ã™ã€‚
- `text`: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆ

ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé¸æŠã•ã‚Œã‚‹ã¨ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒ 2 ã¤ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/file-upload-method.gif)

```js:index.js
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã™ã‚‹
        registry.registerFileUploadMethod(
            <i className='icon fa fa-pencil-square-o' style={{fontSize: '15px'}}/>,
            (upload) => upload([
                new File(["test1"], "sample1.txt"),
                new File(["test2"], 'sample2.txt')
            ]),
            'Sample File Upload'
        );
    }
}
...
```

### [registerFilesWillUploadHook](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerFilesWillUploadHook)

`registerFilesWillUploadHook`ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°ã‚’ç™»éŒ²ã§ãã¾ã™ã€‚

`registerFilesWillUploadHook`ã¯ 2 ã¤ã®å¼•æ•°ã‚’å–ã‚‹é–¢æ•°ã‚’å¼•æ•°ã«å–ã‚Šã¾ã™ã€‚

- `files`: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®é…åˆ—
- `upload`: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®é–¢æ•°
  - ã“ã®é–¢æ•°ã‚’ä½¿ã‚ãªãã¨ã‚‚ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿”å´å€¤ã¨ã—ã¦æŒ‡å®šã™ã‚‹ã“ã¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™

è¿”ã‚Šå€¤ã¨ã—ã¦ä»¥ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”å´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- `message`: å‡¦ç†çµæœã¨ã—ã¦ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¾ã™
- `files`: å‡¦ç†çµæœã¨ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…åˆ—ã¨ã—ã¦æŒ‡å®šã—ã¾ã™ã€‚`null`ã‚’æŒ‡å®šã™ã‚‹ã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’ reject ã—ã¾ã™ã€‚

2 ã¤ä»¥ä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŒæ™‚ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’ reject ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/files-will-upload-hook.gif)

```js:index.js
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®å‡¦ç†ã‚’ç™»éŒ²ã™ã‚‹
        registry.registerFilesWillUploadHook((files, upload) => {
            let msg = '';
            if (files.length >= 2 ) {
                files = null;
                msg = 'Must upload one by one.';
            }
            return {
                message: msg,
                files: files,
            };
        });
    }
}
...
```

### [unregisterComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#unregisterComponent)

`unregisterComponent`ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦ç™»éŒ²ã—ãŸ Component ã‚„ Hook ã‚’ç™»éŒ²ã‹ã‚‰é™¤å¤–ã—ã¾ã™ã€‚

`registerLeftSidebarHeaderComponent`ã«ã‚ˆã£ã¦ç™»éŒ²ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç™»éŒ²ã‹ã‚‰é™¤å¤–ã™ã‚‹ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day20/unregister-component.gif)

```js:index.js
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹Componentã®ç™»éŒ²
        const leftSidebarHeaderComponentId = registry.registerLeftSidebarHeaderComponent(LeftSidebarHeader);
        ...
        // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ã‚ˆã£ã¦ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç™»éŒ²ã‹ã‚‰é™¤å¤–ã™ã‚‹
        registry.registerMainMenuAction(
            'Unregister LeftSideberHeader',
            () => registry.unregisterComponent(leftSidebarHeaderComponentId),
            () => (<i className='icon fa fa-plug' style={{fontSize: '15px', position: 'relative', top: '-1px'}}/>)
        );
    }
}
...
```

### [unregisterPostTypeComponent](https://developers.mattermost.com/extend/plugins/webapp/reference/#unregisterPostTypeComponent)

`unregisterPostTypeComponent`ã¯ã€`unregisterComponent`ã¨åŒæ§˜ã€ç‹¬è‡ªã®`PostType`ã«å¯¾ã—ã¦è¨­å®šã—ãŸ Component ã‚’ç™»éŒ²ã‹ã‚‰é™¤å¤–ã—ã¾ã™ã€‚

ä¾‹ã¯çœç•¥ã—ã¾ã™ã€‚

### [registerReducer](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerReducer)

`registerReducer`ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å†…ã§ä½¿ç”¨ã™ã‚‹ Reducer ã‚’ç™»éŒ²ã—ã¾ã™ã€‚

ã“ã“ã¾ã§ã«ç´¹ä»‹ã—ã¦ããŸä¾‹ã§ã¯ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚ŒãŸå ´åˆãªã©ã«`registerReducer`ã«ã‚ˆã£ã¦ç™»éŒ²ã•ã‚ŒãŸ reducer ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

```js:index.js
...
import reducer from './reducer';
...
export default class Plugin {
    // eslint-disable-next-line no-unused-vars
    initialize(registry, store) {
		...
        // Reducerã‚’ç™»éŒ²ã™ã‚‹
        registry.registerReducer(reducer);
    }
}
```

```js:reducer.js
import {combineReducers} from 'redux';

import {OPEN_ROOT_MODAL, CLOSE_ROOT_MODAL} from './action_types';

const rootModalVisible = (state = false, action) => {
    switch (action.type) {
    case OPEN_ROOT_MODAL:
        return true;
    case CLOSE_ROOT_MODAL:
        return false;
    default:
        return state;
    }
};

export default combineReducers({
    rootModalVisible,
});
```

```js:action_types.js
import {id as pluginId} from './manifest';

export const OPEN_ROOT_MODAL = pluginId + '_open_root_modal';
export const CLOSE_ROOT_MODAL = pluginId + '_close_root_modal';
```

## ã•ã„ã”ã«

æœ¬æ—¥ã¯ã€Mattermost Plugin ã®**Webapp**ã‚µã‚¤ãƒ‰ã®å®Ÿè£…ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
æ˜æ—¥ã¯ã€æ®‹ã‚Šã®**Webapp**ã‚µã‚¤ãƒ‰ã® API ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚
