---
title: "Gradleã§bowerã‚’åˆ©ç”¨ã—ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ã¾ã§ã‚’è¡Œã†æ–¹æ³•  (6/6)"
date: 2016-03-31T05:00:00+09:00
emoji: "ğŸ“£"
type: "tech"
topics: [Java, gradle, grunt, bower, Docker]
published: false
---

# ã¯ã˜ã‚ã«

Java/Spark ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® Gradle ã‚’åˆ©ç”¨ã—ãŸãƒ“ãƒ«ãƒ‰/ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¤ã„ã¦ã€ç§ãŒè©¦ã—ãŸã“ã¨ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚
(ã“ã“ã§è¨€ã†`Spark`ã¯ã€åˆ†æ•£å‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®`Apache Spark`ã§ã¯ãªãã€Java ã® Sinatra ãƒ©ã‚¤ã‚¯ãª Microframework ã®`Spark`ã®ã“ã¨ã§ã™)

## ç›®æ¬¡

1. [Hello World ã‚¢ãƒ—ãƒª](http://qiita.com/kaakaa_hoe/items/0e3c622ae8bde3d116ad)
2. [jade ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³](http://qiita.com/kaakaa_hoe/items/6d4311e250df89f836b9)
3. [Grunt/bower ã«ã‚ˆã‚‹ Web ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰](http://qiita.com/kaakaa_hoe/items/61b326dcc5d7f161ff28)
4. [ä»˜éŒ² A. TravisCI ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰](http://qiita.com/kaakaa_hoe/items/373a5a8718c92676771f)
5. [ä»˜éŒ² B. Gradle ã§ docker build](http://qiita.com/kaakaa_hoe/items/18e5f3047931ee886acb)
6. **ä»˜éŒ² C. TravisCI ã‹ã‚‰ DockerHub ã¸ docker push**

å„ç« ã§ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ [Commits Â· kaakaa/gradle-frontend-boilerplate](https://github.com/kaakaa/gradle-frontend-boilerplate/commits/master) ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

## ç’°å¢ƒ

- Java 1.8.0_74
- Gradle 2.12
- spark-core 2.3
- spark-template-jade 2.3
- node.js 4.4.0

# ä»˜éŒ² C. TravisCI ã‹ã‚‰ DockerHub ã¸ docker push

## æ¦‚è¦

Github ã¸ã® Push ã‚’å¥‘æ©Ÿã« TravisCI ã§ Docker ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã„ã€Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ DockerHub ã¸ Push ã™ã‚‹

---

TravisCI ä¸Šã§ã¯ Docker Remote API ãŒèµ·å‹•ã—ã¦ã„ãªã•ãã†ãªã®ã§ã€å…ˆã»ã©ä½œã£ãŸ`buildDockerImage`ã‚¿ã‚¹ã‚¯ã¯ä½¿ç”¨ã›ãšã€æ™®é€šã®`docker build`ã‚³ãƒãƒ³ãƒ‰ã§ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã€‚

## ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```yaml:.travis.yml
sudo: required  // (1) - Dockerã‚’ä½¿ã†ã“ã¨ã‚’å®£è¨€
services:
- docker
language: java
jdk:
- oraclejdk8
env:  // (2) - Dockerãƒ“ãƒ«ãƒ‰ã€DockerHubã¸ã®Pushã«ä½¿ã†æƒ…å ±ã‚’å®£è¨€ã™ã‚‹
  global:
  - REPO=kaakaa/gradle-frontend-boilerplate
  - COMMIT=${TRAVIS_COMMIT::8}
  - TAG=${COMMIT}
  - secure: <encrypted env>
  - secure: <encrypted env>
  - secure: <encrypted env>

script: "./gradlew build"
deploy:
  provider: releases
  api_key:
    secure: <encrypted repo>
  file:
  - "./build/distributions/gradle-frontend-boilerplate-1.0-SNAPSHOT.tar"
  - "./build/distributions/gradle-frontend-boilerplate-1.0-SNAPSHOT.zip"
  on:
    repo: kaakaa/gradle-frontend-boilerplate
    tags: true

after_deploy:  // (3) - Dockerãƒ“ãƒ«ãƒ‰ã€DockerHubã¸ã®Pushã‚’ã™ã‚‹
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
- docker build -f Dockerfile -t $REPO:$COMMIT .
- docker tag $REPO:$COMMIT $REPO:$TAG
- docker push $REPO:$COMMIT
```

### (1) Docker ã‚’ä½¿ã†ã“ã¨ã‚’å®£è¨€

Travis ãƒ“ãƒ«ãƒ‰ã§`docker`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ã“ã®ï¼“è¡ŒãŒå¿…è¦ã€‚  
[Using Docker in Builds - Travis CI](https://docs.travis-ci.com/user/docker/)

### (2) Docker ãƒ“ãƒ«ãƒ‰ã€DockerHub ã¸ã® Push ã«ä½¿ã†æƒ…å ±ã‚’å®£è¨€ã™ã‚‹

Docker ã‚¤ãƒ¡ãƒ¼ã‚¸åã‚„ DockerHub ã¸ Push ã™ã‚‹éš›ã®åå‰ã®æƒ…å ±ãªã©ã‚’å®£è¨€ã—ã¦ã„ã‚‹ã€‚  
`${TRAVIS_COMMIT}`ã¯ Travis ã§ã®ãƒ“ãƒ«ãƒ‰ãŒèµ°ã‚‹éš›ã® git ã®ã‚³ãƒŸãƒƒãƒˆ ID ã‚’ç¤ºã—ã¦ãŠã‚Šã€`${TRAVIS_COMMIT::8}`ã§ã€ãã®å…ˆé ­ï¼˜æ–‡å­—ã‚’å–å¾—ã§ãã‚‹ã€‚  
[Environment Variables - Travis CI](https://docs.travis-ci.com/user/environment-variables/#Default-Environment-Variables)

`secure`æ–‡å­—åˆ—ã¯ DockerHub ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’ encrypt ã—ãŸæ–‡å­—åˆ—ã€‚  
ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§ç”Ÿæˆã§ãã‚‹ã€‚

```
travis encrypt DOCKEREMAIL=hoge@exampl.com --add env.global
travis encrypt DOCKER_USER=kaakaa --add env.global
travis encrypt DOCKER_PASS=password --add env.global
```

[Using Docker in Builds - Travis CI](https://docs.travis-ci.com/user/docker/#Pushing-a-Docker-Image-to-a-Registry)  
[Encryption keys - Travis CI](https://docs.travis-ci.com/user/encryption-keys/)

### (3) Docker ãƒ“ãƒ«ãƒ‰ã€DockerHub ã¸ã® Push ã‚’ã™ã‚‹

docker ã‚³ãƒãƒ³ãƒ‰ã‚’æ™®é€šã«æ‰“ã£ã¦ã‚‹ã ã‘ã€‚

Travis ã§ã¯ Docker Remote API ãŒèµ·å‹•ã—ã¦ãªã„ã®ã§ gradle ã®`buildDockerImage`ã‚¿ã‚¹ã‚¯ãŒä½¿ãˆãªã„ã®ãŒæ‚²ã—ã„ã€‚

## ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```groovy:build.gradle
build.dependsOn installDist
```

Travis ä¸Šã§å®Ÿè¡Œã—ã¦ã„ã‚‹`build`ã‚¿ã‚¹ã‚¯ãŒã€Docker ãƒ“ãƒ«ãƒ‰ã§å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã®`installDist`ã‚¿ã‚¹ã‚¯ã«ä¾å­˜ã™ã‚‹ã‚ˆã†ã€ã©ã“ã‹ã«ä¸Šè¨˜ï¼‘è¡Œã‚’è¿½åŠ ã™ã‚‹ã€‚
