---
title: "[Mattermost Integrations] Slash Command ç™ºå±•ç·¨"
date: 2020-12-07T00:00:00+09:00
emoji: "ğŸ“†"
type: "tech"
topics: ["Mattermost"]
published: true
---

Mattermost è¨˜äº‹ã¾ã¨ã‚: https://blog.kaakaa.dev/tags/mattermost/

## æœ¬è¨˜äº‹ã«ã¤ã„ã¦

Mattermost ã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ç¬¬ 7 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

å‰å›ã®è¨˜äº‹ã§ã¯ã€Mattermost ã§`/`ã§å§‹ã¾ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ç‰¹å®šã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ Slash Command ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚ã¾ãŸã€Custom Slash Command ã«ã‚ˆã‚Šå¤–éƒ¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã€Custome Slash Command ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚ŒãŸå¤–éƒ¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã‹ã‚‰ Mattermost å´ã¸è¿”å´ã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

## Slash Command ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹

Slash Command ã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ãŸå¤–éƒ¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦ Mattermost ã«æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯æ˜¨æ—¥ã®ã‚³ãƒ¼ãƒ‰ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚‚ã®ã§ã™ã€‚

```go
package main

import (
	"fmt"
	"io"
	"log"
	"net/http"
)

const (
	WebHookToken = "8w7foap4ufrsfczda8uez51yxo"
)

func main() {
	http.HandleFunc("/command", func(w http.ResponseWriter, r *http.Request) {
		log.Printf("%#v", r.Form)
		r.ParseForm()

		log.Printf("token: %v", r.Form.Get("token"))
		// (1) Tokenã‚’ãƒã‚§ãƒƒã‚¯
		if r.Form.Get("token") != WebHookToken {
			log.Printf("received an invalid request with token: %s", r.Form.Get("token"))
			return
		}

		// (2) ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦Mattermostã¸æŠ•ç¨¿ã‚’ä½œæˆ
		w.Header().Add("Content-Type", "application/json")
		io.WriteString(w, fmt.Sprintf(`{"text": "**%s**"}`, r.Form.Get("text")))
	})
	http.ListenAndServe(":8080", nil)
}
```

Outgoing WebHook ã®æ™‚ã¨ã»ã¼åŒã˜ã§ã™ãŒã€`(1)` ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åˆ©ç”¨ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ¤œè¨¼ã‚’è¡Œã„ã€`(2)` ã§ Slash Command ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦æŠ•ç¨¿ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã¸ã®`Content-Type: application/json`ã®è¨­å®šã¯å¿…é ˆã§ã™ã€‚`text`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æŒ‡å®šã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ Mattermost ã«æŠ•ç¨¿ã•ã‚Œã¾ã™ã€‚

ã“ã®ã‚µãƒ¼ãƒã«å¯¾ã—ã¦`/ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒãƒ³ãƒ‰ TEST`ã¨ã„ã† Slash Command ã‚’é€ä¿¡ã—ãŸæ™‚ã®ç”»é¢ãŒä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚

![response](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/response-slash-command.png)

ä½œæˆã•ã‚ŒãŸæŠ•ç¨¿ã«ã¯ã€`BOT`ã¨ã„ã†ãƒ©ãƒ™ãƒ«ã«åŠ ãˆã€`(ã‚ãªãŸã ã‘ãŒè¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™)`ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã¤ã„ã¦ã„ã¾ã™ã€‚Slash Command ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦ä½œæˆã—ãŸæŠ•ç¨¿ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ Slash Command ã‚’å®Ÿè¡Œã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã—ã‹è¦‹ã‚‹ã“ã¨ãŒã§ããªã„æŠ•ç¨¿ã«ãªã‚Šã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã¯è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ãƒãƒ£ãƒ³ãƒãƒ«ã®å…¨å“¡ãŒé–²è¦§å¯èƒ½ãªæŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã«ã¯ã€å¾Œè¿°ã®`response_type`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã™ã€‚

## Slash Command ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

### `text`

æŠ•ç¨¿ã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚ã‚Šã€å¾Œè¿°ã®`attachments`ã‚’æŒ‡å®šã—ãªã„å ´åˆã¯å¿…é ˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚Markdown è¨˜æ³•ã‚„ã€`@`ã«ã‚ˆã‚‹ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’æŠ•ç¨¿ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```go
io.WriteString(w, `{"text": "**TEST**"}`)
```

### `response_type`

Slash Command ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã‚ˆã‚Šä½œæˆã•ã‚Œã‚‹æŠ•ç¨¿ã®ç¨®åˆ¥ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`ephemeral`ã§ã‚ã‚Šã€Slash Command ã‚’å®Ÿè¡Œã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã—ã‹è¦‹ãˆãªã„æŠ•ç¨¿ã«ãªã‚Šã¾ã™ã€‚ãƒãƒ£ãƒ³ãƒãƒ«å…¨å“¡ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯`response_type`ã«`in_channel`ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```go
io.WriteString(w, `{"text": "**TEST**", "response_type": "in_channel"}`)
```

### `username`, `icon_url`

Slash Command ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦ä½œæˆã•ã‚Œã‚‹æŠ•ç¨¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã‚¢ã‚¤ã‚³ãƒ³ã®è¡¨ç¤ºã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã‚’ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ä¸‹è¨˜ã®è¨­å®šã‚’ãã‚Œãã‚Œ`æœ‰åŠ¹`ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- **ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ« > çµ±åˆæ©Ÿèƒ½ç®¡ç† > çµ±åˆæ©Ÿèƒ½ã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ä¸Šæ›¸ãã‚’è¨±å¯ã™ã‚‹**
- **ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ« > çµ±åˆæ©Ÿèƒ½ç®¡ç† > çµ±åˆæ©Ÿèƒ½ã«ã‚ˆã‚‹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚¢ã‚¤ã‚³ãƒ³ã®ä¸Šæ›¸ãã‚’è¨±å¯ã™ã‚‹**

ï¼ˆã“ã®è¨­å®šã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€`username`ã¨`icon_url`ã‚’æŒ‡å®šã—ãªã„å ´åˆã®æŠ•ç¨¿ã®ä½œæˆè€…ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ã‚¤ã‚³ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å(`webhook`)ã«å¤‰æ›´ã•ã‚Œã¾ã™ï¼‰

```go
io.WriteString(w, `{
	"text": "**TEST**",
	"username": "new-bot",
	"icon_emoji": "http://www.mattermost.org/wp-content/uploads/2016/04/icon_WS.png"
}`)
```

![use overwrite](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/example-overwrite.png)

### `channel_id`

æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æŒ‡å®šã§ãã¾ã™ã€‚ã“ã“ã§æŒ‡å®šã™ã‚‹ãƒãƒ£ãƒ³ãƒãƒ« ID ã¯ã€**ãƒãƒ£ãƒ³ãƒãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ > æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹**ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

![channel info view](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/view-channel-id1.png)

![channel info view](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/view-channel-id2.png)

```go
io.WriteString(w, `{
	"text": "**TEST**",
	"channel_id": "u6ijofzg8bnsie5u8c1eumtc1h"
}`)
```

### `goto_location`

Slash Command ç‰¹æœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚`goto_location`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« URL ã‚’æŒ‡å®šã—ã¦ãŠãã¨ã€Slash Command ãŒå®Ÿè¡Œã•ã‚ŒãŸéš›ã«æŒ‡å®šã•ã‚ŒãŸ URL ã«ç§»å‹•ã—ã¾ã™ã€‚ã“ã®æ™‚`text`ãªã©ã§æŒ‡å®šã—ãŸæŠ•ç¨¿ã‚‚ä½œæˆã•ã‚Œã¾ã™ã€‚

```go
io.WriteString(w, `{
	"text": "**TEST**",
	"goto_location": "https://github.com/mattermost"
}`)
```

![movie](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/example-goto-location.gif)

`goto_location`ã«ã¯`https`ã ã‘ã§ãªãã€`ssh`ã‚„`mailto`ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚‚ä½¿ç”¨ã§ãã‚‹ãŸã‚ã€ä¾‹ãˆã°ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸå ´åˆã«ã€Œãƒ¡ãƒ¼ãƒ©ãƒ¼ã§ãƒ¡ãƒ¼ãƒ«ä½œæˆç”»é¢ã‚’é–‹ãã€ã¨ã„ã†ã‚ˆã†ãªå‹•ä½œã‚’ã•ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```go
io.WriteString(w, `{
	"text": "**TEST**",
	"goto_location": "mailto:test@example.com"
}`)
```

### `attachments`

`attachments`ã¯ã€Mattermost ã«ãƒªãƒƒãƒãªæŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹[MessageAttachments](https://docs.mattermost.com/developer/message-attachments.html)ã‚’æŒ‡å®šã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚[MessageAttachments](https://docs.mattermost.com/developer/message-attachments.html)ã«ã¤ã„ã¦ã¯ã€åˆ¥é€”ç´¹ä»‹è¨˜äº‹ã‚’ç”¨æ„ã™ã‚‹äºˆå®šã§ã™ã€‚

### `type`

`type`ã¯ã€Mattermost ã®æŠ•ç¨¿ã®ç¨®åˆ¥ã‚’æŒ‡å®šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ãŒã€åŸºæœ¬çš„ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Plugin(Webapp)ã«ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç‹¬è‡ªã®æŠ•ç¨¿ç¨®åˆ¥ã‚’æŒ‡å®šã—ãŸå ´åˆã®ã¿ã«ä½¿ç”¨ã™ã‚‹ã‚‚ã®ã‹ã¨æ€ã„ã¾ã™ã€‚Plugin(Webapp)ã«ã¤ã„ã¦ã¯ã€åˆ¥é€”ç´¹ä»‹è¨˜äº‹ã‚’ç”¨æ„ã™ã‚‹äºˆå®šã§ã™ã€‚

### `extra_responses`

`extra_responses`é…åˆ—ã¨ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® JSON ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§è¤‡æ•°ã®æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
`extra_responses`ãŒå°å…¥ã•ã‚Œã‚‹ Mattermost v5.6 ä»¥å‰ã¯ã€Slash Command ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¤‡æ•°ã®æŠ•ç¨¿ã‚’ä½œæˆã—ãŸã„å ´åˆã¯ REST API ã‚’å®Ÿè¡Œã™ã‚‹ãªã©ã‚’ã—ãªãã¦ã¯ãªã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€`extra_responses`ã«ã‚ˆã£ã¦ REST API ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ãªã©ãŒå¿…è¦ãªããªã‚Šã¾ã—ãŸã€‚

Slash Command ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ä¸‹è¨˜ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´ã™ã‚‹ã¨ã€ã€Œãƒãƒ£ãƒ³ãƒãƒ«å…¨å“¡ãŒé–²è¦§ã§ãã‚‹æŠ•ç¨¿ã‚’ä½œã‚Šã¤ã¤ã€ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã«ã—ã‹è¦‹ãˆãªã„æŠ•ç¨¿ã‚‚åˆã‚ã›ã¦ä½œæˆã—ã€ã•ã‚‰ã«ã€åˆ¥ã®ãƒãƒ£ãƒ³ãƒãƒ«ã«ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸã“ã¨ã‚’é€šçŸ¥ã™ã‚‹ã€ã¨ã„ã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```go
io.WriteString(w, `{
	"text": "**TEST**",
	"response_type": "in_channel",
	"extra_responses": [
		{
			"text": "**Secret Info**"
		},
		{
			"text": "Notify in other channel",
			"channel_id": "u6ijofzg8bnsie5u8c1eumtc1h"
		}
	]
}`)
```

`extra_responses`å†…ã«ã•ã‚‰ã«`extra_responses`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã¯ã§ããšã€ã¾ãŸã€`goto_location`ã‚‚ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚

### `skip_slack_parsing`

Mattermost ã®çµ±åˆæ©Ÿèƒ½ã¯ Slack è¨˜æ³•ã¨ã®äº’æ›æ€§ã‚’æ„è­˜ã—ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™ãŒã€`skip_slack_parsing`ã«`true`ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”å´ã—ãŸ`text`ã‚’ Slack äº’æ›ã®è¨˜æ³•ã¨ã—ã¦è§£æã—ãªã„ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã‚ã¾ã‚Šä½¿ã†ã“ã¨ã¯ç„¡ã„ã‹ã¨æ€ã„ã¾ã™ãŒã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæƒ³å®šã©ãŠã‚Šã«æŠ•ç¨¿ã•ã‚Œãªã„å ´åˆãªã©ã«åˆ©ç”¨ã‚’æ¤œè¨ã—ã¦ã¿ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚ŒãŸãã£ã‹ã‘ã¨ãªã£ãŸã®ã¯ä¸‹è¨˜ã® Issue ã§ã™ã€‚
[slack\-compatibility\-layer seems to break results of MM\-only integration Â· Issue \#12702 Â· mattermost/mattermost\-server](https://github.com/mattermost/mattermost-server/issues/12702)

### `props`

Incoming WebHook ãªã©ã¨åŒæ§˜ã€æŠ•ç¨¿ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™ã€‚Incoming WebHook ã¨åŒæ§˜ã€`card`ã‚‚åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## Slash Command ã§æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆ

å˜ã« Slash Command ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦æŠ•ç¨¿ã‚’ä½œæˆã§ãã‚‹ã ã‘ã ã¨ã€å¤–éƒ¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã—ã€ãã®çµæœã‚’è¿”ã—ãŸã„ã¨ã„ã†å ´åˆã€Mattermost ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰çµæœãŒè¿”ã‚‹ã¾ã§ä½•ã®åå¿œã‚‚å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ãã‚Œã‚’å›é¿ã™ã‚‹ãŸã‚ã€Slash Command å®Ÿè¡Œæ™‚ã«é€ä¿¡ã•ã‚Œã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä¸€åº¦è¿”ã—ãŸå¾Œã§æŠ•ç¨¿ã‚’ä½œæˆã“ã¨ãŒã§ãã‚‹ URL ã§ã‚ã‚‹`response_url`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

`response_url`ã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```go:main.go
package main

import (
	"io"
	"log"
	"net/http"
	"strings"
	"time"
)

const (
	WebHookToken = "8w7foap4ufrsfczda8uez51yxo"
)

func main() {
	http.HandleFunc("/command", func(w http.ResponseWriter, r *http.Request) {
		r.ParseForm()
		if r.Form.Get("token") != WebHookToken {
			log.Printf("received an invalid request with token: %s", r.Form.Get("token"))
			return
		}

		w.Header().Add("Content-Type", "application/json")
		io.WriteString(w, `{"text": "Request is recieved. Results will return later."}`)

		// (1) 5ç§’å¾Œã« "response_url" ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
		go func(url string) {
			time.Sleep(5 * time.Second)
			body := strings.NewReader(`{"text": "This is the result.", "response_type": "in_channel"}`)
			http.Post(url, "application/json", body)
		}(r.Form.Get("response_url"))
	})
	http.ListenAndServe(":8080", nil)
}
```

ä»Šã¾ã§ã¨åŒã˜ã‚ˆã†ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ãŸå¾Œã€5 ç§’ Sleep ã—ãŸå¾Œã«`response_url`ã® URL ã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã„ã¾ã™

![movie](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/example-delayed-response.gif)

`response_url`ã«é€ä¿¡ã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯ã€`goto_location`ã¯ä½¿ãˆã¾ã›ã‚“ã§ã—ãŸãŒã€`response_type`ã‚„`extra_responses`ãªã©ã¯ä½¿ãˆã‚‹ã‚ˆã†ã§ã™ã€‚

ã¾ãŸã€`response_url`ãŒæœ‰åŠ¹ãªã®ã¯ã€å…ƒã® Slash Command ãŒå®Ÿè¡Œã•ã‚Œã¦ã‹ã‚‰ 30 åˆ†é–“ã®ã¿ã§ã€5 ã¤ã¾ã§ã®æŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å‡¦ç†ãŒ 30 åˆ†ä»¥ä¸Šã‹ã‹ã‚‹å ´åˆã‚„ã€5 ã¤ä»¥ä¸Šã®æŠ•ç¨¿ã‚’ä½œæˆã—ãŸã„å ´åˆã¯ã€REST API ã‚’åˆ©ç”¨ã™ã‚‹ã‹ã€Plugin ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚

## ã•ã„ã”ã«

æœ¬æ—¥ã¯ã€Slash Command ã®è©³ç´°ãªä½¿ã„æ–¹ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
æ˜æ—¥ã¯ã€REST API ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚
