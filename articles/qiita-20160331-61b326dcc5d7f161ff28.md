---
title: "Gradleã§bowerã‚’åˆ©ç”¨ã—ãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ã¾ã§ã‚’è¡Œã†æ–¹æ³•  (3/6)"
date: 2016-03-31T03:00:00+09:00
emoji: "ğŸ“£"
type: "tech"
topics: [Java, gradle, grunt, bower, Docker]
published: false
---

# ã¯ã˜ã‚ã«

Java/Spark ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® Gradle ã‚’åˆ©ç”¨ã—ãŸãƒ“ãƒ«ãƒ‰/ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¤ã„ã¦ã€ç§ãŒè©¦ã—ãŸã“ã¨ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚
(ã“ã“ã§è¨€ã†`Spark`ã¯ã€åˆ†æ•£å‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®`Apache Spark`ã§ã¯ãªãã€Java ã® Sinatra ãƒ©ã‚¤ã‚¯ãª Microframework ã®`Spark`ã®ã“ã¨ã§ã™)

## ç›®æ¬¡

1. [Hello World ã‚¢ãƒ—ãƒª](http://qiita.com/kaakaa_hoe/items/0e3c622ae8bde3d116ad)
2. [jade ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³](http://qiita.com/kaakaa_hoe/items/6d4311e250df89f836b9)
3. **Grunt/bower ã«ã‚ˆã‚‹ Web ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰**
4. [ä»˜éŒ² A. TravisCI ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰](http://qiita.com/kaakaa_hoe/items/373a5a8718c92676771f)
5. [ä»˜éŒ² B. Gradle ã§ docker build](http://qiita.com/kaakaa_hoe/items/18e5f3047931ee886acb)
6. [ä»˜éŒ² C. TravisCI ã‹ã‚‰ DockerHub ã¸ docker push](http://qiita.com/kaakaa_hoe/items/87221df2dfe6b894b2b7)

å„ç« ã§ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ [Commits Â· kaakaa/gradle-frontend-boilerplate](https://github.com/kaakaa/gradle-frontend-boilerplate/commits/master) ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

## ç’°å¢ƒ

- Java 1.8.0_74
- Gradle 2.12
- spark-core 2.3
- spark-template-jade 2.3
- node.js 4.4.0

# gradle-frontend-boilerplate

# 3. Grunt/bower ã«ã‚ˆã‚‹ Web ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

## æ¦‚è¦

Gradle ã®ãƒ“ãƒ«ãƒ‰ãƒ•ãƒ­ãƒ¼ã«`npm`,`grunt`,`bower`ã‚’çµ„ã¿è¾¼ã‚€ã€‚

å³å¯†ã«ã¯ã€Gradle ãƒ—ãƒ©ã‚°ã‚¤ãƒ³`com.moowork.grunt`ã‚’ä½¿ã£ã¦`npm install`ã¨ Grunt ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã€‚  
`bower`ã¯ Grunt ã‚¿ã‚¹ã‚¯ã¨ã—ã¦æ“ä½œã™ã‚‹ã€‚

---

Java ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ bootstrap ãªã©ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è³‡ç”£ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã€[WebJars - Web Libraries in Jars](http://www.webjars.org/)ã‚’åˆ©ç”¨ã™ã‚‹ãªã©ã®æ–¹æ³•ã‚‚ã‚ã‚‹ãŒã€ä»Šå›ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ãƒ«ã«æ…£ã‚Œã‚‹ãŸã‚ã«ã€ãªã‚‹ã¹ããƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰éƒ¨åˆ†ã¯ Gradle ã‹ã‚‰**å®Ÿè¡Œã™ã‚‹**ã ã‘ã«ã—ãŸã‹ã£ãŸã‹ã‚‰ã§ã‚ã‚‹.

## å®Ÿè¡Œ

```
git clone https://github.com/kaakaa/gradle-frontend-boilerplate.git
cd gradle-frontend-boilerplate
git checkout sec_3

./gradlew run
```

## ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```groovy:build.gradle
plugins {
    id 'java'
    id 'application'
    id 'com.moowork.grunt' version '0.11'  // (1) - npm/gruntã‚’æ“ä½œã™ã‚‹Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æŒ‡å®šã™ã‚‹
    id 'com.moowork.node' version '0.11'
}

group 'org.kaakaa'
version '1.0-SNAPSHOT'

/** For Java build */
sourceCompatibility = '1.8'
targetCompatibility = '1.8'

mainClassName = 'org.kaakaa.spark.Main'

sourceSets {  // (2) - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ã®æˆæœç‰©ã‚’Javaãƒ“ãƒ«ãƒ‰ã®ãƒªã‚½ãƒ¼ã‚¹ã«çµ„ã¿è¾¼ã‚€
    main {
        resources {
            srcDir 'src/main/resources'
            srcDir 'src/main/web/bower_components'
        }
    }
}

repositories {
    mavenCentral()
}

dependencies {
    compile 'com.sparkjava:spark-core:2.3'
    compile 'com.sparkjava:spark-template-jade:2.3'
}


/** For frontend build */
node {  // (3) - nodeã®è¨­å®š
    version = '4.4.0'
    download = true
    workDir = file("${projectDir}/src/main/web")
    nodeModulesDir = file("${projectDir}/src/main/web")
}

grunt {
    workDir = file("${projectDir}/src/main/web")
}

grunt_build.dependsOn 'installGrunt'  //  (4) - gruntã®å®Ÿè¡Œç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹
grunt_build.dependsOn 'npmInstall'
processResources.dependsOn grunt_build

/** Other settings */
task wrapper(type: Wrapper) {
    gradleVersion = '2.12'
}
```

### (1) npm/grunt ã‚’æ“ä½œã™ã‚‹ Gradle ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æŒ‡å®šã™ã‚‹

[com.moowork.grunt](https://github.com/srs/gradle-grunt-plugin)ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ Grunt ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹`installGrunt`ã‚¿ã‚¹ã‚¯ã¨ã€Grunt ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹`grunt_<task>`ãƒ«ãƒ¼ãƒ«ãŒ Gradle ã‚¿ã‚¹ã‚¯ã¨ã—ã¦è¿½åŠ ã•ã‚Œã‚‹ã€‚
ä»Šå›ã¯`grunt_build`ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã«ã‚ˆã‚Š grunt ã®`build`ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã‚‹ã€‚

ã¾ãŸã€[com.moowork.node](https://github.com/srs/gradle-node-plugin)ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã€node.js/npm ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ node/npm ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã‚’ Gradle ã‹ã‚‰è¡Œã†ã“ã¨ãŒã§ãã‚‹ã€‚

### (2) ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ã®æˆæœç‰©ã‚’ Java ãƒ“ãƒ«ãƒ‰ã®ãƒªã‚½ãƒ¼ã‚¹ã«çµ„ã¿è¾¼ã‚€

ä»Šå›ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç³»ã®è³‡ç”£ã«ã¤ã„ã¦ã¯`src/main/web`å†…ã§æ‰±ã†ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ãŒã€ãã“ã§ç”Ÿæˆã•ã‚ŒãŸ js/css ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Java ãƒ“ãƒ«ãƒ‰ã®æˆæœç‰©ã«å«ã‚ã‚‹ãŸã‚ã«`src/main/web/bower_components`ã‚’ resources ãƒ•ã‚©ãƒ«ãƒ€ã¨ã—ã¦è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

### (3) node ã®è¨­å®š

`com.moowork.node`ã§ä½¿ç”¨ã™ã‚‹è¨­å®šã‚’`node`ç¯€ã«ã€`com.moowork.grunt`ã§ä½¿ç”¨ã™ã‚‹è¨­å®šã‚’`grunt`ç¯€ã«ãã‚Œãã‚Œè¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚
å…ˆã«ã‚‚è¿°ã¹ãŸã‚ˆã†ã«ã€node/grunt ã§æ‰±ã†è³‡ç”£ã¯`src/main/web`å†…ã§æ‰±ã†ãŸã‚ã€workDir ã«ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

### (4) grunt ã®å®Ÿè¡Œç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹

grunt_build ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã«`installGrunt`,`npmInstall`ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†è¨­å®šã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€`grunt_build`ã‚¿ã‚¹ã‚¯ãŒã€Java ãƒ“ãƒ«ãƒ‰ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‡¦ç†ã™ã‚‹`processResources`ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œå‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†è¨­å®šã—ã¦ã„ã¾ã™ã€‚

## ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ(Grunt)

Gradle ã®`grunt_build`ã‚¿ã‚¹ã‚¯ã«ã‚ˆã‚Šå®Ÿè¡Œã•ã‚Œã‚‹ grunt ãƒ•ã‚¡ã‚¤ãƒ«.
`src/main/web/Gruntfile.js`ã«ç½®ã„ã¦ã‚ã‚‹.

```js:Gruntfile.js
module.exports = function(grunt) {
  grunt.initConfig({
    "bower-install-simple": {  // (1) - bower installã‚’å®Ÿè¡Œã™ã‚‹
      options: {
        directory: "bower_components/public"  // (2) - bower installã®å‡ºåŠ›å…ˆã‚’å¤‰æ›´ã™ã‚‹
      },
      "prod": {
        options: {
          production: true
        }
      },
      "dev": {
        options: {
          production: false
        }
      }
    },
    wiredep: {
      task: {
        src: ['../resources/templates/**/*.jade'],  // (3) - jadeãƒ•ã‚¡ã‚¤ãƒ«ã«bowerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®å‚ç…§ã‚’injectã™ã‚‹
        directory: 'bower_components/public',
        ignorePath: '../../web/bower_components/public'  // (4) - bowerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®å‚ç…§ãƒ‘ã‚¹ã‹ã‚‰è¦ã‚‰ãªã„éƒ¨åˆ†ã‚’å‰Šé™¤ã™ã‚‹
      }
    }
  });

  grunt.loadNpmTasks('grunt-bower-install-simple');
  grunt.loadNpmTasks('grunt-wiredep');

  grunt.registerTask('default', 'build');
  grunt.registerTask('build', ['bower-install-simple', 'wiredep']);
};
```

### (1) bower install ã‚’å®Ÿè¡Œã™ã‚‹

`bower install`ã‚’å®Ÿè¡Œã™ã‚‹.
ä»Šå›ã€bower.json ã«ã¯`bootstrap`ã¸ã®ä¾å­˜ã®ã¿å®£è¨€ã—ã¦ã‚ã‚‹.

### (2) bower install ã®å‡ºåŠ›å…ˆã‚’å¤‰æ›´ã™ã‚‹

`bower install`ã®å‡ºåŠ›å…ˆãŒ`bower_components`ã¾ã¾ã ã¨ã€bower ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ Spark ã§ Static ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦é…ä¿¡å‡ºæ¥ãªã„(ã‚³ã‚³ã‚‰ã¸ã‚“ã¯ Gradle ã®`processResource`ã‚¿ã‚¹ã‚¯ã¨ã®é–¢ä¿‚).
ã¨ã‚Šã‚ãˆãšä»Šå›ã¯`bower install`ã®å‡ºåŠ›å…ˆã‚’å¤‰æ›´ã—ã€Spark ã® Static ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`/public`ã«æŒ‡å®šã™ã‚‹ã“ã¨ã«ã—ã¦ã„ã‚‹.

### (3) jade ãƒ•ã‚¡ã‚¤ãƒ«ã¸ bower ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®å‚ç…§ã‚’ inject ã™ã‚‹

`bower install`ã§ install ã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®å‚ç…§ã‚’ jade ãƒ•ã‚¡ã‚¤ãƒ«ã¸è¨˜è¿°ã™ã‚‹ã‚¿ã‚¹ã‚¯.
ä¾¿åˆ©ãªã®ã ãŒã€`grunt-wiredep`ã¯ã‚‚ã†ãƒ¡ãƒ³ãƒ†ã•ã‚Œã¦ãªã„ã‚‰ã—ã„. [stephenplusplus/grunt-wiredep: Inject Bower packages into your source code with Grunt.](https://github.com/stephenplusplus/grunt-wiredep)

### (4) bower ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®å‚ç…§ãƒ‘ã‚¹ã‹ã‚‰è¦ã‚‰ãªã„éƒ¨åˆ†ã‚’å‰Šé™¤ã™ã‚‹

`(3) jadeãƒ•ã‚¡ã‚¤ãƒ«ã¸bowerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®å‚ç…§ã‚’injectã™ã‚‹`ã§ jade ãƒ•ã‚¡ã‚¤ãƒ«ã« inject ã•ã‚Œã‚‹ãƒ‘ã‚¹ã¯ã€ç›¸å¯¾ãƒ‘ã‚¹ã®ãŸã‚`../../web/bower_components/public/bootstrap/dist/css/bootstrap.css`ã¨ã„ã†ã‚ˆã†ãªå½¢å¼ã«ãªã‚‹.
ã“ã®ã¾ã¾ã§ã¯ Web ã‚µãƒ¼ãƒã¨ã—ã¦å‹•ä½œã•ã›ãŸæ™‚ã«ä¸Šæ‰‹ãå‹•ã‹ãªã„ãŸã‚ã€ä¸è¦ãªéƒ¨åˆ†ã‚’å‰Šã‚‹.

ã“ã®å‰Šã‚Šæ–¹ã¯`(2) bower installã®å‡ºåŠ›å…ˆã‚’å¤‰æ›´ã™ã‚‹`ã«ä¾å­˜ã—ã¦ãŠã‚Šã€ã“ã“ã‚‰ã¸ã‚“ã®æ“ä½œã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒã¨ã¦ã‚‚é«˜ããªã‚ŠãŒã¡ãªã®ãŒæ‚©ã¿ã©ã“ã‚.

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰

```java:org.kaakaa.spark.Main
package org.kaakaa.spark;

import spark.ModelAndView;
import spark.template.jade.JadeTemplateEngine;

import java.util.Collections;

import static spark.Spark.get;
import static spark.Spark.port;
import static spark.Spark.staticFileLocation;

public class Main {
    public static void main(String[] args) {
        port(8080);
        staticFileLocation("/public");  // (1) - Staticãƒ•ã‚¡ã‚¤ãƒ«ã®æ ¼ç´å ´æ‰€ã¨ã—ã¦`/public`ã‚’æŒ‡å®šã™ã‚‹

        get("/hello", (rq, rs) -> new ModelAndView(Collections.EMPTY_MAP, "hello"), new JadeTemplateEngine());
    }
}
```

### (1) Static ãƒ•ã‚¡ã‚¤ãƒ«ã®æ ¼ç´å ´æ‰€ã¨ã—ã¦`/public`ã‚’æŒ‡å®šã™ã‚‹

ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ(Grunt)ã®`(2) bower installã®å‡ºåŠ›å…ˆã‚’å¤‰æ›´ã™ã‚‹`ã§ã‚‚è§¦ã‚ŒãŸã‚ˆã†ã«ã€Spark ã® Static ãƒ•ã‚¡ã‚¤ãƒ«ã®æ ¼ç´å ´æ‰€ã¨ã—ã¦`/public`ã‚’æŒ‡å®šã™ã‚‹.

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰(jade)

```jade:hello.jade
doctype html
html(lang="ja")
  head
    title gradle-frontend-boilerplate
    // bower:css  // (1) - grunt-wiredepã‚¿ã‚¹ã‚¯ã«ã‚ˆã‚Šbowerã®mainã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒinjectã•ã‚Œã‚‹
    // endbower
    // bower:js
    // endbower
  body
    nav.navbar.navbar-inverse.navbar-fixed-top
      .container
        .navbar-header
          a.navbar-brand Gradle-frontend-boilerplate
    .container(style="margin-top: 50px;")
      h1 gradle-frontend-boilerplate
      p Hello World!
```

### (1) grunt-wiredep ã‚¿ã‚¹ã‚¯ã«ã‚ˆã‚Š bower ã® main ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ inject ã•ã‚Œã‚‹

grunt ã®`grunt-wiredep`ã‚¿ã‚¹ã‚¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€bower ã® main ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ js/css ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å‚ç…§ãŒã‚³ãƒ¡ãƒ³ãƒˆã®é–“ã« inject ã•ã‚Œã‚‹ã€‚
