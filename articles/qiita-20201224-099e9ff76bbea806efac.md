---
title: "[Mattermost Integrations] Matterpoll Plugin (Development)"
date: 2020-12-24T00:00:00+09:00
emoji: "ğŸ“†"
type: "tech"
topics: ["Mattermost"]
published: true
---

Mattermost è¨˜äº‹ã¾ã¨ã‚: https://blog.kaakaa.dev/tags/mattermost/

## æœ¬è¨˜äº‹ã«ã¤ã„ã¦

[Mattermost ã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](https://qiita.com/advent-calendar/2020/mattermost-integrations)ã®ç¬¬ 24 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

ä»¥å‰ã‹ã‚‰é–‹ç™ºã«å‚åŠ ã—ã¦ã„ã‚‹[Matterpoll](https://github.com/matterpoll/matterpoll)ãŒ Mattermost å…¬å¼ã® Plugin Marketplace ã§ Community Plugin ã¨ã—ã¦å…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚

æ˜¨æ—¥ã¾ã§ã®è¨˜äº‹ã§ Matterpoll Plugin ã® Server å´ãƒ»Webapp å´ã®å®Ÿè£…ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸãŒã€æœ¬æ—¥ã®è¨˜äº‹ã§ã¯ Matterpoll Plugin ã®ãƒ†ã‚¹ãƒˆã‚„ CI ãªã©ã®é–‹ç™ºå‘¨ã‚Šã®è©±ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## Mattermost Plugin ã®ãƒ†ã‚¹ãƒˆ

### Server å´ã®ãƒ†ã‚¹ãƒˆ

Mattermost Plugin ã® Server å´ã®æ©Ÿèƒ½ã‚’ Mattermost ã‚’å®Ÿéš›ã«èµ·å‹•ã™ã‚‹ã“ã¨ãªããƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€[`plugintest`](https://github.com/mattermost/mattermost-server/tree/master/plugin/plugintest)ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

[`plugintest`](https://github.com/mattermost/mattermost-server/tree/master/plugin/plugintest)ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆã‚’è¨˜è¿°ã—ã¦ã„ãæ–¹æ³•ã«ã¤ã„ã¦ã€Mattermost æœ¬ä½“ã«ã‚ã‚‹[ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰](https://github.com/mattermost/mattermost-server/blob/5122b9e2929dbf84e22f496ee97d007fa18f2d2e/plugin/plugintest/example_hello_user_test.go)ã‚’å…ƒã«ç´¹ä»‹ã—ã¾ã™ã€‚Matterpoll ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‚å¤§éƒ¨åˆ†ã¯ã“ã‚Œã¨åŒã˜æ–¹å¼ã§ãƒ†ã‚¹ãƒˆãŒè¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚

```go:plugin/plugintest/example_hello_user_test.go
...
type HelloUserPlugin struct {
	plugin.MattermostPlugin
}

func (p *HelloUserPlugin) ServeHTTP(context *plugin.Context, w http.ResponseWriter, r *http.Request) {
	userID := r.Header.Get("Mattermost-User-Id")
	user, err := p.API.GetUser(userID)
	if err != nil {
		w.WriteHeader(http.StatusBadRequest)
		p.API.LogError(err.Error())
		return
	}

	fmt.Fprintf(w, "Welcome back, %s!", user.Username)
}
...
```

[https://github.com/mattermost/mattermost-server/blob/5122b9e2929dbf84e22f496ee97d007fa18f2d2e/plugin/plugintest/example_hello_user_test.go#L21](https://github.com/mattermost/mattermost-server/blob/5122b9e2929dbf84e22f496ee97d007fa18f2d2e/plugin/plugintest/example_hello_user_test.go#L21)

Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æœ¬ä½“ã¯ã€`plugin.MattermostPlugin`ãŒ embedded ã•ã‚ŒãŸæ§‹é€ ä½“ã§ã™ã€‚ã“ã“ã§ã¯ã€`HelloUserPlugin` æ§‹é€ ä½“ãŒãã‚Œã«ã‚ãŸã‚Šã¾ã™ã€‚ã“ã®æ§‹é€ ä½“ã‚’é€šã˜ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç”¨ã® API ã‚’å®Ÿè¡Œã—ãŸã‚Šã€Hook ã¨ãªã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ãŸã‚Šã™ã‚‹ã“ã¨ã§ã€ã‚µãƒ¼ãƒãƒ¼å´ã®å‹•ä½œã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`HelloUserPlugin` ã§ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç‹¬è‡ªã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ ã™ã‚‹ [`ServeHTTP`](<[https://developers.mattermost.com/extend/plugins/server/reference/#Hooks.ServeHTTP](https://developers.mattermost.com/extend/plugins/server/reference/#Hooks.ServeHTTP)>) Hooks ãŒå®Ÿè£…ã•ã‚Œã€ãã®å‡¦ç†ã®ä¸­ã§ `GetUser` API ã‚’å®Ÿè¡Œã—ã¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã—ã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã—ã¦ã„ã¾ã™ã€‚

ã“ã®`ServeHTTP` Hooks ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆã€å˜ã«`HelloUserPlugin`æ§‹é€ ä½“ã‚’ç”Ÿæˆã—ã¦`ServeHTTP`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ãŸã ã‘ã ã¨ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ API (`GetUser`) ã®å®Ÿè¡Œéƒ¨åˆ†ã§å®Ÿéš›ã® Mattermost ã‚µãƒ¼ãƒãƒ¼ã®æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºãã†ã¨ã—ã¦ã—ã¾ã„ã‚¨ãƒ©ãƒ¼ã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

```go
	user, err := p.API.GetUser(userID)
```

`HelloUserPlugin` ã® `API` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€`plugin.MattermostPlugin` æ§‹é€ ä½“ãŒæŒã£ã¦ã„ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã‚ã‚Šã€ã“ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é€šã—ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã¯ Mattermost ã‚µãƒ¼ãƒãƒ¼ã®å‡¦ç†ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚Mattermost ã‚µãƒ¼ãƒãƒ¼ãŒãªã„çŠ¶æ…‹ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã€ã“ã®`API`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¥ã‚Œæ›¿ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã“ã§ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç”¨ã®ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ [`Example`](https://github.com/mattermost/mattermost-server/blob/5122b9e2929dbf84e22f496ee97d007fa18f2d2e/plugin/plugintest/example_hello_user_test.go#L37) ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```go
...
func Example() {
	t := &testing.T{}
	user :&model.User{                           ... (1)
		Id:       model.NewId(),
		Username: "billybob",
	}

	api := &plugintest.API{}                       ... (2)
	api.On("GetUser", user.Id).Return(user, nil)   ... (3)
	defer api.AssertExpectations(t)                ... (4)

	helpers := &plugintest.Helpers{}
	defer helpers.AssertExpectations(t)

	p := &HelloUserPlugin{}
	p.SetAPI(api)                                  ... (5)
	p.SetHelpers(helpers)

	w := httptest.NewRecorder()
	r := httptest.NewRequest("GET", "/", nil)
	r.Header.Add("Mattermost-User-Id", user.Id)
	p.ServeHTTP(&plugin.Context{}, w, r)           ... (6)
	body, err := ioutil.ReadAll(w.Result().Body)
	require.NoError(t, err)
	assert.Equal(t, "Welcome back, billybob!", string(body))
}
```

[https://github.com/mattermost/mattermost-server/blob/5122b9e2929dbf84e22f496ee97d007fa18f2d2e/plugin/plugintest/example_hello_user_test.go#L37](https://github.com/mattermost/mattermost-server/blob/5122b9e2929dbf84e22f496ee97d007fa18f2d2e/plugin/plugintest/example_hello_user_test.go#L37)

**(2)**ã§ `plugintest.API` ã¨ã„ã†æ§‹é€ ä½“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã€ç”Ÿæˆã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æ§‹é€ ä½“ `HelloUserPlugin` ã¸ `SetAPI` é–¢æ•°ã‚’é€šã˜ã¦ã‚»ãƒƒãƒˆ **(5)** ã—ã¦ã„ã¾ã™ã€‚ `plugintest.API`è‡ªä½“ã¯ã€ãã®ã¾ã¾ã§ã¯ä½•ã‚‚å‡¦ç†ã‚’è¡Œã‚ãªã„ãŸã‚ã€`api.On` ã§ç‰¹å®šã®å¼•æ•°ãŒä¸ãˆã‚‰ã‚ŒãŸæ™‚ã®å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆå´ã§å®Ÿè£…ã—ã¦ã„ã¾ã™ **(3)**ã€‚

```go
    ...
	user :&model.User{                           ... (1)
		Id:       model.NewId(),
		Username: "billybob",
	}
	...
    api.On("GetUser", user.Id).Return(user, nil)   ... (3)
	defer api.AssertExpectations(t)                ... (4)
	...
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã®å ´åˆã€`user.Id` ã‚’å¼•æ•°ã¨ã—ã¦ `GetUser` ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã« **(1)** ã§å®šç¾©ã•ã‚ŒãŸ `user` ã‚’è¿”å´ã™ã‚‹ã‚ˆã†ãƒ¢ãƒƒã‚¯ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`defer api.AssertExpectations(t)` **(4)** ã‚’æ›¸ã„ã¦ãŠãã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡ŒãŒçµ‚äº†ã—ãŸæ™‚ã« `api.On` ã§å®šç¾©ã—ãŸãƒ¢ãƒƒã‚¯ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã‹ã£ãŸå ´åˆã«ãƒ†ã‚¹ãƒˆã‚’å¤±æ•—ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

`HelloUserPlugin` ã§ã¯ [`Helpers`](<[https://developers.mattermost.com/extend/plugins/server/reference/#Helpers](https://developers.mattermost.com/extend/plugins/server/reference/#Helpers)>)é–¢æ•°ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒã€`Helpers`ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã‚‚ `API` ã¨åŒæ§˜ã«é–¢æ•°ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æœ€å¾Œã« `httptest` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ `ServeHTTP` Hook ã‚’å‘¼ã³å‡ºã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæƒ³å®šé€šã‚Šã§ã‚ã‚‹ã“ã¨ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚

```go
	w := httptest.NewRecorder()
	r := httptest.NewRequest("GET", "/", nil)
	r.Header.Add("Mattermost-User-Id", user.Id)
	p.ServeHTTP(&plugin.Context{}, w, r)           ... (6)
```

ã“ã®ã‚ˆã†ã« `plugintest` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†ã“ã¨ã§ ã€Mattermost ã‚µãƒ¼ãƒãƒ¼ãŒãªã„çŠ¶æ³ã§ã‚‚ Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã‚ã¨ã¯ã€ã¨ã«ã‹ããƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¶²ç¾…ã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚’æ›¸ãå‡ºã™ã ã‘ã§ã™ã€‚ç­‹åŠ›ã§ã™ã€‚

### Server å´ã®ãƒ†ã‚¹ãƒˆ(Store)

Matterpoll ã§ã¯ Mattermost Plugin ã® Key Value ã‚¹ãƒˆã‚¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŠ½è±¡åŒ–ã—ãŸ `store` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ Key Value ã‚¹ãƒˆã‚¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ãªå‡¦ç†ãŒã‚ã£ãŸå ´åˆã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ API ã® `KVSet`ã€`KVGet` ãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ `plugintest` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ãƒ¢ãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€ãƒ†ã‚¹ãƒˆè¨˜è¿°ãŒç…©é›‘ã«ãªã‚‹ãŸã‚ã€Matterpoll ã§ã¯ [vektra/mockery](<[https://github.com/vektra/mockery](https://github.com/vektra/mockery)>) ã‚’ä½¿ã£ã¦ `store.Store` ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰ãƒ¢ãƒƒã‚¯ã‚’ç”Ÿæˆã—ã¦ãƒ†ã‚¹ãƒˆã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚ã“ã® [vektra/mockery](<[https://github.com/vektra/mockery](https://github.com/vektra/mockery)>) ã¯ã€Mattermost æœ¬ä½“ã® `plugintest` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ã®ã«ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚

### Webapp å´ã®ãƒ†ã‚¹ãƒˆ

ã“ã“ã«ã¤ã„ã¦ã¯ã€Mattermost Plugin ç‰¹æœ‰ã®ãƒˆãƒ”ãƒƒã‚¯ã¨ã„ã†ã‚‚ã®ã¯ãªãã€é–‹ç™ºã—ãŸ React Component ã«å¯¾ã—ã¦[`Jest`](<[https://jestjs.io/](https://jestjs.io/ja/)>) ã‚’ä½¿ã£ãŸ snapshot ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### CI

CI ã¯ CircleCI ã‚’ä½¿ã£ã¦ãŠã‚Šã€Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç”¨ã® CircleCI Orb ã‚’ä½¿ã£ã¦ lint / build/ coverage / deploy ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

[https://github.com/matterpoll/matterpoll/blob/master/.circleci/config.yml](https://github.com/matterpoll/matterpoll/blob/master/.circleci/config.yml)

ã‚«ãƒãƒ¬ãƒƒã‚¸ã¯ [Codecov](https://codecov.io/gh/matterpoll/matterpoll) ã«ã‚ˆã‚‹ PR ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¦ã„ã¾ã™ã€‚

![](https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day24/codecov/png)

## Checks

é™çš„è§£æç³»ã®ãƒ„ãƒ¼ãƒ«ã¯ Mattermost ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒª [mattermost/mattermost\-plugin\-starter\-template: Build scripts and templates for writing Mattermost plugins\.](https://github.com/mattermost/mattermost-plugin-starter-template) ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¨ãƒ™ãƒ¼ã‚¹ã¯åŒã˜ã§ã€æ¡ç”¨ã—ã¦ã„ã‚‹ linter ã‚„ãƒ«ãƒ¼ãƒ«ãŒå°‘ã—ç•°ãªã‚‹ã¨ã„ã†æ„Ÿã˜ã§ã™ã€‚

ã‚µãƒ¼ãƒãƒ¼å´ã¯ [golangci-lint](https://github.com/golangci/golangci-lint) ã‚’ä½¿ã£ã¦ãŠã‚Šè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚

```yml:.golangci.yml
run:
  timeout: 5m
  modules-download-mode: readonly

linters-settings:
  goconst:
    min-len: 2
    min-occurrences: 2
  gofmt:
    simplify: true
  goimports:
    local-prefixes: github.com/matterpoll/matterpoll
  golint:
    min-confidence: 0.0
  govet:
    check-shadowing: true
    enable-all: true
  misspell:
    locale: US
  maligned:
    suggest-new: true

linters:
  disable-all: true
  enable:
    - bodyclose
    - deadcode
    - dogsled
    - errcheck
    - goconst
    - gocritic
    - gofmt
    - goimports
    - golint
    - gosec
    - gosimple
    - govet
    - ineffassign
    - interfacer
    - maligned
    - misspell
    - nakedret
    - scopelint
    - staticcheck
    - structcheck
    - stylecheck
    - typecheck
    - unconvert
    - unparam
    - unused
    - varcheck
    - whitespace

issues:
  exclude-rules:
    # Exclude some linters from running on tests files.
    - path: _test\.go
      linters:
        - dupl
        - goconst
        - scopelint # https://github.com/kyoh86/scopelint/issues/4
```

[https://github.com/matterpoll/matterpoll/blob/d4ffdbfd6dcdea359b7419e0baa3ab8aaa32e420/.golangci.yml](https://github.com/matterpoll/matterpoll/blob/d4ffdbfd6dcdea359b7419e0baa3ab8aaa32e420/.golangci.yml)

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¯ [ESLint](https://eslint.org/) ã‚’ä½¿ã£ã¦ãŠã‚Šã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚ï¼ˆé•·ã„ãŸã‚ãƒªãƒ³ã‚¯å…ˆå‚ç…§ï¼‰

[https://github.com/matterpoll/matterpoll/blob/0b797025cfbf319c43464fcf457d4cdfe5086188/webapp/.eslintrc.json](https://github.com/matterpoll/matterpoll/blob/0b797025cfbf319c43464fcf457d4cdfe5086188/webapp/.eslintrc.json)

## ç¿»è¨³

Matterpoll ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç¿»è¨³å¯èƒ½ãªå½¢å¼ã§ç®¡ç†ã•ã‚Œã¦ãŠã‚Šã€ç¾åœ¨ã€ä¸‹è¨˜ã®è¨€èªãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚

- English
- France
- German
- Japanese
- Korean
- Polish
- Simplified Chinese
- Spanish
- Traditional Chinese

è¨€èªã®åˆ‡ã‚Šæ›¿ãˆã¯ã€Mattermost æœ¬ä½“ã®è¨­å®šã«å¿œã˜ã¦å®Ÿæ–½ã•ã‚Œã¾ã™ã€‚

Mattermost Plugin ã«ãŠã‘ã‚‹ç¿»è¨³å‡¦ç†ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€Matterpoll ã®å…±åŒé–‹ç™ºè€…ã§ã‚ã‚‹ Hanzei ã«ã‚ˆã‚‹ä¸‹è¨˜ã®è¨˜äº‹ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

[https://developers.mattermost.com/blog/localizing-matterpoll/](https://developers.mattermost.com/blog/localizing-matterpoll/)

### Server å´ã®ç¿»è¨³

Server å´ã®ç¿»è¨³æ©Ÿèƒ½ã¯[go-i18n](https://github.com/nicksnyder/go-i18n)ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

ç¿»è¨³å¯¾è±¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€ã‚³ãƒ¼ãƒ‰ä¸Šã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«`go-i18n`ã®`i18n`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ§‹é€ ä½“ã¨ã—ã¦æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

```go:server/plugin/command.go
...
HelpText: p.LocalizeWithConfig(l, &i18n.LocalizeConfig{
	DefaultMessage: &i18n.Message{
		ID:    "dialog.createPoll.setting.multi",
		Other: "The number of options that an user can vote on.",
	}}),
...
```

[https://github.com/matterpoll/matterpoll/blob/45f095875a98fb1d4f3f166851c86f41b987493e/server/plugin/command.go#L265](https://github.com/matterpoll/matterpoll/blob/45f095875a98fb1d4f3f166851c86f41b987493e/server/plugin/command.go#L265)

å®Ÿéš›ã®ç¿»è¨³ã‚’è¡Œã†å ´åˆã¯ã€`go-i18n`ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã€ä¸Šè¨˜ã®ã‚ˆã†ãª`i18n`ã®æ§‹é€ ä½“ã¨ã—ã¦å®£è¨€ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ json ãƒ•ã‚¡ã‚¤ãƒ«ã«é›†ç´„ã—ã¾ã™ã€‚ãã®è¾ºã‚Šã®æ‰‹é †ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

https://github.com/matterpoll/matterpoll/blob/master/CONTRIBUTING.md#translating-strings

`go-i18n`ã«ã‚ˆã£ã¦é›†ç´„ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å„å›½ã®ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚¿ã«ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã—ã¦ã‚‚ã‚‰ã†ã“ã¨ã§ã€ç¿»è¨³ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
https://github.com/matterpoll/matterpoll/tree/45f095875a98fb1d4f3f166851c86f41b987493e/assets/i18n

### Webapp å´ã®ç¿»è¨³

Matterpoll Plugin ã§ã¯ã€ã¾ã  Webapp å´ã®ç¿»è¨³æ©Ÿèƒ½ã¯å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€Mattermost Plugin ã®æ©Ÿèƒ½ã¨ã—ã¦ã¯å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

Webapp å´ã®ç¿»è¨³ã¯ã€[`react-intl`](https://www.npmjs.com/package/react-intl)ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```jsx
...
import {FormattedMessage} from 'react-intl';
...
        <FormattedMessage
            id='rootModal.message'
            defaultMessage='Root Modal2'
		/>
...
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰å†…ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ç¿»è¨³å¯¾è±¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€`make i18n-extract`ã§é›†ç´„ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```Makefile
...
## Extract strings for translation from the source code.
.PHONY: i18n-extract
i18n-extract:
ifneq ($(HAS_WEBAPP),)
ifeq ($(HAS_MM_UTILITIES),)
	@echo "You must clone github.com/mattermost/mattermost-utilities repo in .. to use this command"
else
	cd $(MM_UTILITIES_DIR) && npm install && npm run babel && node mmjstool/build/index.js i18n extract-webapp --webapp-dir $(PWD)/webapp
endif
endif
...
```

[https://github.com/matterpoll/matterpoll/blob/master/Makefile#L205](https://github.com/matterpoll/matterpoll/blob/master/Makefile#L205)

é›†ç´„ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Mattermost Webapp Plugin API ã®[`registerTranslations`](https://developers.mattermost.com/extend/plugins/webapp/reference/#registerTranslations)ã§ç™»éŒ²ã™ã‚‹ã“ã¨ã§ã€Webapp å´ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¿»è¨³ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ã•ã„ã”ã«

æœ¬æ—¥ã¯ã€Matterpoll Plugin ã®ãƒ†ã‚¹ãƒˆã‚„ CI ãªã©ã®é–‹ç™ºã«é–¢ã™ã‚‹äº‹æŸ„ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
Mattermost Integractions ã«é–¢ã™ã‚‹ç´¹ä»‹ã¯æœ¬æ—¥ã®è¨˜äº‹ã§çµ‚äº†ã§ã™ã€‚

æ˜æ—¥ã¯ã€æœ¬è¨˜äº‹ã‚’åŸ·ç­†ã™ã‚‹ä¸­ã§è¦‹ã¤ã‹ã£ãŸå•é¡Œã«å¯¾ã™ã‚‹ Issue/PR ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚
